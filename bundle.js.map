{"version":3,"file":"bundle.js","sources":["../node_modules/svelte/internal/index.mjs","../node_modules/svelte/store/index.mjs","../src/math/vector.js","../src/math/matrix.js","../src/renderer/raytracer/intersection.js","../src/scenegraph/nodes.js","../src/state/stores.js","../node_modules/svelte/easing/index.mjs","../node_modules/svelte/transition/index.mjs","../src/components/SceneGraphLeaf.svelte","../src/components/SceneGraphNode.svelte","../src/components/SceneGraph.svelte","../src/components/Slider.svelte","../src/components/PhongConfigurator.svelte","../src/shaders/rasterizer/raster-vertex-shader.glsl","../src/shaders/rasterizer/raster-phong-fragment-shader.glsl","../src/shaders/rasterizer/raster-texture-vertex-shader.glsl","../src/shaders/rasterizer/raster-texture-fragment-shader.glsl","../src/shaders/raytracer/raytracer-vertex-shader.glsl","../src/shaders/raytracer/raytracer-fragment-shader.glsl","../src/shaders/boundingSphere/bounding-sphere-vertex-shader.glsl","../src/shaders/boundingSphere/bounding-sphere-fragment-shader.glsl","../src/scenegraph/rasterizer/rasterizable.js","../src/scenegraph/rasterizer/raster-sphere.js","../src/scenegraph/rasterizer/texture-rasterizable.js","../src/scenegraph/rasterizer/raster-mesh.js","../src/renderer/visitor.js","../src/shaders/shader.js","../src/renderer/rasterizer/rastervisitor.js","../src/scenegraph/rasterizer/raster-box.js","../src/scenegraph/rasterizer/raster-texture-box.js","../src/scenegraph/rasterizer/raster-pyramid.js","../src/renderer/raytracer/rayvisitor.js","../src/math/sphere.js","../src/renderer/boundingSphere/collisionVisitor.js","../src/scenegraph/animation-nodes.js","../src/demo.js","../src/App.svelte","../src/main.js"],"sourcesContent":["function noop() { }\nconst identity = x => x;\nfunction assign(tar, src) {\n    // @ts-ignore\n    for (const k in src)\n        tar[k] = src[k];\n    return tar;\n}\nfunction is_promise(value) {\n    return value && typeof value === 'object' && typeof value.then === 'function';\n}\nfunction add_location(element, file, line, column, char) {\n    element.__svelte_meta = {\n        loc: { file, line, column, char }\n    };\n}\nfunction run(fn) {\n    return fn();\n}\nfunction blank_object() {\n    return Object.create(null);\n}\nfunction run_all(fns) {\n    fns.forEach(run);\n}\nfunction is_function(thing) {\n    return typeof thing === 'function';\n}\nfunction safe_not_equal(a, b) {\n    return a != a ? b == b : a !== b || ((a && typeof a === 'object') || typeof a === 'function');\n}\nfunction not_equal(a, b) {\n    return a != a ? b == b : a !== b;\n}\nfunction validate_store(store, name) {\n    if (!store || typeof store.subscribe !== 'function') {\n        throw new Error(`'${name}' is not a store with a 'subscribe' method`);\n    }\n}\nfunction subscribe(store, callback) {\n    const unsub = store.subscribe(callback);\n    return unsub.unsubscribe ? () => unsub.unsubscribe() : unsub;\n}\nfunction get_store_value(store) {\n    let value;\n    subscribe(store, _ => value = _)();\n    return value;\n}\nfunction component_subscribe(component, store, callback) {\n    component.$$.on_destroy.push(subscribe(store, callback));\n}\nfunction create_slot(definition, ctx, fn) {\n    if (definition) {\n        const slot_ctx = get_slot_context(definition, ctx, fn);\n        return definition[0](slot_ctx);\n    }\n}\nfunction get_slot_context(definition, ctx, fn) {\n    return definition[1]\n        ? assign({}, assign(ctx.$$scope.ctx, definition[1](fn ? fn(ctx) : {})))\n        : ctx.$$scope.ctx;\n}\nfunction get_slot_changes(definition, ctx, changed, fn) {\n    return definition[1]\n        ? assign({}, assign(ctx.$$scope.changed || {}, definition[1](fn ? fn(changed) : {})))\n        : ctx.$$scope.changed || {};\n}\nfunction exclude_internal_props(props) {\n    const result = {};\n    for (const k in props)\n        if (k[0] !== '$')\n            result[k] = props[k];\n    return result;\n}\nfunction once(fn) {\n    let ran = false;\n    return function (...args) {\n        if (ran)\n            return;\n        ran = true;\n        fn.call(this, ...args);\n    };\n}\nfunction null_to_empty(value) {\n    return value == null ? '' : value;\n}\n\nconst is_client = typeof window !== 'undefined';\nlet now = is_client\n    ? () => window.performance.now()\n    : () => Date.now();\nlet raf = is_client ? cb => requestAnimationFrame(cb) : noop;\n// used internally for testing\nfunction set_now(fn) {\n    now = fn;\n}\nfunction set_raf(fn) {\n    raf = fn;\n}\n\nconst tasks = new Set();\nlet running = false;\nfunction run_tasks() {\n    tasks.forEach(task => {\n        if (!task[0](now())) {\n            tasks.delete(task);\n            task[1]();\n        }\n    });\n    running = tasks.size > 0;\n    if (running)\n        raf(run_tasks);\n}\nfunction clear_loops() {\n    // for testing...\n    tasks.forEach(task => tasks.delete(task));\n    running = false;\n}\nfunction loop(fn) {\n    let task;\n    if (!running) {\n        running = true;\n        raf(run_tasks);\n    }\n    return {\n        promise: new Promise(fulfil => {\n            tasks.add(task = [fn, fulfil]);\n        }),\n        abort() {\n            tasks.delete(task);\n        }\n    };\n}\n\nfunction append(target, node) {\n    target.appendChild(node);\n}\nfunction insert(target, node, anchor) {\n    target.insertBefore(node, anchor || null);\n}\nfunction detach(node) {\n    node.parentNode.removeChild(node);\n}\nfunction destroy_each(iterations, detaching) {\n    for (let i = 0; i < iterations.length; i += 1) {\n        if (iterations[i])\n            iterations[i].d(detaching);\n    }\n}\nfunction element(name) {\n    return document.createElement(name);\n}\nfunction element_is(name, is) {\n    return document.createElement(name, { is });\n}\nfunction object_without_properties(obj, exclude) {\n    // eslint-disable-next-line @typescript-eslint/no-object-literal-type-assertion\n    const target = {};\n    for (const k in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, k)\n            // @ts-ignore\n            && exclude.indexOf(k) === -1) {\n            // @ts-ignore\n            target[k] = obj[k];\n        }\n    }\n    return target;\n}\nfunction svg_element(name) {\n    return document.createElementNS('http://www.w3.org/2000/svg', name);\n}\nfunction text(data) {\n    return document.createTextNode(data);\n}\nfunction space() {\n    return text(' ');\n}\nfunction empty() {\n    return text('');\n}\nfunction listen(node, event, handler, options) {\n    node.addEventListener(event, handler, options);\n    return () => node.removeEventListener(event, handler, options);\n}\nfunction prevent_default(fn) {\n    return function (event) {\n        event.preventDefault();\n        // @ts-ignore\n        return fn.call(this, event);\n    };\n}\nfunction stop_propagation(fn) {\n    return function (event) {\n        event.stopPropagation();\n        // @ts-ignore\n        return fn.call(this, event);\n    };\n}\nfunction self(fn) {\n    return function (event) {\n        // @ts-ignore\n        if (event.target === this)\n            fn.call(this, event);\n    };\n}\nfunction attr(node, attribute, value) {\n    if (value == null)\n        node.removeAttribute(attribute);\n    else\n        node.setAttribute(attribute, value);\n}\nfunction set_attributes(node, attributes) {\n    for (const key in attributes) {\n        if (key === 'style') {\n            node.style.cssText = attributes[key];\n        }\n        else if (key in node) {\n            node[key] = attributes[key];\n        }\n        else {\n            attr(node, key, attributes[key]);\n        }\n    }\n}\nfunction set_custom_element_data(node, prop, value) {\n    if (prop in node) {\n        node[prop] = value;\n    }\n    else {\n        attr(node, prop, value);\n    }\n}\nfunction xlink_attr(node, attribute, value) {\n    node.setAttributeNS('http://www.w3.org/1999/xlink', attribute, value);\n}\nfunction get_binding_group_value(group) {\n    const value = [];\n    for (let i = 0; i < group.length; i += 1) {\n        if (group[i].checked)\n            value.push(group[i].__value);\n    }\n    return value;\n}\nfunction to_number(value) {\n    return value === '' ? undefined : +value;\n}\nfunction time_ranges_to_array(ranges) {\n    const array = [];\n    for (let i = 0; i < ranges.length; i += 1) {\n        array.push({ start: ranges.start(i), end: ranges.end(i) });\n    }\n    return array;\n}\nfunction children(element) {\n    return Array.from(element.childNodes);\n}\nfunction claim_element(nodes, name, attributes, svg) {\n    for (let i = 0; i < nodes.length; i += 1) {\n        const node = nodes[i];\n        if (node.nodeName === name) {\n            for (let j = 0; j < node.attributes.length; j += 1) {\n                const attribute = node.attributes[j];\n                if (!attributes[attribute.name])\n                    node.removeAttribute(attribute.name);\n            }\n            return nodes.splice(i, 1)[0]; // TODO strip unwanted attributes\n        }\n    }\n    return svg ? svg_element(name) : element(name);\n}\nfunction claim_text(nodes, data) {\n    for (let i = 0; i < nodes.length; i += 1) {\n        const node = nodes[i];\n        if (node.nodeType === 3) {\n            node.data = data;\n            return nodes.splice(i, 1)[0];\n        }\n    }\n    return text(data);\n}\nfunction set_data(text, data) {\n    data = '' + data;\n    if (text.data !== data)\n        text.data = data;\n}\nfunction set_input_value(input, value) {\n    if (value != null || input.value) {\n        input.value = value;\n    }\n}\nfunction set_input_type(input, type) {\n    try {\n        input.type = type;\n    }\n    catch (e) {\n        // do nothing\n    }\n}\nfunction set_style(node, key, value, important) {\n    node.style.setProperty(key, value, important ? 'important' : '');\n}\nfunction select_option(select, value) {\n    for (let i = 0; i < select.options.length; i += 1) {\n        const option = select.options[i];\n        if (option.__value === value) {\n            option.selected = true;\n            return;\n        }\n    }\n}\nfunction select_options(select, value) {\n    for (let i = 0; i < select.options.length; i += 1) {\n        const option = select.options[i];\n        option.selected = ~value.indexOf(option.__value);\n    }\n}\nfunction select_value(select) {\n    const selected_option = select.querySelector(':checked') || select.options[0];\n    return selected_option && selected_option.__value;\n}\nfunction select_multiple_value(select) {\n    return [].map.call(select.querySelectorAll(':checked'), option => option.__value);\n}\nfunction add_resize_listener(element, fn) {\n    if (getComputedStyle(element).position === 'static') {\n        element.style.position = 'relative';\n    }\n    const object = document.createElement('object');\n    object.setAttribute('style', 'display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; pointer-events: none; z-index: -1;');\n    object.type = 'text/html';\n    object.tabIndex = -1;\n    let win;\n    object.onload = () => {\n        win = object.contentDocument.defaultView;\n        win.addEventListener('resize', fn);\n    };\n    if (/Trident/.test(navigator.userAgent)) {\n        element.appendChild(object);\n        object.data = 'about:blank';\n    }\n    else {\n        object.data = 'about:blank';\n        element.appendChild(object);\n    }\n    return {\n        cancel: () => {\n            win && win.removeEventListener && win.removeEventListener('resize', fn);\n            element.removeChild(object);\n        }\n    };\n}\nfunction toggle_class(element, name, toggle) {\n    element.classList[toggle ? 'add' : 'remove'](name);\n}\nfunction custom_event(type, detail) {\n    const e = document.createEvent('CustomEvent');\n    e.initCustomEvent(type, false, false, detail);\n    return e;\n}\nclass HtmlTag {\n    constructor(html, anchor = null) {\n        this.e = element('div');\n        this.a = anchor;\n        this.u(html);\n    }\n    m(target, anchor = null) {\n        for (let i = 0; i < this.n.length; i += 1) {\n            insert(target, this.n[i], anchor);\n        }\n        this.t = target;\n    }\n    u(html) {\n        this.e.innerHTML = html;\n        this.n = Array.from(this.e.childNodes);\n    }\n    p(html) {\n        this.d();\n        this.u(html);\n        this.m(this.t, this.a);\n    }\n    d() {\n        this.n.forEach(detach);\n    }\n}\n\nlet stylesheet;\nlet active = 0;\nlet current_rules = {};\n// https://github.com/darkskyapp/string-hash/blob/master/index.js\nfunction hash(str) {\n    let hash = 5381;\n    let i = str.length;\n    while (i--)\n        hash = ((hash << 5) - hash) ^ str.charCodeAt(i);\n    return hash >>> 0;\n}\nfunction create_rule(node, a, b, duration, delay, ease, fn, uid = 0) {\n    const step = 16.666 / duration;\n    let keyframes = '{\\n';\n    for (let p = 0; p <= 1; p += step) {\n        const t = a + (b - a) * ease(p);\n        keyframes += p * 100 + `%{${fn(t, 1 - t)}}\\n`;\n    }\n    const rule = keyframes + `100% {${fn(b, 1 - b)}}\\n}`;\n    const name = `__svelte_${hash(rule)}_${uid}`;\n    if (!current_rules[name]) {\n        if (!stylesheet) {\n            const style = element('style');\n            document.head.appendChild(style);\n            stylesheet = style.sheet;\n        }\n        current_rules[name] = true;\n        stylesheet.insertRule(`@keyframes ${name} ${rule}`, stylesheet.cssRules.length);\n    }\n    const animation = node.style.animation || '';\n    node.style.animation = `${animation ? `${animation}, ` : ``}${name} ${duration}ms linear ${delay}ms 1 both`;\n    active += 1;\n    return name;\n}\nfunction delete_rule(node, name) {\n    node.style.animation = (node.style.animation || '')\n        .split(', ')\n        .filter(name\n        ? anim => anim.indexOf(name) < 0 // remove specific animation\n        : anim => anim.indexOf('__svelte') === -1 // remove all Svelte animations\n    )\n        .join(', ');\n    if (name && !--active)\n        clear_rules();\n}\nfunction clear_rules() {\n    raf(() => {\n        if (active)\n            return;\n        let i = stylesheet.cssRules.length;\n        while (i--)\n            stylesheet.deleteRule(i);\n        current_rules = {};\n    });\n}\n\nfunction create_animation(node, from, fn, params) {\n    if (!from)\n        return noop;\n    const to = node.getBoundingClientRect();\n    if (from.left === to.left && from.right === to.right && from.top === to.top && from.bottom === to.bottom)\n        return noop;\n    const { delay = 0, duration = 300, easing = identity, \n    // @ts-ignore todo: should this be separated from destructuring? Or start/end added to public api and documentation?\n    start: start_time = now() + delay, \n    // @ts-ignore todo:\n    end = start_time + duration, tick = noop, css } = fn(node, { from, to }, params);\n    let running = true;\n    let started = false;\n    let name;\n    function start() {\n        if (css) {\n            name = create_rule(node, 0, 1, duration, delay, easing, css);\n        }\n        if (!delay) {\n            started = true;\n        }\n    }\n    function stop() {\n        if (css)\n            delete_rule(node, name);\n        running = false;\n    }\n    loop(now => {\n        if (!started && now >= start_time) {\n            started = true;\n        }\n        if (started && now >= end) {\n            tick(1, 0);\n            stop();\n        }\n        if (!running) {\n            return false;\n        }\n        if (started) {\n            const p = now - start_time;\n            const t = 0 + 1 * easing(p / duration);\n            tick(t, 1 - t);\n        }\n        return true;\n    });\n    start();\n    tick(0, 1);\n    return stop;\n}\nfunction fix_position(node) {\n    const style = getComputedStyle(node);\n    if (style.position !== 'absolute' && style.position !== 'fixed') {\n        const { width, height } = style;\n        const a = node.getBoundingClientRect();\n        node.style.position = 'absolute';\n        node.style.width = width;\n        node.style.height = height;\n        add_transform(node, a);\n    }\n}\nfunction add_transform(node, a) {\n    const b = node.getBoundingClientRect();\n    if (a.left !== b.left || a.top !== b.top) {\n        const style = getComputedStyle(node);\n        const transform = style.transform === 'none' ? '' : style.transform;\n        node.style.transform = `${transform} translate(${a.left - b.left}px, ${a.top - b.top}px)`;\n    }\n}\n\nlet current_component;\nfunction set_current_component(component) {\n    current_component = component;\n}\nfunction get_current_component() {\n    if (!current_component)\n        throw new Error(`Function called outside component initialization`);\n    return current_component;\n}\nfunction beforeUpdate(fn) {\n    get_current_component().$$.before_update.push(fn);\n}\nfunction onMount(fn) {\n    get_current_component().$$.on_mount.push(fn);\n}\nfunction afterUpdate(fn) {\n    get_current_component().$$.after_update.push(fn);\n}\nfunction onDestroy(fn) {\n    get_current_component().$$.on_destroy.push(fn);\n}\nfunction createEventDispatcher() {\n    const component = current_component;\n    return (type, detail) => {\n        const callbacks = component.$$.callbacks[type];\n        if (callbacks) {\n            // TODO are there situations where events could be dispatched\n            // in a server (non-DOM) environment?\n            const event = custom_event(type, detail);\n            callbacks.slice().forEach(fn => {\n                fn.call(component, event);\n            });\n        }\n    };\n}\nfunction setContext(key, context) {\n    get_current_component().$$.context.set(key, context);\n}\nfunction getContext(key) {\n    return get_current_component().$$.context.get(key);\n}\n// TODO figure out if we still want to support\n// shorthand events, or if we want to implement\n// a real bubbling mechanism\nfunction bubble(component, event) {\n    const callbacks = component.$$.callbacks[event.type];\n    if (callbacks) {\n        callbacks.slice().forEach(fn => fn(event));\n    }\n}\n\nconst dirty_components = [];\nconst intros = { enabled: false };\nconst binding_callbacks = [];\nconst render_callbacks = [];\nconst flush_callbacks = [];\nconst resolved_promise = Promise.resolve();\nlet update_scheduled = false;\nfunction schedule_update() {\n    if (!update_scheduled) {\n        update_scheduled = true;\n        resolved_promise.then(flush);\n    }\n}\nfunction tick() {\n    schedule_update();\n    return resolved_promise;\n}\nfunction add_render_callback(fn) {\n    render_callbacks.push(fn);\n}\nfunction add_flush_callback(fn) {\n    flush_callbacks.push(fn);\n}\nfunction flush() {\n    const seen_callbacks = new Set();\n    do {\n        // first, call beforeUpdate functions\n        // and update components\n        while (dirty_components.length) {\n            const component = dirty_components.shift();\n            set_current_component(component);\n            update(component.$$);\n        }\n        while (binding_callbacks.length)\n            binding_callbacks.pop()();\n        // then, once components are updated, call\n        // afterUpdate functions. This may cause\n        // subsequent updates...\n        for (let i = 0; i < render_callbacks.length; i += 1) {\n            const callback = render_callbacks[i];\n            if (!seen_callbacks.has(callback)) {\n                callback();\n                // ...so guard against infinite loops\n                seen_callbacks.add(callback);\n            }\n        }\n        render_callbacks.length = 0;\n    } while (dirty_components.length);\n    while (flush_callbacks.length) {\n        flush_callbacks.pop()();\n    }\n    update_scheduled = false;\n}\nfunction update($$) {\n    if ($$.fragment) {\n        $$.update($$.dirty);\n        run_all($$.before_update);\n        $$.fragment.p($$.dirty, $$.ctx);\n        $$.dirty = null;\n        $$.after_update.forEach(add_render_callback);\n    }\n}\n\nlet promise;\nfunction wait() {\n    if (!promise) {\n        promise = Promise.resolve();\n        promise.then(() => {\n            promise = null;\n        });\n    }\n    return promise;\n}\nfunction dispatch(node, direction, kind) {\n    node.dispatchEvent(custom_event(`${direction ? 'intro' : 'outro'}${kind}`));\n}\nconst outroing = new Set();\nlet outros;\nfunction group_outros() {\n    outros = {\n        r: 0,\n        c: [],\n        p: outros // parent group\n    };\n}\nfunction check_outros() {\n    if (!outros.r) {\n        run_all(outros.c);\n    }\n    outros = outros.p;\n}\nfunction transition_in(block, local) {\n    if (block && block.i) {\n        outroing.delete(block);\n        block.i(local);\n    }\n}\nfunction transition_out(block, local, detach, callback) {\n    if (block && block.o) {\n        if (outroing.has(block))\n            return;\n        outroing.add(block);\n        outros.c.push(() => {\n            outroing.delete(block);\n            if (callback) {\n                if (detach)\n                    block.d(1);\n                callback();\n            }\n        });\n        block.o(local);\n    }\n}\nconst null_transition = { duration: 0 };\nfunction create_in_transition(node, fn, params) {\n    let config = fn(node, params);\n    let running = false;\n    let animation_name;\n    let task;\n    let uid = 0;\n    function cleanup() {\n        if (animation_name)\n            delete_rule(node, animation_name);\n    }\n    function go() {\n        const { delay = 0, duration = 300, easing = identity, tick = noop, css } = config || null_transition;\n        if (css)\n            animation_name = create_rule(node, 0, 1, duration, delay, easing, css, uid++);\n        tick(0, 1);\n        const start_time = now() + delay;\n        const end_time = start_time + duration;\n        if (task)\n            task.abort();\n        running = true;\n        add_render_callback(() => dispatch(node, true, 'start'));\n        task = loop(now => {\n            if (running) {\n                if (now >= end_time) {\n                    tick(1, 0);\n                    dispatch(node, true, 'end');\n                    cleanup();\n                    return running = false;\n                }\n                if (now >= start_time) {\n                    const t = easing((now - start_time) / duration);\n                    tick(t, 1 - t);\n                }\n            }\n            return running;\n        });\n    }\n    let started = false;\n    return {\n        start() {\n            if (started)\n                return;\n            delete_rule(node);\n            if (is_function(config)) {\n                config = config();\n                wait().then(go);\n            }\n            else {\n                go();\n            }\n        },\n        invalidate() {\n            started = false;\n        },\n        end() {\n            if (running) {\n                cleanup();\n                running = false;\n            }\n        }\n    };\n}\nfunction create_out_transition(node, fn, params) {\n    let config = fn(node, params);\n    let running = true;\n    let animation_name;\n    const group = outros;\n    group.r += 1;\n    function go() {\n        const { delay = 0, duration = 300, easing = identity, tick = noop, css } = config || null_transition;\n        if (css)\n            animation_name = create_rule(node, 1, 0, duration, delay, easing, css);\n        const start_time = now() + delay;\n        const end_time = start_time + duration;\n        add_render_callback(() => dispatch(node, false, 'start'));\n        loop(now => {\n            if (running) {\n                if (now >= end_time) {\n                    tick(0, 1);\n                    dispatch(node, false, 'end');\n                    if (!--group.r) {\n                        // this will result in `end()` being called,\n                        // so we don't need to clean up here\n                        run_all(group.c);\n                    }\n                    return false;\n                }\n                if (now >= start_time) {\n                    const t = easing((now - start_time) / duration);\n                    tick(1 - t, t);\n                }\n            }\n            return running;\n        });\n    }\n    if (is_function(config)) {\n        wait().then(() => {\n            // @ts-ignore\n            config = config();\n            go();\n        });\n    }\n    else {\n        go();\n    }\n    return {\n        end(reset) {\n            if (reset && config.tick) {\n                config.tick(1, 0);\n            }\n            if (running) {\n                if (animation_name)\n                    delete_rule(node, animation_name);\n                running = false;\n            }\n        }\n    };\n}\nfunction create_bidirectional_transition(node, fn, params, intro) {\n    let config = fn(node, params);\n    let t = intro ? 0 : 1;\n    let running_program = null;\n    let pending_program = null;\n    let animation_name = null;\n    function clear_animation() {\n        if (animation_name)\n            delete_rule(node, animation_name);\n    }\n    function init(program, duration) {\n        const d = program.b - t;\n        duration *= Math.abs(d);\n        return {\n            a: t,\n            b: program.b,\n            d,\n            duration,\n            start: program.start,\n            end: program.start + duration,\n            group: program.group\n        };\n    }\n    function go(b) {\n        const { delay = 0, duration = 300, easing = identity, tick = noop, css } = config || null_transition;\n        const program = {\n            start: now() + delay,\n            b\n        };\n        if (!b) {\n            // @ts-ignore todo: improve typings\n            program.group = outros;\n            outros.r += 1;\n        }\n        if (running_program) {\n            pending_program = program;\n        }\n        else {\n            // if this is an intro, and there's a delay, we need to do\n            // an initial tick and/or apply CSS animation immediately\n            if (css) {\n                clear_animation();\n                animation_name = create_rule(node, t, b, duration, delay, easing, css);\n            }\n            if (b)\n                tick(0, 1);\n            running_program = init(program, duration);\n            add_render_callback(() => dispatch(node, b, 'start'));\n            loop(now => {\n                if (pending_program && now > pending_program.start) {\n                    running_program = init(pending_program, duration);\n                    pending_program = null;\n                    dispatch(node, running_program.b, 'start');\n                    if (css) {\n                        clear_animation();\n                        animation_name = create_rule(node, t, running_program.b, running_program.duration, 0, easing, config.css);\n                    }\n                }\n                if (running_program) {\n                    if (now >= running_program.end) {\n                        tick(t = running_program.b, 1 - t);\n                        dispatch(node, running_program.b, 'end');\n                        if (!pending_program) {\n                            // we're done\n                            if (running_program.b) {\n                                // intro — we can tidy up immediately\n                                clear_animation();\n                            }\n                            else {\n                                // outro — needs to be coordinated\n                                if (!--running_program.group.r)\n                                    run_all(running_program.group.c);\n                            }\n                        }\n                        running_program = null;\n                    }\n                    else if (now >= running_program.start) {\n                        const p = now - running_program.start;\n                        t = running_program.a + running_program.d * easing(p / running_program.duration);\n                        tick(t, 1 - t);\n                    }\n                }\n                return !!(running_program || pending_program);\n            });\n        }\n    }\n    return {\n        run(b) {\n            if (is_function(config)) {\n                wait().then(() => {\n                    // @ts-ignore\n                    config = config();\n                    go(b);\n                });\n            }\n            else {\n                go(b);\n            }\n        },\n        end() {\n            clear_animation();\n            running_program = pending_program = null;\n        }\n    };\n}\n\nfunction handle_promise(promise, info) {\n    const token = info.token = {};\n    function update(type, index, key, value) {\n        if (info.token !== token)\n            return;\n        info.resolved = key && { [key]: value };\n        const child_ctx = assign(assign({}, info.ctx), info.resolved);\n        const block = type && (info.current = type)(child_ctx);\n        if (info.block) {\n            if (info.blocks) {\n                info.blocks.forEach((block, i) => {\n                    if (i !== index && block) {\n                        group_outros();\n                        transition_out(block, 1, 1, () => {\n                            info.blocks[i] = null;\n                        });\n                        check_outros();\n                    }\n                });\n            }\n            else {\n                info.block.d(1);\n            }\n            block.c();\n            transition_in(block, 1);\n            block.m(info.mount(), info.anchor);\n            flush();\n        }\n        info.block = block;\n        if (info.blocks)\n            info.blocks[index] = block;\n    }\n    if (is_promise(promise)) {\n        const current_component = get_current_component();\n        promise.then(value => {\n            set_current_component(current_component);\n            update(info.then, 1, info.value, value);\n            set_current_component(null);\n        }, error => {\n            set_current_component(current_component);\n            update(info.catch, 2, info.error, error);\n            set_current_component(null);\n        });\n        // if we previously had a then/catch block, destroy it\n        if (info.current !== info.pending) {\n            update(info.pending, 0);\n            return true;\n        }\n    }\n    else {\n        if (info.current !== info.then) {\n            update(info.then, 1, info.value, promise);\n            return true;\n        }\n        info.resolved = { [info.value]: promise };\n    }\n}\n\nconst globals = (typeof window !== 'undefined' ? window : global);\n\nfunction destroy_block(block, lookup) {\n    block.d(1);\n    lookup.delete(block.key);\n}\nfunction outro_and_destroy_block(block, lookup) {\n    transition_out(block, 1, 1, () => {\n        lookup.delete(block.key);\n    });\n}\nfunction fix_and_destroy_block(block, lookup) {\n    block.f();\n    destroy_block(block, lookup);\n}\nfunction fix_and_outro_and_destroy_block(block, lookup) {\n    block.f();\n    outro_and_destroy_block(block, lookup);\n}\nfunction update_keyed_each(old_blocks, changed, get_key, dynamic, ctx, list, lookup, node, destroy, create_each_block, next, get_context) {\n    let o = old_blocks.length;\n    let n = list.length;\n    let i = o;\n    const old_indexes = {};\n    while (i--)\n        old_indexes[old_blocks[i].key] = i;\n    const new_blocks = [];\n    const new_lookup = new Map();\n    const deltas = new Map();\n    i = n;\n    while (i--) {\n        const child_ctx = get_context(ctx, list, i);\n        const key = get_key(child_ctx);\n        let block = lookup.get(key);\n        if (!block) {\n            block = create_each_block(key, child_ctx);\n            block.c();\n        }\n        else if (dynamic) {\n            block.p(changed, child_ctx);\n        }\n        new_lookup.set(key, new_blocks[i] = block);\n        if (key in old_indexes)\n            deltas.set(key, Math.abs(i - old_indexes[key]));\n    }\n    const will_move = new Set();\n    const did_move = new Set();\n    function insert(block) {\n        transition_in(block, 1);\n        block.m(node, next);\n        lookup.set(block.key, block);\n        next = block.first;\n        n--;\n    }\n    while (o && n) {\n        const new_block = new_blocks[n - 1];\n        const old_block = old_blocks[o - 1];\n        const new_key = new_block.key;\n        const old_key = old_block.key;\n        if (new_block === old_block) {\n            // do nothing\n            next = new_block.first;\n            o--;\n            n--;\n        }\n        else if (!new_lookup.has(old_key)) {\n            // remove old block\n            destroy(old_block, lookup);\n            o--;\n        }\n        else if (!lookup.has(new_key) || will_move.has(new_key)) {\n            insert(new_block);\n        }\n        else if (did_move.has(old_key)) {\n            o--;\n        }\n        else if (deltas.get(new_key) > deltas.get(old_key)) {\n            did_move.add(new_key);\n            insert(new_block);\n        }\n        else {\n            will_move.add(old_key);\n            o--;\n        }\n    }\n    while (o--) {\n        const old_block = old_blocks[o];\n        if (!new_lookup.has(old_block.key))\n            destroy(old_block, lookup);\n    }\n    while (n)\n        insert(new_blocks[n - 1]);\n    return new_blocks;\n}\nfunction measure(blocks) {\n    const rects = {};\n    let i = blocks.length;\n    while (i--)\n        rects[blocks[i].key] = blocks[i].node.getBoundingClientRect();\n    return rects;\n}\n\nfunction get_spread_update(levels, updates) {\n    const update = {};\n    const to_null_out = {};\n    const accounted_for = { $$scope: 1 };\n    let i = levels.length;\n    while (i--) {\n        const o = levels[i];\n        const n = updates[i];\n        if (n) {\n            for (const key in o) {\n                if (!(key in n))\n                    to_null_out[key] = 1;\n            }\n            for (const key in n) {\n                if (!accounted_for[key]) {\n                    update[key] = n[key];\n                    accounted_for[key] = 1;\n                }\n            }\n            levels[i] = n;\n        }\n        else {\n            for (const key in o) {\n                accounted_for[key] = 1;\n            }\n        }\n    }\n    for (const key in to_null_out) {\n        if (!(key in update))\n            update[key] = undefined;\n    }\n    return update;\n}\n\nconst invalid_attribute_name_character = /[\\s'\">/=\\u{FDD0}-\\u{FDEF}\\u{FFFE}\\u{FFFF}\\u{1FFFE}\\u{1FFFF}\\u{2FFFE}\\u{2FFFF}\\u{3FFFE}\\u{3FFFF}\\u{4FFFE}\\u{4FFFF}\\u{5FFFE}\\u{5FFFF}\\u{6FFFE}\\u{6FFFF}\\u{7FFFE}\\u{7FFFF}\\u{8FFFE}\\u{8FFFF}\\u{9FFFE}\\u{9FFFF}\\u{AFFFE}\\u{AFFFF}\\u{BFFFE}\\u{BFFFF}\\u{CFFFE}\\u{CFFFF}\\u{DFFFE}\\u{DFFFF}\\u{EFFFE}\\u{EFFFF}\\u{FFFFE}\\u{FFFFF}\\u{10FFFE}\\u{10FFFF}]/u;\n// https://html.spec.whatwg.org/multipage/syntax.html#attributes-2\n// https://infra.spec.whatwg.org/#noncharacter\nfunction spread(args) {\n    const attributes = Object.assign({}, ...args);\n    let str = '';\n    Object.keys(attributes).forEach(name => {\n        if (invalid_attribute_name_character.test(name))\n            return;\n        const value = attributes[name];\n        if (value === undefined)\n            return;\n        if (value === true)\n            str += \" \" + name;\n        const escaped = String(value)\n            .replace(/\"/g, '&#34;')\n            .replace(/'/g, '&#39;');\n        str += \" \" + name + \"=\" + JSON.stringify(escaped);\n    });\n    return str;\n}\nconst escaped = {\n    '\"': '&quot;',\n    \"'\": '&#39;',\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;'\n};\nfunction escape(html) {\n    return String(html).replace(/[\"'&<>]/g, match => escaped[match]);\n}\nfunction each(items, fn) {\n    let str = '';\n    for (let i = 0; i < items.length; i += 1) {\n        str += fn(items[i], i);\n    }\n    return str;\n}\nconst missing_component = {\n    $$render: () => ''\n};\nfunction validate_component(component, name) {\n    if (!component || !component.$$render) {\n        if (name === 'svelte:component')\n            name += ' this={...}';\n        throw new Error(`<${name}> is not a valid SSR component. You may need to review your build config to ensure that dependencies are compiled, rather than imported as pre-compiled modules`);\n    }\n    return component;\n}\nfunction debug(file, line, column, values) {\n    console.log(`{@debug} ${file ? file + ' ' : ''}(${line}:${column})`); // eslint-disable-line no-console\n    console.log(values); // eslint-disable-line no-console\n    return '';\n}\nlet on_destroy;\nfunction create_ssr_component(fn) {\n    function $$render(result, props, bindings, slots) {\n        const parent_component = current_component;\n        const $$ = {\n            on_destroy,\n            context: new Map(parent_component ? parent_component.$$.context : []),\n            // these will be immediately discarded\n            on_mount: [],\n            before_update: [],\n            after_update: [],\n            callbacks: blank_object()\n        };\n        set_current_component({ $$ });\n        const html = fn(result, props, bindings, slots);\n        set_current_component(parent_component);\n        return html;\n    }\n    return {\n        render: (props = {}, options = {}) => {\n            on_destroy = [];\n            const result = { head: '', css: new Set() };\n            const html = $$render(result, props, {}, options);\n            run_all(on_destroy);\n            return {\n                html,\n                css: {\n                    code: Array.from(result.css).map(css => css.code).join('\\n'),\n                    map: null // TODO\n                },\n                head: result.head\n            };\n        },\n        $$render\n    };\n}\nfunction add_attribute(name, value, boolean) {\n    if (value == null || (boolean && !value))\n        return '';\n    return ` ${name}${value === true ? '' : `=${typeof value === 'string' ? JSON.stringify(escape(value)) : `\"${value}\"`}`}`;\n}\nfunction add_classes(classes) {\n    return classes ? ` class=\"${classes}\"` : ``;\n}\n\nfunction bind(component, name, callback) {\n    if (component.$$.props.indexOf(name) === -1)\n        return;\n    component.$$.bound[name] = callback;\n    callback(component.$$.ctx[name]);\n}\nfunction mount_component(component, target, anchor) {\n    const { fragment, on_mount, on_destroy, after_update } = component.$$;\n    fragment.m(target, anchor);\n    // onMount happens before the initial afterUpdate\n    add_render_callback(() => {\n        const new_on_destroy = on_mount.map(run).filter(is_function);\n        if (on_destroy) {\n            on_destroy.push(...new_on_destroy);\n        }\n        else {\n            // Edge case - component was destroyed immediately,\n            // most likely as a result of a binding initialising\n            run_all(new_on_destroy);\n        }\n        component.$$.on_mount = [];\n    });\n    after_update.forEach(add_render_callback);\n}\nfunction destroy_component(component, detaching) {\n    if (component.$$.fragment) {\n        run_all(component.$$.on_destroy);\n        component.$$.fragment.d(detaching);\n        // TODO null out other refs, including component.$$ (but need to\n        // preserve final state?)\n        component.$$.on_destroy = component.$$.fragment = null;\n        component.$$.ctx = {};\n    }\n}\nfunction make_dirty(component, key) {\n    if (!component.$$.dirty) {\n        dirty_components.push(component);\n        schedule_update();\n        component.$$.dirty = blank_object();\n    }\n    component.$$.dirty[key] = true;\n}\nfunction init(component, options, instance, create_fragment, not_equal, prop_names) {\n    const parent_component = current_component;\n    set_current_component(component);\n    const props = options.props || {};\n    const $$ = component.$$ = {\n        fragment: null,\n        ctx: null,\n        // state\n        props: prop_names,\n        update: noop,\n        not_equal,\n        bound: blank_object(),\n        // lifecycle\n        on_mount: [],\n        on_destroy: [],\n        before_update: [],\n        after_update: [],\n        context: new Map(parent_component ? parent_component.$$.context : []),\n        // everything else\n        callbacks: blank_object(),\n        dirty: null\n    };\n    let ready = false;\n    $$.ctx = instance\n        ? instance(component, props, (key, value) => {\n            if ($$.ctx && not_equal($$.ctx[key], $$.ctx[key] = value)) {\n                if ($$.bound[key])\n                    $$.bound[key](value);\n                if (ready)\n                    make_dirty(component, key);\n            }\n        })\n        : props;\n    $$.update();\n    ready = true;\n    run_all($$.before_update);\n    $$.fragment = create_fragment($$.ctx);\n    if (options.target) {\n        if (options.hydrate) {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            $$.fragment.l(children(options.target));\n        }\n        else {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            $$.fragment.c();\n        }\n        if (options.intro)\n            transition_in(component.$$.fragment);\n        mount_component(component, options.target, options.anchor);\n        flush();\n    }\n    set_current_component(parent_component);\n}\nlet SvelteElement;\nif (typeof HTMLElement !== 'undefined') {\n    SvelteElement = class extends HTMLElement {\n        constructor() {\n            super();\n            this.attachShadow({ mode: 'open' });\n        }\n        connectedCallback() {\n            // @ts-ignore todo: improve typings\n            for (const key in this.$$.slotted) {\n                // @ts-ignore todo: improve typings\n                this.appendChild(this.$$.slotted[key]);\n            }\n        }\n        attributeChangedCallback(attr, _oldValue, newValue) {\n            this[attr] = newValue;\n        }\n        $destroy() {\n            destroy_component(this, 1);\n            this.$destroy = noop;\n        }\n        $on(type, callback) {\n            // TODO should this delegate to addEventListener?\n            const callbacks = (this.$$.callbacks[type] || (this.$$.callbacks[type] = []));\n            callbacks.push(callback);\n            return () => {\n                const index = callbacks.indexOf(callback);\n                if (index !== -1)\n                    callbacks.splice(index, 1);\n            };\n        }\n        $set() {\n            // overridden by instance, if it has props\n        }\n    };\n}\nclass SvelteComponent {\n    $destroy() {\n        destroy_component(this, 1);\n        this.$destroy = noop;\n    }\n    $on(type, callback) {\n        const callbacks = (this.$$.callbacks[type] || (this.$$.callbacks[type] = []));\n        callbacks.push(callback);\n        return () => {\n            const index = callbacks.indexOf(callback);\n            if (index !== -1)\n                callbacks.splice(index, 1);\n        };\n    }\n    $set() {\n        // overridden by instance, if it has props\n    }\n}\nclass SvelteComponentDev extends SvelteComponent {\n    constructor(options) {\n        if (!options || (!options.target && !options.$$inline)) {\n            throw new Error(`'target' is a required option`);\n        }\n        super();\n    }\n    $destroy() {\n        super.$destroy();\n        this.$destroy = () => {\n            console.warn(`Component was already destroyed`); // eslint-disable-line no-console\n        };\n    }\n}\n\nexport { HtmlTag, SvelteComponent, SvelteComponentDev, SvelteElement, add_attribute, add_classes, add_flush_callback, add_location, add_render_callback, add_resize_listener, add_transform, afterUpdate, append, assign, attr, beforeUpdate, bind, binding_callbacks, blank_object, bubble, check_outros, children, claim_element, claim_text, clear_loops, component_subscribe, createEventDispatcher, create_animation, create_bidirectional_transition, create_in_transition, create_out_transition, create_slot, create_ssr_component, current_component, custom_event, debug, destroy_block, destroy_component, destroy_each, detach, dirty_components, each, element, element_is, empty, escape, escaped, exclude_internal_props, fix_and_destroy_block, fix_and_outro_and_destroy_block, fix_position, flush, getContext, get_binding_group_value, get_current_component, get_slot_changes, get_slot_context, get_spread_update, get_store_value, globals, group_outros, handle_promise, identity, init, insert, intros, invalid_attribute_name_character, is_client, is_function, is_promise, listen, loop, measure, missing_component, mount_component, noop, not_equal, now, null_to_empty, object_without_properties, onDestroy, onMount, once, outro_and_destroy_block, prevent_default, raf, run, run_all, safe_not_equal, schedule_update, select_multiple_value, select_option, select_options, select_value, self, setContext, set_attributes, set_current_component, set_custom_element_data, set_data, set_input_type, set_input_value, set_now, set_raf, set_style, space, spread, stop_propagation, subscribe, svg_element, text, tick, time_ranges_to_array, to_number, toggle_class, transition_in, transition_out, update_keyed_each, validate_component, validate_store, xlink_attr };\n","import { safe_not_equal, noop, run_all, is_function } from '../internal';\nexport { get_store_value as get } from '../internal';\n\nconst subscriber_queue = [];\n/**\n * Creates a `Readable` store that allows reading by subscription.\n * @param value initial value\n * @param {StartStopNotifier}start start and stop notifications for subscriptions\n */\nfunction readable(value, start) {\n    return {\n        subscribe: writable(value, start).subscribe,\n    };\n}\n/**\n * Create a `Writable` store that allows both updating and reading by subscription.\n * @param {*=}value initial value\n * @param {StartStopNotifier=}start start and stop notifications for subscriptions\n */\nfunction writable(value, start = noop) {\n    let stop;\n    const subscribers = [];\n    function set(new_value) {\n        if (safe_not_equal(value, new_value)) {\n            value = new_value;\n            if (stop) { // store is ready\n                const run_queue = !subscriber_queue.length;\n                for (let i = 0; i < subscribers.length; i += 1) {\n                    const s = subscribers[i];\n                    s[1]();\n                    subscriber_queue.push(s, value);\n                }\n                if (run_queue) {\n                    for (let i = 0; i < subscriber_queue.length; i += 2) {\n                        subscriber_queue[i][0](subscriber_queue[i + 1]);\n                    }\n                    subscriber_queue.length = 0;\n                }\n            }\n        }\n    }\n    function update(fn) {\n        set(fn(value));\n    }\n    function subscribe(run, invalidate = noop) {\n        const subscriber = [run, invalidate];\n        subscribers.push(subscriber);\n        if (subscribers.length === 1) {\n            stop = start(set) || noop;\n        }\n        run(value);\n        return () => {\n            const index = subscribers.indexOf(subscriber);\n            if (index !== -1) {\n                subscribers.splice(index, 1);\n            }\n            if (subscribers.length === 0) {\n                stop();\n                stop = null;\n            }\n        };\n    }\n    return { set, update, subscribe };\n}\n/**\n * Derived value store by synchronizing one or more readable stores and\n * applying an aggregation function over its input values.\n * @param {Stores} stores input stores\n * @param {function(Stores=, function(*)=):*}fn function callback that aggregates the values\n * @param {*=}initial_value when used asynchronously\n */\nfunction derived(stores, fn, initial_value) {\n    const single = !Array.isArray(stores);\n    const stores_array = single\n        ? [stores]\n        : stores;\n    const auto = fn.length < 2;\n    return readable(initial_value, (set) => {\n        let inited = false;\n        const values = [];\n        let pending = 0;\n        let cleanup = noop;\n        const sync = () => {\n            if (pending) {\n                return;\n            }\n            cleanup();\n            const result = fn(single ? values[0] : values, set);\n            if (auto) {\n                set(result);\n            }\n            else {\n                cleanup = is_function(result) ? result : noop;\n            }\n        };\n        const unsubscribers = stores_array.map((store, i) => store.subscribe((value) => {\n            values[i] = value;\n            pending &= ~(1 << i);\n            if (inited) {\n                sync();\n            }\n        }, () => {\n            pending |= (1 << i);\n        }));\n        inited = true;\n        sync();\n        return function stop() {\n            run_all(unsubscribers);\n            cleanup();\n        };\n    });\n}\n\nexport { derived, readable, writable };\n","/**\n * Class representing a vector in 4D space\n */\nexport default class Vector {\n  /**\n   * Create a vector\n   * @param  {number} x - The x component\n   * @param  {number} y - The y component\n   * @param  {number} z - The z component\n   * @param  {number} w - The w component\n   */\n  constructor(x, y, z, w) {\n    this.x = x;\n    this.y = y;\n    this.z = z;\n    this.w = w;\n  }\n\n  /**\n   * Returns the x component of the vector\n   * @return {number} The x component of the vector\n   */\n  get x() {\n    return this._x;\n  }\n\n  /**\n   * Sets the x component of the vector to val\n   * @param  {number} val - The new value\n   */\n  set x(val) {\n    this._x = val;\n  }\n\n  /**\n   * Returns the first component of the vector\n   * @return {number} The first component of the vector\n   */\n  get r() {\n    return this.x;\n  }\n\n  /**\n   * Sets the first component of the vector to val\n   * @param  {number} val - The new value\n   */\n  set r(val) {\n    this.x = val;\n  }\n\n  /**\n   * Returns the y component of the vector\n   * @return {number} The y component of the vector\n   */\n  get y() {\n    return this._y;\n  }\n\n  /**\n   * Sets the y component of the vector to val\n   * @param  {number} val - The new value\n   */\n  set y(val) {\n    this._y = val;\n  }\n\n  /**\n   * Returns the second component of the vector\n   * @return {number} The second component of the vector\n   */\n  get g() {\n    return this.y;\n  }\n\n  /**\n   * Sets the second component of the vector to val\n   * @param  {number} val - The new value\n   */\n  set g(val) {\n    this.y = val;\n  }\n\n  /**\n   * Returns the z component of the vector\n   * @return {number} The z component of the vector\n   */\n  get z() {\n    return this._z;\n  }\n\n  /**\n   * Sets the z component of the vector to val\n   * @param  {number} val - The new value\n   */\n  set z(val) {\n    this._z = val;\n  }\n\n  /**\n   * Returns the third component of the vector\n   * @return {number} The third component of the vector\n   */\n  get b() {\n    return this.z;\n  }\n\n  /**\n   * Sets the third component of the vector to val\n   * @param  {number} val - The new value\n   */\n  set b(val) {\n    this.z = val;\n  }\n\n  /**\n   * Returns the w component of the vector\n   * @return {number} The w component of the vector\n   */\n  get w() {\n    return this._w;\n  }\n\n  /**\n   * Sets the w component of the vector to val\n   * @param  {number} val - The new value\n   */\n  set w(val) {\n    this._w = val;\n  }\n\n  /**\n   * Returns the fourth component of the vector\n   * @return {number} The fourth component of the vector\n   */\n  get a() {\n    return this.w;\n  }\n\n  /**\n   * Sets the fourth component of the vector to val\n   * @param  {number} val - The new value\n   */\n  set a(val) {\n    this.w = val;\n  }\n\n  /**\n   * Creates a new vector with the vector added\n   * @param {Vector} other - The vector to add\n   * @return {Vector}        The new vector;\n   */\n  add(other) {\n    return new Vector(\n      this.x + other.x,\n      this.y + other.y,\n      this.z + other.z,\n      1);\n  }\n\n  /**\n   * Creates a new vector with the vector subtracted\n   * @param {Vector} other - The vector to subtract\n   * @return {Vector}        The new vector\n   */\n  sub(other) {\n    return new Vector(\n      this.x - other.x,\n      this.y - other.y,\n      this.z - other.z,\n      1);\n  }\n\n  /**\n   * Creates a new vector with the scalar multiplied\n   * @param {number} other - The scalar to multiply\n   * @return {Vector}        The new vector\n   */\n  mul(other) {\n    return new Vector(\n      this.x * other,\n      this.y * other,\n      this.z * other,\n      1);\n  }\n\n  /**\n * Creates a new vector with the scalar multiplied\n * @param {Vector} other - The vector to multiply\n * @return {Vector}        The new vector\n */\n  elementMul(other) {\n    return new Vector(\n      this.x * other.x,\n      this.y * other.y,\n      this.z * other.z,\n      1);\n  }\n\n  /**\n   * Creates a new vector with the scalar divided\n   * @param {number} other - The scalar to divide\n   * @return {Vector}        The new vector\n   */\n  div(other) {\n    return new Vector(\n      this.x / other,\n      this.y / other,\n      this.z / other,\n      1);\n  }\n\n  /**\n   * Dot product\n   * @param {Vector} other - The vector to calculate the dot product with\n   * @return {number}        The result of the dot product\n   */\n  dot(other) {\n    return this.x * other.x + this.y * other.y + this.z * other.z;\n  }\n\n  /**\n   * Cross product\n   * @param {Vector} other - The vector to calculate the cross product with\n   * @return {Vector}        The result of the cross product as new Vector\n   */\n  cross(other) {\n    return new Vector(\n      this.y * other.z - this.z * other.y,\n      this.z * other.x - this.x * other.z,\n      this.x * other.y - this.y * other.x,\n      1 //TODO: is this right?\n    );\n  }\n\n  /**\n   * Returns an array representation of the vector\n   * @return {Array.<number>} An array representation.\n   */\n  valueOf() {\n    return [this.x, this.y, this.z, this.w];\n  }\n\n  /**\n   * Creates a new vector by normalising the vector\n   * @return {Vector} A vector with length 1\n   */\n  normalised() {\n    return this.div(this.length);\n  }\n\n  /**\n   * Compares the vector to another\n   * @param  {Vector} other - The vector to compare to.\n   * @return {Boolean}        True if the vectors carry equal numbers. The fourth element may be both equivalent to undefined to still return true.\n   */\n  equals(other) {\n    return (this.x === other.x && this.y === other.y && this.z === other.z && this.w === other.w)\n  }\n\n  /**\n   * Calculates the length of the vector\n   * @return {number} The length of the vector\n   */\n  get length() {\n    return Math.sqrt(this._x * this._x + this._y * this._y + this._z * this._z);\n  }\n}","import Vector from './vector.js';\n\n/**\n * Class representing a 4x4 Matrix\n */\nexport default class Matrix {\n  /**\n   * Constructor of the matrix. Expects an array in row-major layout. Saves the data as column major internally.\n   * @param  {Array.<number>} mat - Matrix values row major\n   */\n  constructor(mat) {\n    this.data = new Float32Array(16);\n    for (let row = 0; row < 4; row++) {\n      for (let col = 0; col < 4; col++) {\n        this.data[row * 4 + col] = mat[col * 4 + row];\n      }\n    }\n  }\n\n  getLeftVector() {\n    return new Vector(this.getVal(0, 0), this.getVal(1, 0), this.getVal(2, 0), 0);\n  }\n\n  getUpVector() {\n    return new Vector(this.getVal(0, 1), this.getVal(1, 1), this.getVal(2, 1), 0);\n  }\n\n  getForwardVector() {\n    return new Vector(this.getVal(0, 2), this.getVal(1, 2), this.getVal(2, 2), 0);\n  }\n\n  getTranslationVector() {\n    return new Vector(this.getVal(0, 3), this.getVal(1, 3), this.getVal(2, 3), 0);\n  }\n\n  /**\n   * Returns the value of the matrix at position row, col\n   * @param  {number} row - The value's row\n   * @param  {number} col - The value's column\n   * @return {number}       The requested value\n   */\n  getVal(row, col) {\n    return this.data[col * 4 + row];\n  }\n\n  /**\n   * Sets the value of the matrix at position row, col\n   * @param {number} row - The value's row\n   * @param {number} val - The value to set to\n   * @param {number} col - The value's column\n   */\n  setVal(row, col, val) {\n    this.data[col * 4 + row] = val;\n  }\n\n  /**\n   * Returns a matrix that represents a translation\n   * @param  {Vector} translation - The translation vector that shall be expressed by the matrix\n   * @return {Matrix}               The resulting translation matrix\n   */\n  static translation(translation) {\n    return new Matrix([\n      1, 0, 0, translation.x,\n      0, 1, 0, translation.y,\n      0, 0, 1, translation.z,\n      0, 0, 0, 1]);\n  }\n\n  /**\n   * Returns a matrix that represents a rotation. The rotation axis is either the x, y or z axis (either x, y, z is 1).\n   * @param  {Vector} axis  - The axis to rotate around\n   * @param  {number} angle - The angle to rotate\n   * @return {Matrix}         The resulting rotation matrix\n   */\n  static rotation(axis, angle) {\n    const result = this.identity();\n    angle = angle * Math.PI / 180;\n    if (axis.x === 1) {\n      result.setVal(1, 1, Math.cos(angle));\n      result.setVal(2, 1, Math.sin(angle));\n      result.setVal(1, 2, -Math.sin(angle));\n      result.setVal(2, 2, Math.cos(angle));\n    } else if (axis.y === 1) {\n      result.setVal(0, 0, Math.cos(angle));\n      result.setVal(0, 2, Math.sin(angle));\n      result.setVal(2, 0, -Math.sin(angle));\n      result.setVal(2, 2, Math.cos(angle));\n    } else if (axis.z === 1) {\n      result.setVal(0, 0, Math.cos(angle));\n      result.setVal(0, 1, -Math.sin(angle));\n      result.setVal(1, 0, Math.sin(angle));\n      result.setVal(1, 1, Math.cos(angle));\n    }\n    return result;\n  }\n\n  /**\n   * Returns a matrix that represents a scaling\n   * @param  {Vector} scale - The amount to scale in each direction\n   * @return {Matrix}         The resulting scaling matrix\n   */\n  static scaling(scale) {\n    return new Matrix([\n      scale.x, 0, 0, 0,\n      0, scale.y, 0, 0,\n      0, 0, scale.z, 0,\n      0, 0, 0, 1\n    ]);\n  }\n\n  /**\n   * Constructs a lookat matrix\n   * @param  {Vector} eye    - The position of the viewer\n   * @param  {Vector} center - The position to look at\n   * @param  {Vector} up     - The up direction\n   * @return {Matrix}          The resulting lookat matrix\n   */\n  static lookat(eye, center, up) {\n    const forward = new Vector(\n      center.x - eye.x,\n      center.y - eye.y,\n      center.z - eye.z,\n      1).normalised();\n    const right = forward.cross(up).normalised();\n    const upReal = right.cross(forward).normalised();\n    return new Matrix(\n      [right.x, right.y, right.z, -right.dot(eye),\n      upReal.x, upReal.y, upReal.z, -upReal.dot(eye),\n      -forward.x, -forward.y, -forward.z, forward.dot(eye),\n        0, 0, 0, 1]);\n  }\n\n  /**\n   * Constructs a new matrix that represents a projection normalisation transformation\n   * @param  {number} left   - Camera-space left value of lower near point\n   * @param  {number} right  - Camera-space right value of upper right far point\n   * @param  {number} bottom - Camera-space bottom value of lower lower near point\n   * @param  {number} top    - Camera-space top value of upper right far point\n   * @param  {number} near   - Camera-space near value of lower lower near point\n   * @param  {number} far    - Camera-space far value of upper right far point\n   * @return {Matrix}          The rotation matrix\n   */\n  static frustum(left, right, bottom, top, near, far) {\n    return new Matrix(\n      [((2 * near) / (right - left)), 0, ((right + left) / (right - left)), 0,\n        0, ((2 * near) / (top - bottom)), ((top + bottom) / (top - bottom)), 0,\n        0, 0, -((far + near) / (far - near)), -((2 * far * near) / (far - near)),\n        0, 0, -1, 0\n      ])\n  }\n\n  /**\n   * Constructs a new matrix that represents a projection normalisation transformation.\n   * @param  {number} fovy   - Field of view in y-direction\n   * @param  {number} aspect - Aspect ratio between width and height\n   * @param  {number} near   - Camera-space distance to near plane\n   * @param  {number} far    - Camera-space distance to far plane\n   * @return {Matrix}          The resulting matrix\n   */\n  static perspective(fovy, aspect, near, far) {\n    const f = 1.0 / Math.tan(fovy * Math.PI / 180 / 2.0);\n    return new Matrix([\n      f / aspect, 0, 0, 0,\n      0, f, 0, 0,\n      0, 0, ((far + near) / (near - far)), ((2 * far * near) / (near - far)),\n      0, 0, -1, 0\n    ]);\n  }\n\n  /**\n   * Returns the identity matrix\n   * @return {Matrix} A new identity matrix\n   */\n  static identity() {\n    return new Matrix([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1]);\n  }\n\n  /**\n   * Matrix multiplication\n   * @param  {Matrix|Vector} other - The matrix or vector to multiplicate with\n   * @return {Matrix|Vector}         The result of the multiplication this*other\n   */\n  mul(other) {\n    if (other instanceof Matrix) {\n      const result = new Matrix([]);\n      for (let i = 0; i < 4; i++) {\n        for (let j = 0; j < 4; j++) {\n          let newVal = 0;\n          for (let k = 0; k < 4; k++) {\n            newVal += this.getVal(i, k) * other.getVal(k, j);\n          }\n          result.setVal(i, j, newVal);\n        }\n      }\n      return result;\n    } else {\n      const result = new Vector(0, 0, 0, 0);\n      result.x =\n        this.getVal(0, 0) * other.x +\n        this.getVal(0, 1) * other.y +\n        this.getVal(0, 2) * other.z +\n        this.getVal(0, 3) * other.w;\n      result.y =\n        this.getVal(1, 0) * other.x +\n        this.getVal(1, 1) * other.y +\n        this.getVal(1, 2) * other.z +\n        this.getVal(1, 3) * other.w;\n      result.z =\n        this.getVal(2, 0) * other.x +\n        this.getVal(2, 1) * other.y +\n        this.getVal(2, 2) * other.z +\n        this.getVal(2, 3) * other.w;\n      result.w =\n        this.getVal(3, 0) * other.x +\n        this.getVal(3, 1) * other.y +\n        this.getVal(3, 2) * other.z +\n        this.getVal(3, 3) * other.w;\n      return result;\n    }\n  }\n\n  /**\n   * Returns the transpose of this matrix\n   * @return {Matrix} A new matrix that is the transposed of this\n   */\n  transpose() {\n    return new Matrix(this.data);\n  }\n\n  /**\n   * Debug print to console\n   */\n  print() {\n    for (let row = 0; row < 4; row++) {\n      console.log(\n        '> ' +\n        this.getVal(row, 0) +\n        '\\t' +\n        this.getVal(row, 1) +\n        '\\t' +\n        this.getVal(row, 2) +\n        '\\t' +\n        this.getVal(row, 3)\n      );\n    }\n  }\n\n  /**\n   * Returns a new matrix that is the inverse of this matrix\n   * @return {Matrix} The inverse matrix\n   */\n  invert() {\n    let mat = this.data;\n    let dst = new Float32Array(16); //ret.getValues();\n    let tmp = new Float32Array(12);\n\n    /* temparray for pairs */\n    let src = new Float32Array(16); //new float[16];\n\n    /* array of transpose source matrix */\n    let det;\n\n    /* determinant */\n    /*\n     * transpose matrix\n     */\n    for (let i = 0; i < 4; i++) {\n      src[i] = mat[i * 4];\n      src[i + 4] = mat[i * 4 + 1];\n      src[i + 8] = mat[i * 4 + 2];\n      src[i + 12] = mat[i * 4 + 3];\n    }\n\n    /* calculate pairs for first 8 elements (cofactors) */\n    tmp[0] = src[10] * src[15];\n    tmp[1] = src[11] * src[14];\n    tmp[2] = src[9] * src[15];\n    tmp[3] = src[11] * src[13];\n    tmp[4] = src[9] * src[14];\n    tmp[5] = src[10] * src[13];\n    tmp[6] = src[8] * src[15];\n    tmp[7] = src[11] * src[12];\n    tmp[8] = src[8] * src[14];\n    tmp[9] = src[10] * src[12];\n    tmp[10] = src[8] * src[13];\n    tmp[11] = src[9] * src[12];\n\n    /* calculate first 8 elements (cofactors) */\n    dst[0] = tmp[0] * src[5] + tmp[3] * src[6] + tmp[4] * src[7];\n    dst[0] -= tmp[1] * src[5] + tmp[2] * src[6] + tmp[5] * src[7];\n    dst[1] = tmp[1] * src[4] + tmp[6] * src[6] + tmp[9] * src[7];\n    dst[1] -= tmp[0] * src[4] + tmp[7] * src[6] + tmp[8] * src[7];\n    dst[2] = tmp[2] * src[4] + tmp[7] * src[5] + tmp[10] * src[7];\n    dst[2] -= tmp[3] * src[4] + tmp[6] * src[5] + tmp[11] * src[7];\n    dst[3] = tmp[5] * src[4] + tmp[8] * src[5] + tmp[11] * src[6];\n    dst[3] -= tmp[4] * src[4] + tmp[9] * src[5] + tmp[10] * src[6];\n    dst[4] = tmp[1] * src[1] + tmp[2] * src[2] + tmp[5] * src[3];\n    dst[4] -= tmp[0] * src[1] + tmp[3] * src[2] + tmp[4] * src[3];\n    dst[5] = tmp[0] * src[0] + tmp[7] * src[2] + tmp[8] * src[3];\n    dst[5] -= tmp[1] * src[0] + tmp[6] * src[2] + tmp[9] * src[3];\n    dst[6] = tmp[3] * src[0] + tmp[6] * src[1] + tmp[11] * src[3];\n    dst[6] -= tmp[2] * src[0] + tmp[7] * src[1] + tmp[10] * src[3];\n    dst[7] = tmp[4] * src[0] + tmp[9] * src[1] + tmp[10] * src[2];\n    dst[7] -= tmp[5] * src[0] + tmp[8] * src[1] + tmp[11] * src[2];\n\n    /* calculate pairs for second 8 elements (cofactors) */\n    tmp[0] = src[2] * src[7];\n    tmp[1] = src[3] * src[6];\n    tmp[2] = src[1] * src[7];\n    tmp[3] = src[3] * src[5];\n    tmp[4] = src[1] * src[6];\n    tmp[5] = src[2] * src[5];\n    tmp[6] = src[0] * src[7];\n    tmp[7] = src[3] * src[4];\n    tmp[8] = src[0] * src[6];\n    tmp[9] = src[2] * src[4];\n    tmp[10] = src[0] * src[5];\n    tmp[11] = src[1] * src[4];\n\n    /* calculate second 8 elements (cofactors) */\n    dst[8] = tmp[0] * src[13] + tmp[3] * src[14] + tmp[4] * src[15];\n    dst[8] -= tmp[1] * src[13] + tmp[2] * src[14] + tmp[5] * src[15];\n    dst[9] = tmp[1] * src[12] + tmp[6] * src[14] + tmp[9] * src[15];\n    dst[9] -= tmp[0] * src[12] + tmp[7] * src[14] + tmp[8] * src[15];\n    dst[10] = tmp[2] * src[12] + tmp[7] * src[13] + tmp[10] * src[15];\n    dst[10] -= tmp[3] * src[12] + tmp[6] * src[13] + tmp[11] * src[15];\n    dst[11] = tmp[5] * src[12] + tmp[8] * src[13] + tmp[11] * src[14];\n    dst[11] -= tmp[4] * src[12] + tmp[9] * src[13] + tmp[10] * src[14];\n    dst[12] = tmp[2] * src[10] + tmp[5] * src[11] + tmp[1] * src[9];\n    dst[12] -= tmp[4] * src[11] + tmp[0] * src[9] + tmp[3] * src[10];\n    dst[13] = tmp[8] * src[11] + tmp[0] * src[8] + tmp[7] * src[10];\n    dst[13] -= tmp[6] * src[10] + tmp[9] * src[11] + tmp[1] * src[8];\n    dst[14] = tmp[6] * src[9] + tmp[11] * src[11] + tmp[3] * src[8];\n    dst[14] -= tmp[10] * src[11] + tmp[2] * src[8] + tmp[7] * src[9];\n    dst[15] = tmp[10] * src[10] + tmp[4] * src[8] + tmp[9] * src[9];\n    dst[15] -= tmp[8] * src[9] + tmp[11] * src[10] + tmp[5] * src[8];\n\n    /* calculate determinant */\n    det = src[0] * dst[0] + src[1] * dst[1] + src[2] * dst[2] + src[3] * dst[3];\n\n    if (det == 0.0) {\n      throw new Error('singular matrix is not invertible');\n    }\n\n    /* calculate matrix inverse */\n    det = 1 / det;\n\n    for (let j = 0; j < 16; j++) {\n      dst[j] *= det;\n    }\n\n    let ret = Matrix.identity();\n    ret.data = dst;\n    return ret;\n  }\n}\n","/**\n * Class representing a ray-sphere intersection in 3D space\n */\nexport default class Intersection {\n  /**\n   * Create an Intersection\n   * @param {number} t      - The distance on the ray\n   * @param {Vector} point  - The intersection points\n   * @param {Vector} normal - The normal in the intersection\n   */\n  constructor(t, point, normal) {\n    if (t) {\n      this.t = t;\n    } else {\n      this.t = Infinity;\n    }\n    this.point = point;\n    this.normal = normal;\n  }\n\n  /**\n   * Determines whether this intersection\n   * is closer than the other\n   * @param  {Intersection} other - The other Intersection\n   * @return {Boolean}              The result\n   */\n  closerThan(other) {\n    if (this.t < other.t) return true;\n    else return false;\n  }\n}","import Matrix from '../math/matrix.js';\nimport Vector from \"../math/vector.js\"\nimport Intersection from \"../renderer/raytracer/intersection.js\";\n\n/**\n * Class representing a Node in a Scenegraph\n */\nclass Node {\n\n  constructor(id) {\n    this.id = id;\n  }\n\n  /**\n   * Accepts a visitor according to the visitor pattern\n   * @param  {Visitor} visitor - The visitor\n   */\n  accept(visitor) {\n    visitor.visit(this);\n  }\n}\n\n/**\n * Class representing a GroupNode in the Scenegraph.\n * A GroupNode holds a transformation and is able\n * to have child nodes attached to it.\n * @extends Node\n */\nexport class GroupNode extends Node {\n  /**\n    * Constructor\n    * @param  {string} id - The id of this node\n    * @param  {Matrix} mat - A matrix describing the node's transformation\n  */\n  constructor(id, mat) {\n    super(id);\n    this.matrix = mat;\n    this.children = new Array();\n  }\n\n  /**\n   * Adds a child node\n   * @param {Node} childNode - The child node to add\n   */\n  add(childNode) {\n    this.children.push(childNode);\n  }\n\n  accept(visitor) {\n    visitor.visitGroupNode(this);\n  }\n\n  toJSON() {\n    return {\n      id: this.id,\n      type: this.constructor.name,\n      matrix: this.matrix,\n      children: this.children\n    };\n  }\n\n  find(nodeId) {\n    if (this.id === nodeId) {\n      return this;\n    }\n    if (this.children.length === 0) {\n      return null;\n    }\n    for (let child of this.children.filter(c => c instanceof GroupNode)) {\n      const childResult = child.find(nodeId);\n      if (childResult) {\n        return childResult;\n      }\n    }\n    return null;\n  }\n\n  static fromJSON(obj) {\n    const matrix = new Matrix([]);\n    matrix.data = obj.matrix.data;\n    const result = new GroupNode(obj.id, matrix);\n    result.children = obj.children.map(child => nodeClasses[child.type].fromJSON(child));\n    return result;\n  }\n}\n\n/**\n * Class representing a Sphere in the Scenegraph\n * @extends Node\n */\nexport class SphereNode extends Node {\n  /**\n    * Creates a new Sphere with center and radius\n    * @param  {string} id - The id of this node\n    * @param  {Vector} center - The center of the Sphere\n    * @param  {number} radius - The radius of the Sphere\n    * @param  {Vector} color  - The colour of the Sphere\n  */\n  constructor(id, center, radius, color, color2) {\n    super(id);\n    this.center = center;\n    this.radius = radius;\n    this.color = color;\n    this.color2 = color2;\n  }\n\n  toJSON() {\n    return {\n      id: this.id,\n      type: this.constructor.name,\n      center: this.center,\n      radius: this.radius,\n      color: this.color,\n      color2: this.color2\n    }\n  }\n\n  static fromJSON(obj) {\n    if (obj.color2) {\n      const col2 = new Vector(obj.color2._x, obj.color2._y, obj.color2._z, obj.color2._w);\n      return new SphereNode(obj.id,\n        new Vector(obj.center._x, obj.center._y, obj.center._z, obj.center._w),\n        obj.radius,\n        new Vector(obj.color._x, obj.color._y, obj.color._z, obj.color._w),\n        col2);\n    }\n    return new SphereNode(obj.id,\n      new Vector(obj.center._x, obj.center._y, obj.center._z, obj.center._w),\n      obj.radius,\n      new Vector(obj.color._x, obj.color._y, obj.color._z, obj.color._w));\n  }\n}\n\n/**\n * Class representing an Axis Aligned Box in the Scenegraph\n * @extends Node\n */\nexport class AABoxNode extends Node {\n  /**\n    * Creates an axis aligned box\n    * @param  {string} id - The id of this node\n    * @param  {Vector} minPoint - The minimum Point\n    * @param  {Vector} center - The maximum Point\n    * @param  {Vector} color    - The colour of the cube\n  */\n  constructor(id, minPoint, center, color) {\n    super(id);\n    this.minPoint = minPoint;\n    this.center = center;\n    this.color = color;\n  }\n\n  toJSON() {\n    return {\n      id: this.id,\n      type: this.constructor.name,\n      minPoint: this.minPoint,\n      center: this.center,\n      color: this.color\n    }\n  }\n\n  static fromJSON(obj) {\n    const minPoint = new Vector(obj.minPoint._x, obj.minPoint._y, obj.minPoint._z, obj.minPoint._w);\n    const center = new Vector(obj.center._x, obj.center._y, obj.center._z, obj.center._w);\n    const color = new Vector(obj.color._x, obj.color._y, obj.color._z, obj.color._w);\n    return new AABoxNode(obj.id, minPoint, center, color);\n  }\n}\n\n\n/**\n * Class representing a Textured Axis Aligned Box in the Scenegraph\n * @extends Node\n */\nexport class TextureBoxNode extends Node {\n  /**\n    * Creates an axis aligned box textured box\n    * @param  {string} id - The id of this node\n    * @param  {Vector} minPoint - The minimum Point\n    * @param  {Vector} center - The maximum Point\n    * @param  {string} texture  - The image filename for the texture\n  */\n  constructor(id, minPoint, center, texture, normalMap) {\n    super(id);\n    this.minPoint = minPoint;\n    this.center = center;\n    this.texture = texture;\n    this.normalMap = normalMap;\n  }\n\n  toJSON() {\n    return {\n      id: this.id,\n      type: this.constructor.name,\n      minPoint: this.minPoint,\n      center: this.center,\n      texture: this.texture,\n      normalMap: this.normalMap\n    }\n  }\n\n  static fromJSON(obj) {\n    const minPoint = new Vector(obj.minPoint._x, obj.minPoint._y, obj.minPoint._z, obj.minPoint._w);\n    const center = new Vector(obj.center._x, obj.center._y, obj.center._z, obj.center._w);\n    return new TextureBoxNode(obj.id, minPoint, center, obj.texture, obj.normalMap);\n  }\n}\n\n/**\n * Class representing a Pyramid node in the Scenegraph\n * @extends Node\n */\nexport class PyramidNode extends Node {\n  /**\n    * Creates an axis aligned box textured box\n    * @param  {string} id - The id of this node\n    * @param  {Vector} minPoint - The minimum Point\n    * @param  {Vector} center - The maximum Point\n    * @param  {string} texture  - The image filename for the texture\n  */\n  constructor(id, minPoint, center, height, color) {\n    super(id);\n    this.minPoint = minPoint;\n    this.center = center;\n    this.height = height;\n    this.color = color;\n  }\n\n  toJSON() {\n    return {\n      id: this.id,\n      type: this.constructor.name,\n      minPoint: this.minPoint,\n      center: this.center,\n      height: this.height,\n      color: this.color,\n    }\n  }\n\n  static fromJSON(obj) {\n    const minPoint = new Vector(obj.minPoint._x, obj.minPoint._y, obj.minPoint._z, obj.minPoint._w);\n    const center = new Vector(obj.center._x, obj.center._y, obj.center._z, obj.center._w);\n    const color = new Vector(obj.color._x, obj.color._y, obj.color._z, obj.color._w);\n    return new PyramidNode(obj.id, minPoint, center, obj.height, color);\n  }\n}\n\nexport class CameraNode extends Node {\n\n  /**\n    * Creates a camera node\n    * @param  {string} id - The id of this node\n    * @param  {Vector} eye - The eye position relative to center\n    * @param  {Vector} center - The center\n    * @param  {Vector} up  - The up vector relative to center\n    * @param  {number} fovy  - The field of view in y-axis\n    * @param  {number} aspect  - The aspect ratio\n    * @param  {number} near  - The distance where rendering begins\n    * @param  {number} far  - The distance where rendering stops\n */\n  constructor(id, eye, center, up, fovy, aspect, near, far) {\n    super(id);\n    this.eye = eye;\n    this.center = center;\n    this.up = up;\n    this.fovy = fovy;\n    this.aspect = aspect;\n    this.near = near;\n    this.far = far;\n  }\n\n  toJSON() {\n    return {\n      id: this.id,\n      type: this.constructor.name,\n      eye: this.eye,\n      center: this.center,\n      up: this.up,\n      fovy: this.fovy,\n      aspect: this.aspect,\n      near: this.near,\n      far: this.far,\n    }\n  }\n\n  accept(visitor) {\n    visitor.visitCameraNode(this);\n  }\n\n  static fromJSON(obj) {\n    const eye = new Vector(obj.eye._x, obj.eye._y, obj.eye._z, obj.eye._w);\n    const center = new Vector(obj.center._x, obj.center._y, obj.center._z, obj.center._w);\n    const up = new Vector(obj.up._x, obj.up._y, obj.up._z, obj.up._w);\n    const fovy = obj.fovy;\n    const aspect = obj.aspect;\n    const near = obj.near;\n    const far = obj.far;\n    return new CameraNode(obj.id, eye, center, up, fovy, aspect, near, far);\n  }\n}\n\nexport class LightNode extends Node {\n\n  /**\n    * Creates a light node\n    * @param  {string} id - The id of this node\n    * @param  {Vector} color - The light color\n */\n  constructor(id, color) {\n    super(id);\n    this.color = color;\n  }\n\n  toJSON() {\n    return {\n      id: this.id,\n      type: this.constructor.name,\n      color: this.color,\n    }\n  }\n\n  accept(visitor) {\n    visitor.visitLightNode(this);\n  }\n\n  static fromJSON(obj) {\n    const color = new Vector(obj.color._x, obj.color._y, obj.color._z, obj.color._w);\n    return new LightNode(obj.id, color);\n  }\n}\n\nexport class MeshNode extends Node {\n  /**\n    * Creates a light node\n    * @param  {string} id - The id of this node\n    * @param  {string} url - The url to load the mesh from\n    * @param  {Vector} color - The light color\n */\n  constructor(id, url, color) {\n    super(id);\n    this.url = url;\n    this.color = color;\n  }\n\n  toJSON() {\n    return {\n      id: this.id,\n      type: this.constructor.name,\n      url: this.url,\n      color: this.color,\n    }\n  }\n\n  static fromJSON(obj) {\n    const url = obj.url;\n    const color = new Vector(obj.color._x, obj.color._y, obj.color._z, obj.color._w);\n    return new MeshNode(obj.id, url, color);\n  }\n}\n\nexport const nodeClasses = {\n  \"GroupNode\": GroupNode,\n  \"SphereNode\": SphereNode,\n  \"AABoxNode\": AABoxNode,\n  \"TextureBoxNode\": TextureBoxNode,\n  \"PyramidNode\": PyramidNode,\n  \"CameraNode\": CameraNode,\n  \"LightNode\": LightNode,\n  \"MeshNode\": MeshNode,\n}","import { writable } from 'svelte/store';\nimport { GroupNode } from '../scenegraph/nodes.js';\nimport Matrix from '../math/matrix.js';\n\nconst createSceneGraph = () => {\n  const { subscribe, update, set } = writable(new GroupNode(Matrix.identity()));\n\n  return {\n    subscribe,\n    set,\n    add: (node) => update(sg => { sg.add(node); return sg }),\n    remove: (toRemove) => update(sg => {\n      const stack = [];\n      sg.children = sg.children.filter(n => n.id != toRemove);\n      stack.push.apply(stack, sg.children);\n      while (stack.length > 0) {\n        const node = stack.pop();\n        if (node instanceof GroupNode) {\n          node.children = node.children.filter(n => n.id != toRemove);\n          stack.push.apply(stack, node.children);\n        }\n      }\n      return sg;\n    }),\n  }\n}\n\nconst createAnimationNodes = () => {\n  const { subscribe, update, set } = writable([]);\n\n  return {\n    subscribe,\n    set,\n    add: (node) => update(nodes => [...nodes, node]),\n    remove: (node) => update(nodes => nodes.filter((_, i) => i !== nodes.indexOf(node))),\n  }\n}\n\nconst createKeysPressed = () => {\n  const { subscribe, update } = writable(new Map());\n\n  return {\n    subscribe,\n    keydown: (key) => update(keys => { keys.set(key, true); return keys; }),\n    keyup: (key) => update(keys => { keys.set(key, false); return keys; })\n  }\n}\n\nconst createPhongConfiguration = () => {\n  const { subscribe, update, set } = writable({\n    ambient: 0.6,\n    diffuse: 0.6,\n    specular: 0.8,\n    shininess: 10.\n  });\n\n  return {\n    subscribe,\n    update,\n    set,\n    loadIntoShader: (shader) => {\n      const unsubscribe = subscribe(phong => {\n        shader.trySet(shader.getUniformFloat.bind(shader), \"kA\", phong.ambient);\n        shader.trySet(shader.getUniformFloat.bind(shader), \"kD\", phong.diffuse);\n        shader.trySet(shader.getUniformFloat.bind(shader), \"kS\", phong.specular);\n        shader.trySet(shader.getUniformFloat.bind(shader), \"shininess\", phong.shininess);\n      });\n      unsubscribe();\n    }\n  }\n}\n\nconst createMouseMovement = () => {\n  const { subscribe, update, set } = writable({ x: 0, y: 0 });\n\n  return {\n    subscribe,\n    addX: (offsetX) => { update(offsets => { return { ...offsets, x: offsets.x + offsetX } }) },\n    addY: (offsetY) => { update(offsets => { return { ...offsets, y: offsets.y + offsetY } }) },\n    reset: () => set({ x: 0, y: 0 })\n  }\n}\n\nconst createMousePosition = () => {\n  const { subscribe, update, set } = writable({ x: 0, y: 0 });\n\n  return {\n    subscribe,\n    setX: (mouseX) => { update(position => { return { ...position, x: mouseX } }) },\n    setY: (mouseY) => { update(position => { return { ...position, y: mouseY } }) },\n    reset: () => set({ x: 0, y: 0 })\n  }\n}\n\nexport const mousePosition = createMousePosition();\nexport const mouseOffsets = createMouseMovement();\nexport const phongConfiguration = createPhongConfiguration();\nexport const camera = writable({});\nexport const keysPressed = createKeysPressed();\nexport const selectedNode = writable({});\nexport const hoveredNode = writable({});\nexport const mouseClicked = writable(false);\nexport const sceneGraph = createSceneGraph();\nexport const animationNodes = createAnimationNodes();","export { identity as linear } from '../internal';\n\n/*\nAdapted from https://github.com/mattdesl\nDistributed under MIT License https://github.com/mattdesl/eases/blob/master/LICENSE.md\n*/\nfunction backInOut(t) {\n    const s = 1.70158 * 1.525;\n    if ((t *= 2) < 1)\n        return 0.5 * (t * t * ((s + 1) * t - s));\n    return 0.5 * ((t -= 2) * t * ((s + 1) * t + s) + 2);\n}\nfunction backIn(t) {\n    const s = 1.70158;\n    return t * t * ((s + 1) * t - s);\n}\nfunction backOut(t) {\n    const s = 1.70158;\n    return --t * t * ((s + 1) * t + s) + 1;\n}\nfunction bounceOut(t) {\n    const a = 4.0 / 11.0;\n    const b = 8.0 / 11.0;\n    const c = 9.0 / 10.0;\n    const ca = 4356.0 / 361.0;\n    const cb = 35442.0 / 1805.0;\n    const cc = 16061.0 / 1805.0;\n    const t2 = t * t;\n    return t < a\n        ? 7.5625 * t2\n        : t < b\n            ? 9.075 * t2 - 9.9 * t + 3.4\n            : t < c\n                ? ca * t2 - cb * t + cc\n                : 10.8 * t * t - 20.52 * t + 10.72;\n}\nfunction bounceInOut(t) {\n    return t < 0.5\n        ? 0.5 * (1.0 - bounceOut(1.0 - t * 2.0))\n        : 0.5 * bounceOut(t * 2.0 - 1.0) + 0.5;\n}\nfunction bounceIn(t) {\n    return 1.0 - bounceOut(1.0 - t);\n}\nfunction circInOut(t) {\n    if ((t *= 2) < 1)\n        return -0.5 * (Math.sqrt(1 - t * t) - 1);\n    return 0.5 * (Math.sqrt(1 - (t -= 2) * t) + 1);\n}\nfunction circIn(t) {\n    return 1.0 - Math.sqrt(1.0 - t * t);\n}\nfunction circOut(t) {\n    return Math.sqrt(1 - --t * t);\n}\nfunction cubicInOut(t) {\n    return t < 0.5 ? 4.0 * t * t * t : 0.5 * Math.pow(2.0 * t - 2.0, 3.0) + 1.0;\n}\nfunction cubicIn(t) {\n    return t * t * t;\n}\nfunction cubicOut(t) {\n    const f = t - 1.0;\n    return f * f * f + 1.0;\n}\nfunction elasticInOut(t) {\n    return t < 0.5\n        ? 0.5 *\n            Math.sin(((+13.0 * Math.PI) / 2) * 2.0 * t) *\n            Math.pow(2.0, 10.0 * (2.0 * t - 1.0))\n        : 0.5 *\n            Math.sin(((-13.0 * Math.PI) / 2) * (2.0 * t - 1.0 + 1.0)) *\n            Math.pow(2.0, -10.0 * (2.0 * t - 1.0)) +\n            1.0;\n}\nfunction elasticIn(t) {\n    return Math.sin((13.0 * t * Math.PI) / 2) * Math.pow(2.0, 10.0 * (t - 1.0));\n}\nfunction elasticOut(t) {\n    return (Math.sin((-13.0 * (t + 1.0) * Math.PI) / 2) * Math.pow(2.0, -10.0 * t) + 1.0);\n}\nfunction expoInOut(t) {\n    return t === 0.0 || t === 1.0\n        ? t\n        : t < 0.5\n            ? +0.5 * Math.pow(2.0, 20.0 * t - 10.0)\n            : -0.5 * Math.pow(2.0, 10.0 - t * 20.0) + 1.0;\n}\nfunction expoIn(t) {\n    return t === 0.0 ? t : Math.pow(2.0, 10.0 * (t - 1.0));\n}\nfunction expoOut(t) {\n    return t === 1.0 ? t : 1.0 - Math.pow(2.0, -10.0 * t);\n}\nfunction quadInOut(t) {\n    t /= 0.5;\n    if (t < 1)\n        return 0.5 * t * t;\n    t--;\n    return -0.5 * (t * (t - 2) - 1);\n}\nfunction quadIn(t) {\n    return t * t;\n}\nfunction quadOut(t) {\n    return -t * (t - 2.0);\n}\nfunction quartInOut(t) {\n    return t < 0.5\n        ? +8.0 * Math.pow(t, 4.0)\n        : -8.0 * Math.pow(t - 1.0, 4.0) + 1.0;\n}\nfunction quartIn(t) {\n    return Math.pow(t, 4.0);\n}\nfunction quartOut(t) {\n    return Math.pow(t - 1.0, 3.0) * (1.0 - t) + 1.0;\n}\nfunction quintInOut(t) {\n    if ((t *= 2) < 1)\n        return 0.5 * t * t * t * t * t;\n    return 0.5 * ((t -= 2) * t * t * t * t + 2);\n}\nfunction quintIn(t) {\n    return t * t * t * t * t;\n}\nfunction quintOut(t) {\n    return --t * t * t * t * t + 1;\n}\nfunction sineInOut(t) {\n    return -0.5 * (Math.cos(Math.PI * t) - 1);\n}\nfunction sineIn(t) {\n    const v = Math.cos(t * Math.PI * 0.5);\n    if (Math.abs(v) < 1e-14)\n        return 1;\n    else\n        return 1 - v;\n}\nfunction sineOut(t) {\n    return Math.sin((t * Math.PI) / 2);\n}\n\nexport { backIn, backInOut, backOut, bounceIn, bounceInOut, bounceOut, circIn, circInOut, circOut, cubicIn, cubicInOut, cubicOut, elasticIn, elasticInOut, elasticOut, expoIn, expoInOut, expoOut, quadIn, quadInOut, quadOut, quartIn, quartInOut, quartOut, quintIn, quintInOut, quintOut, sineIn, sineInOut, sineOut };\n","import { cubicOut, cubicInOut } from '../easing';\nimport { is_function, assign } from '../internal';\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n\r\nfunction __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\n\nfunction fade(node, { delay = 0, duration = 400 }) {\n    const o = +getComputedStyle(node).opacity;\n    return {\n        delay,\n        duration,\n        css: t => `opacity: ${t * o}`\n    };\n}\nfunction fly(node, { delay = 0, duration = 400, easing = cubicOut, x = 0, y = 0, opacity = 0 }) {\n    const style = getComputedStyle(node);\n    const target_opacity = +style.opacity;\n    const transform = style.transform === 'none' ? '' : style.transform;\n    const od = target_opacity * (1 - opacity);\n    return {\n        delay,\n        duration,\n        easing,\n        css: (t, u) => `\n\t\t\ttransform: ${transform} translate(${(1 - t) * x}px, ${(1 - t) * y}px);\n\t\t\topacity: ${target_opacity - (od * u)}`\n    };\n}\nfunction slide(node, { delay = 0, duration = 400, easing = cubicOut }) {\n    const style = getComputedStyle(node);\n    const opacity = +style.opacity;\n    const height = parseFloat(style.height);\n    const padding_top = parseFloat(style.paddingTop);\n    const padding_bottom = parseFloat(style.paddingBottom);\n    const margin_top = parseFloat(style.marginTop);\n    const margin_bottom = parseFloat(style.marginBottom);\n    const border_top_width = parseFloat(style.borderTopWidth);\n    const border_bottom_width = parseFloat(style.borderBottomWidth);\n    return {\n        delay,\n        duration,\n        easing,\n        css: t => `overflow: hidden;` +\n            `opacity: ${Math.min(t * 20, 1) * opacity};` +\n            `height: ${t * height}px;` +\n            `padding-top: ${t * padding_top}px;` +\n            `padding-bottom: ${t * padding_bottom}px;` +\n            `margin-top: ${t * margin_top}px;` +\n            `margin-bottom: ${t * margin_bottom}px;` +\n            `border-top-width: ${t * border_top_width}px;` +\n            `border-bottom-width: ${t * border_bottom_width}px;`\n    };\n}\nfunction scale(node, { delay = 0, duration = 400, easing = cubicOut, start = 0, opacity = 0 }) {\n    const style = getComputedStyle(node);\n    const target_opacity = +style.opacity;\n    const transform = style.transform === 'none' ? '' : style.transform;\n    const sd = 1 - start;\n    const od = target_opacity * (1 - opacity);\n    return {\n        delay,\n        duration,\n        easing,\n        css: (_t, u) => `\n\t\t\ttransform: ${transform} scale(${1 - (sd * u)});\n\t\t\topacity: ${target_opacity - (od * u)}\n\t\t`\n    };\n}\nfunction draw(node, { delay = 0, speed, duration, easing = cubicInOut }) {\n    const len = node.getTotalLength();\n    if (duration === undefined) {\n        if (speed === undefined) {\n            duration = 800;\n        }\n        else {\n            duration = len / speed;\n        }\n    }\n    else if (typeof duration === 'function') {\n        duration = duration(len);\n    }\n    return {\n        delay,\n        duration,\n        easing,\n        css: (t, u) => `stroke-dasharray: ${t * len} ${u * len}`\n    };\n}\nfunction crossfade(_a) {\n    var { fallback } = _a, defaults = __rest(_a, [\"fallback\"]);\n    const to_receive = new Map();\n    const to_send = new Map();\n    function crossfade(from, node, params) {\n        const { delay = 0, duration = d => Math.sqrt(d) * 30, easing = cubicOut } = assign(assign({}, defaults), params);\n        const to = node.getBoundingClientRect();\n        const dx = from.left - to.left;\n        const dy = from.top - to.top;\n        const dw = from.width / to.width;\n        const dh = from.height / to.height;\n        const d = Math.sqrt(dx * dx + dy * dy);\n        const style = getComputedStyle(node);\n        const transform = style.transform === 'none' ? '' : style.transform;\n        const opacity = +style.opacity;\n        return {\n            delay,\n            duration: is_function(duration) ? duration(d) : duration,\n            easing,\n            css: (t, u) => `\n\t\t\t\topacity: ${t * opacity};\n\t\t\t\ttransform-origin: top left;\n\t\t\t\ttransform: ${transform} translate(${u * dx}px,${u * dy}px) scale(${t + (1 - t) * dw}, ${t + (1 - t) * dh});\n\t\t\t`\n        };\n    }\n    function transition(items, counterparts, intro) {\n        return (node, params) => {\n            items.set(params.key, {\n                rect: node.getBoundingClientRect()\n            });\n            return () => {\n                if (counterparts.has(params.key)) {\n                    const { rect } = counterparts.get(params.key);\n                    counterparts.delete(params.key);\n                    return crossfade(rect, node, params);\n                }\n                // if the node is disappearing altogether\n                // (i.e. wasn't claimed by the other list)\n                // then we need to supply an outro\n                items.delete(params.key);\n                return fallback && fallback(node, params, intro);\n            };\n        };\n    }\n    return [\n        transition(to_send, to_receive, false),\n        transition(to_receive, to_send, true)\n    ];\n}\n\nexport { crossfade, draw, fade, fly, scale, slide };\n","<script>\n  import { sceneGraph, selectedNode, hoveredNode } from \"../state/stores.js\";\n\n  export let node;\n\n  const click = () => {\n    selectedNode.set(node);\n  };\n\n  const mouseEnter = () => {\n    hoveredNode.set(node);\n  };\n\n  const remove = event => {\n    event.preventDefault();\n    sceneGraph.remove(node.id);\n  };\n</script>\n\n<style>\n  span {\n    cursor: pointer;\n    display: inline-block;\n    padding: 0 0.5em 0 0.5em;\n  }\n\n  span:hover {\n    border-radius: 10px;\n    background: yellow;\n    color: black;\n  }\n\n  .active {\n    border-radius: 10px;\n    background: orange;\n    color: white;\n  }\n</style>\n\n<span\n  class:active={$selectedNode === node}\n  on:click={click}\n  on:mouseenter={mouseEnter}\n  on:contextmenu={remove}>\n  <strong>{node.id}</strong>\n  {` (${node.constructor.name})`}\n</span>\n","<script>\n  import { onMount } from \"svelte\";\n  import { fly } from \"svelte/transition\";\n  import { flip } from \"svelte/animate\";\n  import SceneGraphLeaf from \"./SceneGraphLeaf.svelte\";\n  import { GroupNode } from \"../scenegraph/nodes.js\";\n  import { animationNodes } from \"../state/stores.js\";\n\n  export let node;\n  let showChildren = true;\n  let showAnimations = true;\n\n  const toggleChildren = () => {\n    showChildren = !showChildren;\n  };\n  const toggleAnimations = () => {\n    showAnimations = !showAnimations;\n  };\n</script>\n\n<style>\n  .category_container {\n    padding-left: 0.5em;\n  }\n\n  .children_container {\n    padding-left: 1em;\n    list-style: none;\n    border-left: 1px solid black;\n  }\n\n  span {\n    padding: 0 0.5em 0 1.5em;\n    cursor: pointer;\n    font-weight: bold;\n  }\n\n  span:hover {\n    text-decoration: underline;\n  }\n\n  .dropDown {\n    background: url(icons/arrow_drop_down.svg) 0 0.2em no-repeat;\n    background-size: 1em 1em;\n  }\n\n  .dropUp {\n    background: url(icons/arrow_drop_up.svg) 0 0.2em no-repeat;\n    background-size: 1em 1em;\n  }\n</style>\n\n<SceneGraphLeaf {node} />\n{#if $animationNodes.map(n => n.groupNode).indexOf(node) !== -1}\n  <div class=\"category_container\">\n    <span\n      class:dropDown={!showAnimations}\n      class:dropUp={showAnimations}\n      on:click={toggleAnimations}>\n      AnimationNodes:\n    </span>\n    {#if showAnimations}\n      <ul class=\"children_container\" transition:fly={{ duration: 100 }}>\n        {#each $animationNodes.filter(aNode => aNode.groupNode === node) as animation}\n          <div style=\"padding: 0 0.5em 0 0.5em;\">\n            {animation.constructor.name}\n          </div>\n        {/each}\n      </ul>\n    {/if}\n  </div>\n{/if}\n<div class=\"category_container\">\n  <span\n    class:dropDown={!showChildren}\n    class:dropUp={showChildren}\n    on:click={toggleChildren}>\n    ChildNodes:\n  </span>\n  {#if showChildren}\n    <ul class=\"children_container\" transition:fly={{ duration: 100 }}>\n      {#each node.children as child}\n        {#if child instanceof GroupNode}\n          <svelte:self node={child} />\n        {:else}\n          <SceneGraphLeaf node={child} />\n        {/if}\n      {/each}\n    </ul>\n  {/if}\n</div>\n","<script>\n  import { sceneGraph, keysPressed } from \"../state/stores.js\";\n  import SceneGraphNode from \"./SceneGraphNode.svelte\";\n</script>\n\n<style>\n  .scenegraph_container {\n    padding: 1em;\n    overflow-y: auto;\n    height: 100%;\n  }\n</style>\n\n<div class=\"scenegraph_container\">\n  <h2>Scene Graph</h2>\n  <hr />\n  <SceneGraphNode node={$sceneGraph} />\n</div>\n","<script>\n  export let value;\n  export let name;\n  export let min;\n  export let max;\n  export let step;\n</script>\n\n<style>\n  .input_group {\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    align-items: bottom;\n  }\n  label {\n    padding-top: 0.3em;\n    flex: 2;\n  }\n  input {\n    flex: 6;\n  }\n  .value_container {\n    padding-top: 0.3em;\n    flex: 1;\n    text-align: center;\n    background: white;\n    margin-left: 0.5em;\n  }\n</style>\n\n<div class=\"input_group\">\n  <label for=\"slider\">{name}</label>\n  <input bind:value type=\"range\" name=\"slider\" {min} {max} {step} />\n  <div class=\"value_container\">{value}</div>\n</div>\n","<script>\n  import Slider from \"./Slider.svelte\";\n  import { phongConfiguration } from \"../state/stores.js\";\n</script>\n\n<style>\n  .phong_container {\n    padding: 1em;\n    height: 100%;\n  }\n</style>\n\n<div class=\"phong_container\">\n  <h2>Phong Parameters</h2>\n  <hr />\n  <Slider\n    bind:value={$phongConfiguration.ambient}\n    name=\"Ambient\"\n    min=\"0\"\n    max=\"1\"\n    step=\"0.01\" />\n  <Slider\n    bind:value={$phongConfiguration.diffuse}\n    name=\"Diffuse\"\n    min=\"0\"\n    max=\"1\"\n    step=\"0.01\" />\n  <Slider\n    bind:value={$phongConfiguration.specular}\n    name=\"Specular\"\n    min=\"0\"\n    max=\"1\"\n    step=\"0.01\" />\n  <Slider\n    bind:value={$phongConfiguration.shininess}\n    name=\"Shininess\"\n    min=\"0.1\"\n    max=\"100\"\n    step=\"0.1\" />\n\n</div>\n","attribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec4 a_colour;\n\nuniform mat4 M;\nuniform mat4 V;\nuniform mat4 P;\nuniform mat4 N;\n\nvarying vec4 v_color;\nvarying vec3 v_pos;\nvarying vec3 v_normal;\n\nvoid main(){\n  mat4 modelView = V * M;\n  vec4 vert_pos = modelView * vec4(a_position,1.);\n  gl_Position= P * vert_pos;\n  v_normal = normalize(vec3(\n    N *\n    vec4(a_normal, .0)));\n  v_color = a_colour;\n  v_pos = vec3(vert_pos.xyz / vert_pos.w);\n}\n","precision mediump float;\n\nuniform vec3 lightPositions[8];\nconst int maxLights = 8;\nuniform int lights;\n\nvarying vec4 v_color;\nvarying vec3 v_normal;\nvarying vec3 v_pos;\n\nuniform float kA;\nuniform float kD;\nuniform float kS;\nuniform float shininess;\n\nvec4 ambient() {\n  return v_color * kA;\n}\n\nvec4 diffuse(vec3 lightPos) {\n  float lambertian = max(dot(normalize(lightPos - v_pos), v_normal), .0);\n  return v_color * kD * lambertian;\n}\n\nvec4 specular(vec3 lightPos) {\n  vec3 l = normalize(lightPos - v_pos);\n  vec3 r = reflect(-l,v_normal);\n  vec3 v = normalize(-v_pos);\n  return v_color * kS * pow(max(dot(r,v),0.0), shininess);\n}\n\nvoid main(void){\n  gl_FragColor = ambient();\n  for(int i = 0; i < maxLights; i++) {\n    if (i < lights) {\n      gl_FragColor+=(diffuse(lightPositions[i]) + specular(lightPositions[i]));\n    }\n  }\n  gl_FragColor.a = v_color.a;\n}","attribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\n\nuniform mat4 M;\nuniform mat4 V;\nuniform mat4 P;\nuniform mat4 N;\n\nvarying vec2 v_texCoord;\nvarying vec3 v_pos;\nvarying vec3 v_normal;\n\nvoid main() {\n  mat4 modelView = V * M;\n  vec4 vert_pos = modelView * vec4(a_position,1.);\n  gl_Position= P * vert_pos;\n  v_texCoord = a_texCoord;\n  v_normal = normalize(vec3(\n    N *\n    vec4(a_normal, .0)));\n  v_pos = vec3(vert_pos.xyz / vert_pos.w);\n}\n","precision mediump float;\n\nuniform vec3 lightPositions[8];\nconst int maxLights = 8;\nuniform int lights;\n\nuniform sampler2D sampler;\nuniform sampler2D normalSampler;\n\nvarying vec2 v_texCoord;\nvarying vec3 v_normal;\nvarying vec3 v_pos;\n\nuniform float kA;\nuniform float kD;\nuniform float kS;\nuniform float shininess;\n\nfloat ambient() {\n  return kA;\n}\n\nfloat diffuse(vec3 lightPos, vec3 normal) {\n  float lambertian = max(dot(normalize(lightPos - v_pos), normal), .0);\n  return kD * lambertian;\n}\n\nfloat specular(vec3 lightPos, vec3 normal) {\n  vec3 l = normalize(lightPos - v_pos);\n  vec3 r = reflect(-l, normal);\n  vec3 v = normalize(-v_pos);\n  return kS * pow(max(dot(r,v),0.0), shininess);\n}\n\nvoid main( void ) {\n  vec4 textureColor = texture2D(sampler, v_texCoord);\n  vec4 normalCoord = 2.*(texture2D(normalSampler, v_texCoord))-1.;\n  gl_FragColor=vec4((textureColor*ambient()).xyz, 1.0);\n  for(int i = 0; i < maxLights; i++) {\n    if (i < lights) {\n      gl_FragColor += vec4((textureColor* diffuse(lightPositions[i], normalize(v_normal + normalCoord.xyz)) + textureColor* specular(lightPositions[i], normalize(v_normal + normalCoord.xyz))).xyz, 1.0);\n    }\n  }\n  gl_FragColor.a = textureColor.a;\n}\n","attribute vec2 a_vertexPosition;\n\nvarying vec3 rayOrigin;\nvarying vec3 rayDirection;\n\nuniform mat4 iMVP;\n\nvoid main(void) {\n\n  vec2 vertex = a_vertexPosition * 2.0 - vec2(1.0);\n\n  vec4 farPlane = iMVP * vec4(vertex, 1.0, 1.0);\n  farPlane /= farPlane.w;\n\n  vec4 nearPlane = iMVP * vec4(vertex, -1.0, 1.0);\n  nearPlane /= nearPlane.w;\n\n  rayDirection = (farPlane.xyz - nearPlane.xyz);\n  rayOrigin = nearPlane.xyz;\n\n  gl_Position = vec4(vertex, 0.0, 1.0);\n}","precision mediump float;\n\nvarying vec3 rayDirection;\nvarying vec3 rayOrigin;\n\n// point light\nuniform vec3 light0;\n\nstruct Ray\n{\n  vec3    origin;\n  vec3    direction;\n};\n\nstruct Hit\n{\n  vec3    position;\n  vec3    normal;\n  float   t;\n  vec4 color;\n};\n\nstruct Sphere\n{\n  // coords + radius\n  vec3    center;\n  float   radius;\n  vec4 color;\n};\n\n\n// a small epsilon to work around the biggest problems with floats\nconst float EPS = 0.0001;\n// 'clear value' for the ray\nconst float START_T = 100000.0;\n// maximum recursion depth for rays\nconst int MAX_DEPTH = 3;\n\n\nRay initRay()\n{\n  Ray r;\n  r.origin = rayOrigin;\n  r.direction = normalize(rayDirection);\n  return r;\n}\n\n// intersects the ray with a sphere and returns the line parameter t for\n// a hit or -1 if not hit occured\nfloat intersectRaySphere(in Ray ray, in Sphere sphere)\n{\n  vec3 rayOrigin = ray.origin;\n  vec3 rayDir = ray.direction;\n  float t = dot((sphere.center - rayOrigin), rayDir);\n  vec3 ortho = rayOrigin + (rayDir * t);\n  float y = length(sphere.center - ortho);\n  if(y < sphere.radius) {\n    float x = sqrt(sphere.radius * sphere.radius - y * y);\n    float t1 = t - x;\n    float t2 = t + x;\n    float firstHitDistance = min(t1, t2);\n    return firstHitDistance;\n  }\n  return -1.;\n}\n\nuniform vec3 lightPositions[8];\nconst int maxLights = 8;\nuniform int lights;\n\nSphere sphereObjects[7];\nconst int maxSpheres = 64;\nuniform vec3 camera;\nuniform vec3 sphereCenters[64];\nuniform vec4 sphereColors[64];\nuniform float sphereRadii[64];\nuniform int spheres;\n\nuniform float kA;\nuniform float kD;\nuniform float kS;\nuniform float shininess;\n\n// initializes the scene\nvoid initScene()\n{\n  for (int i = 0; i < maxSpheres; i++) {\n    if (i < spheres) {\n      sphereObjects[i].center = sphereCenters[i];\n      sphereObjects[i].radius = sphereRadii[i];\n      sphereObjects[i].color = sphereColors[i];\n    }\n  }\n}\n\n\n// traces the scene and reports the closest hit\nbool traceScene(in Ray ray, inout Hit hit)\n{\n  hit.t = START_T;\n\n  float t = START_T;\n  if (t >= 0.0 && t <= hit.t)\n  {\n    hit.t = t;\n    hit.position = ray.origin + ray.direction * t;\n    hit.normal = vec3(0,1,0);\n  }\n\n  for (int i = 0; i < 7; ++i)\n  {\n    t = intersectRaySphere(ray, sphereObjects[i]);\n    if (t >= 0.0 && t <= hit.t)\n    {\n      vec3 pos = ray.origin + ray.direction * t;\n      vec3 N = normalize(pos - sphereObjects[i].center);\n      hit.t = t;\n      hit.normal = N;\n      hit.color = sphereObjects[i].color;\n      hit.position = pos;\n    }\n  }\n\n  return hit.t < START_T;\n}\n\nvec4 diffuse(vec3 lightPos, vec3 hit, vec3 normal, vec4 color) {\n  float lambertian = max(dot(normalize(lightPos - hit), normal), .0);\n  return color * kD * lambertian;\n}\n\nvec4 specular(vec3 lightPos, vec3 hit, vec3 normal, vec4 color) {\n  vec3 l = normalize(lightPos - hit);\n  vec3 r = reflect(-l,normal);\n  vec3 v = normalize(camera - hit);\n  return color * kS * pow(max(dot(r,v),0.0), shininess);\n}\n\nvoid main()\n{\n  Ray ray = initRay();\n  initScene();\n  vec4 color = vec4(ray.direction, 1.0);\n  Hit hit;\n  if (traceScene(ray, hit))\n  {\n    color = kA * hit.color;\n    for(int i = 0; i < maxLights; i++) {\n      if (i < lights) {\n        color += (diffuse(lightPositions[i], hit.position, hit.normal, hit.color) +\n          specular(lightPositions[i], hit.position, hit.normal, hit.color));\n      }\n    }\n  }\n  gl_FragColor = color;\n}","attribute vec3 a_position;\nattribute vec4 a_colour;\nattribute vec3 a_normal;\n\nuniform mat4 M;\nuniform mat4 V;\nuniform mat4 P;\n\nvoid main(){\n  vec3 throwAway = a_normal;\n  throwAway = vec3(0.,0.,0.);\n  vec4 color = a_colour;\n  color = vec4(0.,0.,0.,0.);\n  mat4 modelView = V * M;\n  vec4 vert_pos = modelView * vec4(a_position,1.);\n  gl_Position= P * vert_pos;\n}\n","precision mediump float;\n\nuniform vec4 color;\n\nvoid main(void){\n  gl_FragColor = color;\n}\n","import Vector from \"../../math/vector.js\";\n\nexport default class Rasterizable {\n\n  constructor() {\n    this.loaded = true;\n  }\n\n  calcNormals() {\n    const calcNormal = (v1, v2, v3) => {\n      const vec1 = v1.sub(v2);\n      const vec2 = v3.sub(v2);\n      return vec2.cross(vec1).normalised();\n    }\n    this.normals = [];\n    for (let i = 0; i < this.vertices.length;) {\n      const normal = calcNormal(\n        new Vector(this.vertices[i++], this.vertices[i++], this.vertices[i++]),\n        new Vector(this.vertices[i++], this.vertices[i++], this.vertices[i++]),\n        new Vector(this.vertices[i++], this.vertices[i++], this.vertices[i++]));\n      this.normals.push(normal.x, normal.y, normal.z);\n      this.normals.push(normal.x, normal.y, normal.z);\n      this.normals.push(normal.x, normal.y, normal.z);\n    }\n  }\n\n  fillBuffers() {\n    const vertexBuffer = this.gl.createBuffer();\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, vertexBuffer);\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, new Float32Array(this.vertices), this.gl.STATIC_DRAW);\n    this.vertexBuffer = vertexBuffer;\n\n    const indexBuffer = this.gl.createBuffer();\n    this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER, indexBuffer);\n    this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER, new Uint32Array(this.indices), this.gl.STATIC_DRAW);\n    this.indexBuffer = indexBuffer;\n\n    const colourBuffer = this.gl.createBuffer();\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, colourBuffer);\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, new Float32Array(this.colors), this.gl.STATIC_DRAW);\n    this.colourBuffer = colourBuffer;\n\n    const normalBuffer = this.gl.createBuffer();\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, normalBuffer);\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, new Float32Array(this.normals), this.gl.STATIC_DRAW);\n    this.normalBuffer = normalBuffer;\n  }\n\n  /**\n    * Renders the rasterizable\n    * @param {Shader} shader - The shader used to render\n  */\n  render(shader) {\n    if (this.loaded) {\n      this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.vertexBuffer);\n      const positionLocation = shader.getAttributeLocation('a_position');\n      this.gl.enableVertexAttribArray(positionLocation);\n      this.gl.vertexAttribPointer(positionLocation, 3, this.gl.FLOAT, false, 0, 0);\n\n      this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.colourBuffer);\n      const colourLocation = shader.getAttributeLocation('a_colour');\n      this.gl.enableVertexAttribArray(colourLocation);\n      this.gl.vertexAttribPointer(colourLocation, 4, this.gl.FLOAT, false, 0, 0);\n\n      this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.normalBuffer);\n      const normalLocation = shader.getAttributeLocation('a_normal');\n      this.gl.enableVertexAttribArray(normalLocation);\n      this.gl.vertexAttribPointer(normalLocation, 3, this.gl.FLOAT, false, 0, 0);\n\n      this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer);\n      this.gl.drawElements(this.gl.TRIANGLES, this.indices.length, this.gl.UNSIGNED_INT, 0);\n\n      this.gl.disableVertexAttribArray(positionLocation);\n      this.gl.disableVertexAttribArray(colourLocation);\n      this.gl.disableVertexAttribArray(normalLocation);\n    }\n  }\n}","import Vector from '../../math/vector.js';\nimport Rasterizable from './rasterizable.js';\n\n/**\n * A class creating buffers for a sphere to render it with WebGL\n */\nexport default class RasterSphere extends Rasterizable {\n  /**\n   * Creates all WebGL buffers for the sphere\n   * @param {WebGLContext} gl - The canvas' context\n   * @param {Vector} center   - The center of the sphere\n   * @param {number} radius   - The radius of the sphere\n   * @param {Vector} color    - The color of the sphere\n   */\n  constructor(gl, center, radius, color, color2) {\n    super();\n    this.gl = gl;\n\n    this.vertices = [];\n    this.indices = [];\n    this.normals = [];\n\n    let ringsize = 50;\n    for (let ring = 0; ring < ringsize; ring++) {\n      for (let ring2 = 0; ring2 < ringsize; ring2++) {\n        let theta = (ring * Math.PI * 2) / ringsize - 1;\n        let phi = (ring2 * Math.PI * 2) / ringsize;\n        let x = radius * Math.sin(theta) * Math.cos(phi) + center.x;\n        let y = radius * Math.sin(theta) * Math.sin(phi) + center.y;\n        let z = radius * Math.cos(theta) + center.z;\n        this.vertices.push(x);\n        this.vertices.push(y);\n        this.vertices.push(z);\n\n        let normal = new Vector(x, y, z).sub(center).normalised();\n        this.normals.push(normal.x);\n        this.normals.push(normal.y);\n        this.normals.push(normal.z);\n      }\n    }\n\n    for (let ring = 0; ring < ringsize - 1; ring++) {\n      for (let ring2 = 0; ring2 < ringsize; ring2++) {\n        this.indices.push(ring * ringsize + ring2);\n        this.indices.push(ring * ringsize + ((ring2 + 1) % ringsize));\n        this.indices.push((ring + 1) * ringsize + ring2);\n\n        this.indices.push(ring * ringsize + ((ring2 + 1) % ringsize));\n        this.indices.push((ring + 1) * ringsize + ((ring2 + 1) % ringsize));\n        this.indices.push((ring + 1) * ringsize + ring2);\n      }\n    }\n\n    this.colors = [];\n    for (let i = 0; i < this.vertices.length / 3; i++) {\n      if (color2 && (i % 2) == 0) {\n        this.colors.push(color2.r);\n        this.colors.push(color2.g);\n        this.colors.push(color2.b);\n        this.colors.push(color2.a);\n      } else {\n        this.colors.push(color.r);\n        this.colors.push(color.g);\n        this.colors.push(color.b);\n        this.colors.push(color.a);\n      }\n    }\n\n    this.fillBuffers();\n  }\n}\n","export default class TextureRasterizable {\n\n  /**\n   * Renders the textured rasterizable\n   * @param {Shader} shader - The shader used to render\n   */\n  render(shader) {\n    if (this.loaded) {\n      this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.vertexBuffer);\n      const positionLocation = shader.getAttributeLocation('a_position');\n      this.gl.enableVertexAttribArray(positionLocation);\n      this.gl.vertexAttribPointer(positionLocation, 3, this.gl.FLOAT, false, 0, 0);\n\n      this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.texCoords);\n      const textureLocation = shader.getAttributeLocation('a_texCoord');\n      this.gl.enableVertexAttribArray(textureLocation);\n      this.gl.vertexAttribPointer(textureLocation, 2, this.gl.FLOAT, false, 0, 0);\n\n      this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.normalBuffer);\n      const normalLocation = shader.getAttributeLocation('a_normal');\n      this.gl.enableVertexAttribArray(normalLocation);\n      this.gl.vertexAttribPointer(normalLocation, 3, this.gl.FLOAT, false, 0, 0);\n\n      this.gl.activeTexture(this.gl.TEXTURE0);\n      this.gl.bindTexture(this.gl.TEXTURE_2D, this.texBuffer);\n      shader.getUniformInt('sampler').set(0);\n\n      this.gl.activeTexture(this.gl.TEXTURE1);\n      this.gl.bindTexture(this.gl.TEXTURE_2D, this.normalMapBuffer);\n      shader.getUniformInt('normalSampler').set(1);\n\n      this.gl.drawArrays(this.gl.TRIANGLES, 0, this.elements);\n\n      this.gl.disableVertexAttribArray(positionLocation);\n      this.gl.disableVertexAttribArray(textureLocation);\n      this.gl.disableVertexAttribArray(normalLocation);\n    }\n  }\n}","import Rasterizable from \"./rasterizable.js\";\nimport Vector from \"../../math/vector.js\"\n\n/**\n * A class creating buffers for an axis aligned box to render it with WebGL\n */\nexport default class RasterMesh extends Rasterizable {\n  /**\n   * Creates all WebGL buffers for the given OBJ Wavefront file\n   *  looking in negative z axis direction\n   * @param {WebGLContext} gl - The canvas' context\n   * @param {string} url - The minimal x,y,z of the box\n   * @param {Vector} color - The color the mesh should have\n   */\n  constructor(gl, url, color) {\n    super();\n    this.loaded = false;\n    this.gl = gl;\n    this.vertices = [];\n    this.indices = [];\n    this.normals = [];\n    this.colors = [];\n    fetch(url).then(resp => resp.text()).then(contents => {\n      const mesh = parseObjectFile(contents);\n      mesh.indices.forEach(index => {\n        if (isNaN(index.v) || isNaN(index.n)) {\n          hasNaNs = true;\n        }\n        const vertex = mesh.vertices[index.v];\n        if (vertex) {\n          this.vertices.push(vertex.x, vertex.y, vertex.z);\n        }\n        if (mesh.normals.length > 0) {\n          const normal = mesh.normals[index.n];\n          this.normals.push(normal.x, normal.y, normal.z);\n        }\n      });\n      if (mesh.normals.length === 0) {\n        this.calcNormals();\n      }\n      for (let i = 0; i < this.vertices.length / 3; i++) {\n        this.colors.push(color.r);\n        this.colors.push(color.g);\n        this.colors.push(color.b);\n        this.colors.push(color.a);\n      }\n      this.indices = [...Array(this.vertices.length / 3).keys()];\n      this.fillBuffers();\n    }).then(() => this.loaded = true);\n  }\n}\n\nconst parseObjectFile = contents => {\n  const lines = contents.split(\"\\n\");\n  const vertices = [];\n  const normals = [];\n  const indices = [];\n  lines.forEach(line => {\n    const cols = line.split(/\\s/).filter(c => c.length > 0);\n    if (cols.length > 0) {\n      switch (cols[0]) {\n        case \"v\":\n          vertices.push(new Vector(parseFloat(cols[1]), parseFloat(cols[2]), parseFloat(cols[3])));\n          break;\n        case \"vn\":\n          normals.push(new Vector(parseFloat(cols[1]), parseFloat(cols[2]), parseFloat(cols[3])));\n          break;\n        case \"f\":\n          for (let i = 1; i < 4; i++) {\n            if (cols[i].includes(\"/\")) {\n              const indCols = cols[i].split(\"/\");\n              const vInd = parseInt(indCols[0]) - 1;\n              const nInd = indCols[2].length == 0 ? 0 : parseInt(indCols[2]) - 1;\n              indices.push({ v: vInd, n: nInd });\n            } else {\n              indices.push({ v: parseInt(cols[i]) - 1, n: 0 });\n            }\n          }\n          break;\n      }\n    }\n  });\n  return { vertices, normals, indices };\n}","import Matrix from '../math/matrix.js';\nimport Vector from '../math/vector.js';\n\nexport default class Visitor {\n  /**\n    * Creates a new Visitor\n    * @param {Object} context                 - The 3D context to render to\n    */\n  constructor(context) {\n    this.gl = context;\n    this.matrixStack = [Matrix.identity()];\n    this.matrixStack.top = function () {\n      return this[this.length - 1];\n    };\n    this.inverseMatrixStack = [Matrix.identity()];\n    this.inverseMatrixStack.top = function () {\n      return this[this.length - 1];\n    }\n    this.shouldRender = false;\n    this.camera = {};\n  }\n\n  /**\n    * Renders the Scenegraph\n    * @param  {Node} rootNode                 - The root node of the Scenegraph\n    */\n  render(rootNode) {\n    this.gl.clearColor(.0, .0, .0, .5);\n    this.gl.clear(this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\n    this.lightPositions = [];\n\n    this.shouldRender = false;\n    this.lightSearch = false;\n    rootNode.accept(this);\n    this.setupCamera();\n\n    this.lightSearch = true;\n    rootNode.accept(this);\n    this.lightSearch = false;\n\n    this.shouldRender = true;\n    rootNode.accept(this);\n  }\n\n  /**\n    * Helper function to setup camera matrices\n    */\n  setupCamera() {\n    this.lookat = Matrix.lookat(this.camera.eye, this.camera.center, this.camera.up).mul(this.viewMat);\n    this.perspective = Matrix.perspective(this.camera.fovy, this.camera.aspect, this.camera.near, this.camera.far);\n  }\n\n  /**\n    * Visits a group node\n    * @param  {Node} node - The node to visit\n    */\n  visitGroupNode(node) {\n    this.matrixStack.push(this.matrixStack.top().mul(node.matrix));\n    this.inverseMatrixStack.push(node.matrix.invert().mul(this.inverseMatrixStack.top()));\n    node.children.forEach(child => {\n      child.accept(this);\n    });\n    this.matrixStack.pop();\n    this.inverseMatrixStack.pop();\n  }\n\n  visitCameraNode(node) {\n    if (!this.shouldRender && !this.lightSearch) {\n      this.camera = node;\n      this.cameraModelMat = this.matrixStack.top();\n      this.cameraWorld = this.matrixStack.top().mul(node.eye);\n      this.viewMat = this.inverseMatrixStack.top();\n    }\n  }\n\n  visitLightNode(node) {\n    if (this.lightSearch) {\n      this.lightPositions.push(this.lookat.mul(this.matrixStack.top()).mul(new Vector(0, 0, 0, 1)));\n    }\n  }\n}","// Refer to https://developer.mozilla.org/de/docs/Web/API/WebGL_API/Tutorial/Hinzuf%C3%BCgen_von_2D_Inhalten_in_einen_WebGL-Kontext\n/**\n * Class to assemble a Shader to use with WebGL\n */\nexport default class Shader {\n  /**\n   * Creates a shader\n   * @param {WebGLContext} gl   - The 3D context\n   * @param {string} vertexShaderSource - The id of the vertex shader script node\n   * @param {string} fragmentShaderSource - The id of the fragment shader script node\n   */\n  constructor(gl, vertexShaderSource, fragmentShaderSource) {\n    this.vertexShaderSource = vertexShaderSource;\n    this.fragmentShaderSource = fragmentShaderSource;\n\n    this.gl = gl;\n  }\n\n  async load() {\n    let gl = this.gl;\n    const vertexShader = this.getShader(gl, this.vertexShaderSource, gl.VERTEX_SHADER);\n    const fragmentShader = this.getShader(gl, this.fragmentShaderSource, gl.FRAGMENT_SHADER);\n\n    return Promise.all([vertexShader, fragmentShader]).then(shaderParts => {\n      // Create the shader program\n      this.shaderProgram = gl.createProgram();\n      gl.attachShader(this.shaderProgram, shaderParts[0]);\n      gl.attachShader(this.shaderProgram, shaderParts[1]);\n      gl.linkProgram(this.shaderProgram);\n\n      // If creating the shader program failed, alert\n      if (!gl.getProgramParameter(this.shaderProgram, gl.LINK_STATUS)) {\n        alert(\"Unable to initialize the shader program: \" + gl.getProgramInfoLog(this.shaderProgram));\n      }\n    });\n  }\n\n  /**\n   * Use this shader program for the next\n   * WebGL calls\n   */\n  use() {\n    this.gl.useProgram(this.shaderProgram);\n  }\n\n  /**\n   * Returns the attribute location of a variable in the shader program\n   * @param  {string} name - The name of the variable\n   * @return {number}        The variable's location\n   */\n  getAttributeLocation(name) {\n    const attr = this.gl.getAttribLocation(this.shaderProgram, name);\n    if (attr != -1) {\n      this.gl.enableVertexAttribArray(attr);\n    }\n    return attr;\n  }\n\n  /**\n   * Loads a shader part from its script DOM node and compiles it\n   * @param  {WebGLContext} gl - The 3D context\n   * @param  {string} id - The id of the shader script node\n   * @return {Object}      The resulting shader part\n   */\n  getShader(gl, filename, type) {\n    const shader = gl.createShader(type);\n    // Send the source to the shader object\n    gl.shaderSource(shader, filename);\n    // Compile the shader program\n    gl.compileShader(shader);\n\n    // See if it compiled successfully\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n      alert(\"An error occurred compiling the shaders: \" + gl.getShaderInfoLog(shader));\n      return null;\n    }\n    return shader;\n  }\n\n  /**\n   * Returns an object that can be used to set a matrix on the GPU\n   * @param  {string} name   - The name of the uniform to set\n   * @return {UniformMatrix}   The resulting object\n   */\n  getUniformMatrix(name) {\n    return new UniformMatrix(this.gl,\n      this.gl.getUniformLocation(this.shaderProgram, name)\n    );\n  }\n\n  /**\n     * Returns an object that can be used to set a vector on the GPU\n     * @param  {string} name - The name of the uniform to set\n     * @return {UniformVec4}   The resulting object\n     */\n  getUniformVec4(name) {\n    return new UniformVec4(this.gl,\n      this.gl.getUniformLocation(this.shaderProgram, name)\n    );\n  }\n\n  /**\n   * Returns an object that can be used to set a vector on the GPU\n   * @param  {string} name - The name of the uniform to set\n   * @return {UniformVec3}   The resulting object\n   */\n  getUniformVec3(name) {\n    return new UniformVec3(this.gl,\n      this.gl.getUniformLocation(this.shaderProgram, name)\n    );\n  }\n\n  /**\n   * Returns an object that can be used to set an int on the GPU\n   * @param  {string} name - The name of the uniform to set\n   * @return {UniformInt}    The resulting object\n   */\n  getUniformFloat(name) {\n    return new UniformFloat(this.gl,\n      this.gl.getUniformLocation(this.shaderProgram, name)\n    );\n  }\n\n  /**\n   * Returns an object that can be used to set an int on the GPU\n   * @param  {string} name - The name of the uniform to set\n   * @return {UniformInt}    The resulting object\n   */\n  getUniformInt(name) {\n    return new UniformInt(this.gl,\n      this.gl.getUniformLocation(this.shaderProgram, name)\n    );\n  }\n\n  /**\n   * Wrapper function to retrieve a named Uniform location which can be accessed by the given function\n   * If the location is defined in the shader, also loads the given value into that location\n   * Gives no guarantee that the value and given function have matching types\n   * @param {Function} func - A function pointer\n   * @param {string} name - The location name\n   * @param {Object} value - The value which should be loaded into the location\n   */\n  trySet(func, name, value) {\n    const location = func(name);\n    if (location) {\n      location.set(value);\n    }\n  }\n}\n\n/**\n * Handler class to set uniform matrices\n * in the shader program\n */\nclass UniformMatrix {\n  constructor(gl, position) {\n    this.gl = gl;\n    this.position = position;\n  }\n\n  /**\n   * Sends the given matrix to the GPU\n   * @param {Matrix} matrix - The matrix to send\n   */\n  set(matrix) {\n    this.gl.uniformMatrix4fv(\n      this.position,\n      false,\n      matrix.data);\n  }\n}\n\n/**\n * Handler class to set uniform vectors\n * in the shader program\n */\nclass UniformVec3 {\n  constructor(gl, position) {\n    this.gl = gl;\n    this.position = position;\n  }\n\n  /**\n   * Sends the given vector to the GPU as 3dimensional vector\n   * @param {Vector} vec - The vector to send\n   */\n  set(vec) {\n    this.gl.uniform3f(\n      this.position, vec.x, vec.y, vec.z\n    );\n  }\n}\n\n/**\n * Handler class to set uniform vectors\n * in the shader program\n */\nclass UniformVec4 {\n  constructor(gl, position) {\n    this.gl = gl;\n    this.position = position;\n  }\n\n  /**\n   * Sends the given vector to the GPU as 4dimensional vector\n   * @param {Vector} vec - The vector to send\n   */\n  set(vec) {\n    this.gl.uniform4f(\n      this.position, vec.x, vec.y, vec.z, vec.w\n    );\n  }\n}\n\n/**\n * Handler class to set uniform floats\n * in the shader program\n */\nclass UniformFloat {\n  constructor(gl, position) {\n    this.gl = gl;\n    this.position = position;\n  }\n\n  /**\n   * Sends the given float value to the GPU\n   * @param {number} value - The float value to send\n   */\n  set(value) {\n    this.gl.uniform1f(this.position, value);\n  }\n}\n\n/**\n * Handler class to set uniform ints\n * in the shader program\n */\nclass UniformInt {\n  constructor(gl, position) {\n    this.gl = gl;\n    this.position = position;\n  }\n\n  /**\n   * Sends the given int value to the GPU\n   * @param {number} value - The int value to send\n   */\n  set(value) {\n    this.gl.uniform1i(this.position, value);\n  }\n}","import RasterSphere from '../../scenegraph/rasterizer/raster-sphere.js';\nimport RasterBox from '../../scenegraph/rasterizer/raster-box.js';\nimport RasterTextureBox from '../../scenegraph/rasterizer/raster-texture-box.js';\nimport Vector from '../../math/vector.js';\nimport { phongConfiguration } from \"../../state/stores.js\";\nimport RasterPyramid from '../../scenegraph/rasterizer/raster-pyramid.js';\nimport TextureRasterizable from '../../scenegraph/rasterizer/texture-rasterizable.js';\nimport RasterMesh from '../../scenegraph/rasterizer/raster-mesh.js';\nimport Visitor from '../visitor.js';\nimport Shader from '../../shaders/shader.js';\n\n/**\n * Class representing a Visitor that uses Rasterisation to render a Scenegraph\n */\nexport class RasterVisitor extends Visitor {\n\n  /**\n    * Creates a new RasterVisitor\n    * @param {Object} context - The 3D context to render to\n    * @param {Shader} shader - The \"default\" shader\n    * @param {Shader} textureShader - The texture shader\n    */\n  constructor(context, shader, textureShader) {\n    super(context);\n    this.shader = shader;\n    this.textureShader = textureShader;\n  }\n\n  /**\n   * Visits a sphere node\n   * @param  {Node} node - The node to visit\n   */\n  visit(node) {\n    if (this.shouldRender) {\n      const shader = (node.rasterObject instanceof TextureRasterizable) ? this.textureShader : this.shader;\n      shader.use();\n      phongConfiguration.loadIntoShader(shader);\n      shader.trySet(shader.getUniformMatrix.bind(shader), 'M', this.matrixStack.top());\n      shader.trySet(shader.getUniformMatrix.bind(shader), 'V', this.lookat);\n      shader.trySet(shader.getUniformMatrix.bind(shader), 'P', this.perspective);\n      shader.trySet(shader.getUniformMatrix.bind(shader), 'N', this.lookat.mul(this.matrixStack.top()));\n      this.lightPositions.forEach((light, i) => {\n        shader.trySet(shader.getUniformVec3.bind(shader), 'lightPositions[' + i + ']', new Vector(light.x, light.y, light.z))\n      });\n      shader.trySet(shader.getUniformInt.bind(shader), \"lights\", this.lightPositions.length);\n      node.rasterObject.render(shader);\n    }\n  }\n}\n\n/** Class representing a Visitor that sets up buffers for use by the RasterVisitor */\nexport class RasterSetupVisitor {\n  /**\n   * Creates a new RasterSetupVisitor\n   * @param {Object} context - The 3D context in which to create buffers\n   */\n  constructor(context) {\n    this.gl = context;\n  }\n\n  /**\n   * Sets up all needed buffers\n   * @param  {Node} rootNode - The root node of the Scenegraph\n   */\n  setup(rootNode) {\n    // Clear to white, fully opaque\n    this.gl.clearColor(1.0, 1.0, 1.0, 1.0);\n    // Clear everything\n    this.gl.clearDepth(1.0);\n    // Enable depth testing\n    this.gl.enable(this.gl.DEPTH_TEST);\n    this.gl.depthFunc(this.gl.LEQUAL);\n\n    rootNode.accept(this);\n  }\n\n  visit(node) {\n    node.rasterObject = new rasterNodeClasses[node.constructor.name](this.gl, ...Object.values(node).slice(1));\n  }\n\n  /**\n   * Visits a group node\n   * @param  {Node} node - The node to visit\n   */\n  visitGroupNode(node) {\n    for (let child of node.children) {\n      child.accept(this);\n    }\n  }\n\n  visitCameraNode(node) {\n  }\n\n  visitLightNode(node) {\n  }\n}\n\nconst rasterNodeClasses = {\n  \"SphereNode\": RasterSphere,\n  \"AABoxNode\": RasterBox,\n  \"TextureBoxNode\": RasterTextureBox,\n  \"PyramidNode\": RasterPyramid,\n  \"MeshNode\": RasterMesh\n}","import Rasterizable from \"./rasterizable.js\";\n\n/**\n * A class creating buffers for an axis aligned box to render it with WebGL\n */\nexport default class RasterBox extends Rasterizable {\n  /**\n   * Creates all WebGL buffers for the box\n   *     6 ------- 7\n   *    / |       / |\n   *   3 ------- 2  |\n   *   |  |      |  |\n   *   |  5 -----|- 4\n   *   | /       | /\n   *   0 ------- 1\n   *  looking in negative z axis direction\n   * @param {WebGLContext} gl - The canvas' context\n   * @param {Vector} minPoint - The minimal x,y,z of the box\n   * @param {Vector} maxPoint - The maximal x,y,z of the box\n   */\n  constructor(gl, minPoint, maxPoint, color) {\n    super();\n    this.gl = gl;\n    const mi = minPoint;\n    const ma = maxPoint;\n    this.vertices = [\n      mi.x, mi.y, ma.z,\n      ma.x, mi.y, ma.z,\n      ma.x, ma.y, ma.z,\n      ma.x, ma.y, ma.z,\n      mi.x, ma.y, ma.z,\n      mi.x, mi.y, ma.z,\n      ma.x, mi.y, mi.z,\n      mi.x, mi.y, mi.z,\n      mi.x, ma.y, mi.z,\n      mi.x, ma.y, mi.z,\n      ma.x, ma.y, mi.z,\n      ma.x, mi.y, mi.z,\n      ma.x, mi.y, ma.z,\n      ma.x, mi.y, mi.z,\n      ma.x, ma.y, mi.z,\n      ma.x, ma.y, mi.z,\n      ma.x, ma.y, ma.z,\n      ma.x, mi.y, ma.z,\n      mi.x, ma.y, ma.z,\n      ma.x, ma.y, ma.z,\n      ma.x, ma.y, mi.z,\n      ma.x, ma.y, mi.z,\n      mi.x, ma.y, mi.z,\n      mi.x, ma.y, ma.z,\n      mi.x, mi.y, mi.z,\n      mi.x, mi.y, ma.z,\n      mi.x, ma.y, ma.z,\n      mi.x, ma.y, ma.z,\n      mi.x, ma.y, mi.z,\n      mi.x, mi.y, mi.z,\n      mi.x, mi.y, mi.z,\n      ma.x, mi.y, mi.z,\n      ma.x, mi.y, ma.z,\n      ma.x, mi.y, ma.z,\n      mi.x, mi.y, ma.z,\n      mi.x, mi.y, mi.z,\n    ];\n    this.indices = [...Array(36).keys()];\n    this.normals = [\n      // front\n      0., 0., 1.,\n      0., 0., 1.,\n      0., 0., 1.,\n      0., 0., 1.,\n      0., 0., 1.,\n      0., 0., 1.,\n      // back\n      0., 0., -1.,\n      0., 0., -1.,\n      0., 0., -1.,\n      0., 0., -1.,\n      0., 0., -1.,\n      0., 0., -1.,\n      // right\n      1.0, 0., 0.,\n      1.0, 0., 0.,\n      1.0, 0., 0.,\n      1.0, 0., 0.,\n      1.0, 0., 0.,\n      1.0, 0., 0.,\n      // top\n      0., 1., 0.,\n      0., 1., 0.,\n      0., 1., 0.,\n      0., 1., 0.,\n      0., 1., 0.,\n      0., 1., 0.,\n      // left\n      -1.0, 0., 0.,\n      -1.0, 0., 0.,\n      -1.0, 0., 0.,\n      -1.0, 0., 0.,\n      -1.0, 0., 0.,\n      -1.0, 0., 0.,\n      // bottom\n      0., -1., 0.,\n      0., -1., 0.,\n      0., -1., 0.,\n      0., -1., 0.,\n      0., -1., 0.,\n      0., -1., 0.\n    ];\n\n    this.colors = [];\n    for (let i = 0; i < this.vertices.length / 3; i++) {\n      this.colors.push(color.r);\n      this.colors.push(color.g);\n      this.colors.push(color.b);\n      this.colors.push(color.a);\n    }\n\n    this.fillBuffers();\n  }\n}\n","import TextureRasterizable from \"./texture-rasterizable\";\n\n/**\n * A class creating buffers for a textured box to render it with WebGL\n */\nexport default class RasterTextureBox extends TextureRasterizable {\n  /**\n   * Creates all WebGL buffers for the textured box\n   *     6 ------- 7\n   *    / |       / |\n   *   3 ------- 2  |\n   *   |  |      |  |\n   *   |  5 -----|- 4\n   *   | /       | /\n   *   0 ------- 1\n   *  looking in negative z axis direction\n   * @param {WebGLContext} gl - The canvas' context\n   * @param {Vector} minPoint - The minimal x,y,z of the box\n   * @param {Vector} maxPoint - The maximal x,y,z of the box\n   */\n  constructor(gl, minPoint, maxPoint, texture, normalMap) {\n    super();\n    this.loaded = false;\n    this.gl = gl;\n    const mi = minPoint;\n    const ma = maxPoint;\n    this.vertices = [\n      // front\n      mi.x, mi.y, ma.z,\n      ma.x, mi.y, ma.z,\n      ma.x, ma.y, ma.z,\n      ma.x, ma.y, ma.z,\n      mi.x, ma.y, ma.z,\n      mi.x, mi.y, ma.z,\n      // back\n      ma.x, mi.y, mi.z,\n      mi.x, mi.y, mi.z,\n      mi.x, ma.y, mi.z,\n      mi.x, ma.y, mi.z,\n      ma.x, ma.y, mi.z,\n      ma.x, mi.y, mi.z,\n      // right\n      ma.x, mi.y, ma.z,\n      ma.x, mi.y, mi.z,\n      ma.x, ma.y, mi.z,\n      ma.x, ma.y, mi.z,\n      ma.x, ma.y, ma.z,\n      ma.x, mi.y, ma.z,\n      // top\n      mi.x, ma.y, ma.z,\n      ma.x, ma.y, ma.z,\n      ma.x, ma.y, mi.z,\n      ma.x, ma.y, mi.z,\n      mi.x, ma.y, mi.z,\n      mi.x, ma.y, ma.z,\n      // left\n      mi.x, mi.y, mi.z,\n      mi.x, mi.y, ma.z,\n      mi.x, ma.y, ma.z,\n      mi.x, ma.y, ma.z,\n      mi.x, ma.y, mi.z,\n      mi.x, mi.y, mi.z,\n      // bottom\n      mi.x, mi.y, mi.z,\n      ma.x, mi.y, mi.z,\n      ma.x, mi.y, ma.z,\n      ma.x, mi.y, ma.z,\n      mi.x, mi.y, ma.z,\n      mi.x, mi.y, mi.z\n    ];\n\n    const vertexBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(this.vertices), gl.STATIC_DRAW);\n    this.vertexBuffer = vertexBuffer;\n    this.elements = this.vertices.length / 3;\n\n\n\n    new Promise((resolve, _) => {\n      let cubeTexture = gl.createTexture();\n      let cubeImage = new Image();\n      cubeImage.onload = () => {\n        gl.bindTexture(gl.TEXTURE_2D, cubeTexture);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, cubeImage);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n        resolve()\n      };\n      cubeImage.src = texture;\n      this.texBuffer = cubeTexture;\n    }).then(() => {\n      let normalMapTexture = gl.createTexture();\n      let normalMapImage = new Image();\n      normalMapImage.onload = () => {\n        gl.bindTexture(gl.TEXTURE_2D, normalMapTexture);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, normalMapImage);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n      };\n      normalMapImage.src = normalMap;\n      this.normalMapBuffer = normalMapTexture;\n    }).then(() => this.loaded = true);\n\n    let uv = [\n      // front\n      0, 0,\n      1, 0,\n      1, 1,\n      1, 1,\n      0, 1,\n      0, 0,\n      // back\n      0, 0,\n      1, 0,\n      1, 1,\n      1, 1,\n      0, 1,\n      0, 0,\n      // right\n      0, 0,\n      1, 0,\n      1, 1,\n      1, 1,\n      0, 1,\n      0, 0,\n      // top\n      0, 0,\n      1, 0,\n      1, 1,\n      1, 1,\n      0, 1,\n      0, 0,\n      // left\n      0, 0,\n      1, 0,\n      1, 1,\n      1, 1,\n      0, 1,\n      0, 0,\n      // bottom\n      0, 0,\n      1, 0,\n      1, 1,\n      1, 1,\n      0, 1,\n      0, 0\n    ];\n    let uvBuffer = this.gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, uvBuffer);\n    gl.bufferData(this.gl.ARRAY_BUFFER, new Float32Array(uv), gl.STATIC_DRAW);\n    this.texCoords = uvBuffer;\n\n    this.normals = [\n      // front\n      0., 0., 1.,\n      0., 0., 1.,\n      0., 0., 1.,\n      0., 0., 1.,\n      0., 0., 1.,\n      0., 0., 1.,\n      // back\n      0., 0., -1.,\n      0., 0., -1.,\n      0., 0., -1.,\n      0., 0., -1.,\n      0., 0., -1.,\n      0., 0., -1.,\n      // right\n      1.0, 0., 0.,\n      1.0, 0., 0.,\n      1.0, 0., 0.,\n      1.0, 0., 0.,\n      1.0, 0., 0.,\n      1.0, 0., 0.,\n      // top\n      0., 1., 0.,\n      0., 1., 0.,\n      0., 1., 0.,\n      0., 1., 0.,\n      0., 1., 0.,\n      0., 1., 0.,\n      // left\n      -1.0, 0., 0.,\n      -1.0, 0., 0.,\n      -1.0, 0., 0.,\n      -1.0, 0., 0.,\n      -1.0, 0., 0.,\n      -1.0, 0., 0.,\n      // bottom\n      0., -1., 0.,\n      0., -1., 0.,\n      0., -1., 0.,\n      0., -1., 0.,\n      0., -1., 0.,\n      0., -1., 0.\n    ];\n    const normalBuffer = this.gl.createBuffer();\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, normalBuffer);\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, new Float32Array(this.normals), this.gl.STATIC_DRAW);\n    this.normalBuffer = normalBuffer;\n  }\n\n}\n","import Rasterizable from \"./rasterizable\";\nimport Vector from \"../../math/vector.js\";\n\n/**\n * A class creating buffers for an pyramid to render it with WebGL\n */\nexport default class RasterPyramid extends Rasterizable {\n  /**\n   * Creates all WebGL buffers for the pyramid\n   *\n   *        4\n   *       / \\`.\n   *      /   \\ `.\n   *     / 3   \\  `2\n   *    /_______\\/\n   *   0        1\n   *\n   *  looking in negative z axis direction\n   * @param {WebGLContext} gl - The canvas' context\n   * @param {Vector} minPoint - The minimal x,y,z of the pyramid\n   * @param {Vector} maxPoint - The maximal x,y,z of the pyramid\n   */\n  constructor(gl, minPoint, maxPoint, height, color) {\n    super();\n    this.gl = gl;\n    const mi = minPoint;\n    const ma = maxPoint;\n    const top = new Vector((mi.x + ma.x) / 2, mi.y + height, (mi.z + ma.z) / 2, 1);\n    this.vertices = [\n      mi.x, mi.y, ma.z,\n      ma.x, mi.y, ma.z,\n      top.x, top.y, top.z,\n      ma.x, mi.y, ma.z,\n      ma.x, mi.y, mi.z,\n      top.x, top.y, top.z,\n      mi.x, mi.y, mi.z,\n      mi.x, mi.y, ma.z,\n      top.x, top.y, top.z,\n      ma.x, mi.y, mi.z,\n      mi.x, mi.y, mi.z,\n      top.x, top.y, top.z,\n      ma.x, mi.y, mi.z,\n      ma.x, mi.y, ma.z,\n      mi.x, mi.y, ma.z,\n      mi.x, mi.y, ma.z,\n      mi.x, mi.y, mi.z,\n      ma.x, mi.y, mi.z,\n    ];\n    this.indices = [...Array(this.vertices.length / 3).keys()];\n\n    this.calcNormals();\n\n    this.colors = [];\n    for (let i = 0; i < this.vertices.length / 3; i++) {\n      this.colors.push(color.r);\n      this.colors.push(color.g);\n      this.colors.push(color.b);\n      this.colors.push(color.a);\n    }\n\n    this.fillBuffers();\n  }\n}\n","import Visitor from '../visitor.js';\nimport Shader from '../../shaders/shader.js';\nimport Vector from '../../math/vector.js';\nimport { SphereNode } from '../../scenegraph/nodes.js';\nimport { phongConfiguration } from \"../../state/stores.js\";\n\n/**\n * Class representing a Visitor that uses\n * Raytracing to render a Scenegraph\n */\nexport default class RayVisitor extends Visitor {\n  /**\n   * Creates a new RayVisitor\n   * @param {Object} context - The webgl context to render to\n   * @param {Shader} shader - The raytracer shader\n   */\n  constructor(context, shader) {\n    super(context);\n    this.shader = shader;\n  }\n\n  setupCamera() {\n    super.setupCamera();\n    this.fillBuffers();\n  }\n\n  /**\n   * Renders the Scenegraph\n   * @param  {Node} rootNode - The root node of the Scenegraph\n   */\n  render(rootNode) {\n    this.sphereCenters = [];\n    this.sphereRadii = [];\n    this.sphereColors = [];\n    super.render(rootNode);\n    const shader = this.shader;\n    shader.use();\n    shader.trySet(shader.getUniformVec3.bind(shader), \"camera\", this.cameraWorld);\n    shader.trySet(shader.getUniformMatrix.bind(shader), \"iMVP\", (this.perspective.mul(this.lookat)).invert());\n    phongConfiguration.loadIntoShader(this.shader);\n    this.sphereCenters.forEach((center, i) => {\n      shader.trySet(shader.getUniformVec3.bind(shader), 'sphereCenters[' + i + ']', new Vector(center.x, center.y, center.z));\n    });\n    this.sphereColors.forEach((color, i) => {\n      shader.trySet(shader.getUniformVec4.bind(shader), 'sphereColors[' + i + ']', new Vector(color.x, color.y, color.z, 1.0));\n    });\n    this.sphereRadii.forEach((radius, i) => {\n      shader.trySet(shader.getUniformFloat.bind(shader), 'sphereRadii[' + i + ']', radius);\n    });\n    shader.trySet(shader.getUniformInt.bind(shader), \"spheres\", this.sphereCenters.length);\n    this.lightPositions.forEach((light, i) => {\n      shader.trySet(shader.getUniformVec3.bind(shader), 'lightPositions[' + i + ']', new Vector(light.x, light.y, light.z))\n    });\n    shader.trySet(shader.getUniformInt.bind(shader), \"lights\", this.lightPositions.length);\n    this.draw();\n  }\n\n  fillBuffers() {\n    this.screenBuffer = this.gl.createBuffer();\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.screenBuffer);\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, new Float32Array([\n      1.0, 1.0,\n      -1.0, 1.0,\n      1.0, -1.0,\n      -1.0, -1.0,\n    ]), this.gl.STATIC_DRAW);\n  }\n\n  draw() {\n    phongConfiguration.loadIntoShader(this.shader);\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.screenBuffer);\n    const aVertexPosition = this.shader.getAttributeLocation('a_vertexPosition');\n    this.gl.enableVertexAttribArray(aVertexPosition);\n    this.gl.vertexAttribPointer(aVertexPosition, 2, this.gl.FLOAT, false, 0, 0);\n\n    this.gl.drawArrays(this.gl.TRIANGLE_STRIP, 0, 4);\n\n    this.gl.disableVertexAttribArray(aVertexPosition);\n  }\n\n  visit(node) {\n    if (!this.shouldRender || !(node instanceof SphereNode)) {\n      return;\n    }\n    this.sphereCenters.push(this.matrixStack.top().mul(new Vector(0, 0, 0, 1)));\n    this.sphereRadii.push(node.radius);\n    this.sphereColors.push(node.color);\n  }\n\n}\n","import Intersection from '../renderer/raytracer/intersection.js';\nimport Vector from './vector.js';\n\n/**\n * A class representing a sphere\n */\nexport default class Sphere {\n  /**\n   * Creates a new Sphere with center and radius\n   * @param  {Vector} center - The center of the Sphere\n   * @param  {number} radius - The radius of the Sphere\n   */\n  constructor(center, radius) {\n    this.center = center;\n    this.radius = radius;\n  }\n\n  /**\n   * Calculates the intersection of the sphere with the given ray\n   * @param  {{origin, direction}} ray      - The ray to intersect with\n   * @return {Intersection}   The intersection if there is one, null if there is none\n   */\n  intersect(ray) {\n    let rayOrigin = ray.origin;\n    let rayDir = ray.direction;\n\n    let t = this.center.sub(rayOrigin).dot(rayDir);\n    if (t > 0) {\n      let perp = rayOrigin.add(rayDir.mul(t));\n      let y = this.center.sub(perp).length;\n      if (y < this.radius) {\n        let x = Math.sqrt(this.radius * this.radius - y * y);\n        let t1 = t - x;\n        let t2 = t + x;\n        let firstHitDistance = Math.min(t1, t2);\n        // console.log(rayDir.mul(firstHitDistance));\n        return new Intersection(\n          firstHitDistance,\n          rayOrigin.add(rayDir.mul(firstHitDistance)),\n          rayOrigin.add(rayDir.mul(firstHitDistance)).sub(this.center).normalised()\n        );\n      }\n    }\n    return null;\n  }\n}\n","import Visitor from \"../visitor.js\";\nimport Matrix from \"../../math/matrix.js\";\nimport RasterSphere from \"../../scenegraph/rasterizer/raster-sphere.js\";\nimport { phongConfiguration, mousePosition, hoveredNode, mouseClicked, sceneGraph, selectedNode } from \"../../state/stores.js\";\nimport { get } from \"svelte/store\";\nimport Vector from \"../../math/vector.js\";\nimport { SphereNode } from \"../../scenegraph/nodes.js\";\nimport Sphere from \"../../math/sphere.js\";\nimport Intersection from \"../raytracer/intersection.js\";\n\nexport class CollisionVisitor extends Visitor {\n  /**\n    * Creates a new CollisionVisitor\n    * @param {Object} context - The 3D context to render to\n    */\n  constructor(context, shader) {\n    super(context);\n    this.shader = shader;\n    this.renderActive = false;\n    this.intersectActive = false;\n  }\n\n  toggleRender() {\n    this.renderActive = !this.renderActive;\n  }\n\n  toggleIntersect() {\n    this.intersectActive = !this.intersectActive;\n  }\n\n  render(rootNode) {\n    this.minIntersection = new Intersection();\n    this.intersectedNode = {};\n    sceneGraph.remove(\"debug\");\n    this.lightSearch = false;\n    this.shouldRender = false;\n    this.intersectionSearch = false;\n    rootNode.accept(this);\n    this.setupCamera();\n    this.intersectionSearch = true;\n    rootNode.accept(this);\n    if (this.intersectActive) {\n      hoveredNode.set(this.intersectedNode);\n    }\n    this.intersectionSearch = false;\n    this.shouldRender = true;\n    rootNode.accept(this);\n    if (get(mouseClicked)) {\n      selectedNode.set(get(hoveredNode));\n    }\n  }\n\n  draw(node) {\n    const shader = this.shader;\n    shader.use();\n    phongConfiguration.loadIntoShader(shader);\n    shader.trySet(shader.getUniformMatrix.bind(shader), 'M', this.matrixStack.top());\n    shader.trySet(shader.getUniformMatrix.bind(shader), 'V', this.lookat);\n    shader.trySet(shader.getUniformMatrix.bind(shader), 'P', this.perspective);\n    if (node == get(hoveredNode)) {\n      shader.trySet(shader.getUniformVec4.bind(shader), 'color', new Vector(1, 1, 0, 0.5));\n    } else if (node == get(selectedNode)) {\n      shader.trySet(shader.getUniformVec4.bind(shader), 'color', new Vector(1, 0.64, 0, 0.5));\n    } else {\n      shader.trySet(shader.getUniformVec4.bind(shader), 'color', new Vector(1, 0, 0, 0.5));\n    }\n    node.rasterBoundingSphere.render(shader);\n  }\n\n  // rayDirection = (farPlane.xyz - nearPlane.xyz);\n  // rayOrigin = nearPlane.xyz;\n\n  getIntersection(node) {\n    const toWorld = (this.perspective.mul(this.lookat)).invert();\n    let near = toWorld.mul(new Vector(get(mousePosition).x, get(mousePosition).y, -1, 1));\n    near = near.div(near.w);\n    let far = toWorld.mul(new Vector(get(mousePosition).x, get(mousePosition).y, 1, 1));\n    far = far.div(far.w);\n    const intersection = new Sphere(this.matrixStack.top().mul(node.boundingSphere.center),\n      node.boundingSphere.radius).intersect({ origin: near, direction: (far.sub(near)).normalised() });\n    if (intersection && intersection.closerThan(this.minIntersection)) {\n      this.minIntersection = intersection;\n      this.intersectedNode = node;\n    }\n  }\n\n  /**\n   * Visits a sphere node\n   * @param  {Node} node - The node to visit\n   */\n  visit(node) {\n    if (node.rasterBoundingSphere) {\n      if (this.renderActive && this.shouldRender) {\n        this.draw(node);\n      }\n      if (this.intersectActive && this.intersectionSearch) {\n        this.getIntersection(node);\n      }\n    }\n  }\n\n  visitCameraNode(node) {\n    if (!this.shouldRender && !this.intersectionSearch) {\n      super.visitCameraNode(node);\n    }\n  }\n}\n\n/** Class representing a Visitor that sets up buffers for use by the RasterVisitor */\nexport class CollisionSetupVisitor {\n  /**\n   * Creates a new CollisionSetupVisitor\n   * @param {Object} context - The 3D context in which to create buffers\n   */\n  constructor(context) {\n    this.gl = context;\n  }\n\n  /**\n   * Sets up all needed buffers\n   * @param  {Node} rootNode - The root node of the Scenegraph\n   */\n  setup(rootNode) {\n    rootNode.accept(this);\n  }\n\n  visit(node) {\n    if (!node.id.includes(\"noColl\")) {\n      const wrap = () => {\n        if (node.rasterObject.vertices.length === 0) {\n          setTimeout(wrap, 1000);\n        } else {\n          const vertexComponents = node.rasterObject.vertices;\n          const vertices = [];\n          for (let i = 0; i < vertexComponents.length; i += 3) {\n            vertices.push(new Vector(vertexComponents[i], vertexComponents[i + 1], vertexComponents[i + 2], 1));\n          }\n          const { ritterCenter, ritterRadius } = calcRitter(vertices);\n          node.boundingSphere = new SphereNode(\"\", ritterCenter, ritterRadius, new Vector(0, 0, 0, 0));\n          node.rasterBoundingSphere = new RasterSphere(this.gl, ritterCenter, ritterRadius, new Vector(1, 0, 0, 0.5));\n        }\n      };\n      wrap();\n    }\n  }\n\n  /**\n   * Visits a group node\n   * @param  {Node} node - The node to visit\n   */\n  visitGroupNode(node) {\n    for (let child of node.children) {\n      child.accept(this);\n    }\n  }\n\n  visitCameraNode(node) {\n  }\n\n  visitLightNode(node) {\n  }\n}\n\nconst currentMax = (x) => (acc, vert) => {\n  const distance = x.sub(vert).length;\n  if (distance > acc.currMin) {\n    return { currMin: distance, currentMax: vert };\n  } else {\n    return acc;\n  }\n};\n\nconst calcRitter = (vertices) => {\n  const x = vertices[0];\n  let y = vertices.reduce(currentMax(x), { currMin: 0, currentMax: {} }).currentMax;\n  let z = vertices.reduce(currentMax(y), { currMin: 0, currentMax: {} }).currentMax;\n  let radius = y.sub(z).length / 2;\n  let center = y.add(z.sub(y).mul(0.5));\n  const max = 10;\n  let i = 0;\n  while (vertices.filter(v => v.sub(center).length > (radius + 0.005)).length > 0 && i++ < max) {\n    const newY = vertices.filter(v => v.sub(center).length > (radius + 0.005))[0];\n    const newZ = center.add(newY.sub(center).normalised().mul(-radius));\n    radius = newY.sub(newZ).length / 2;\n    center = newY.add(newZ.sub(newY).mul(0.5));\n    y = newY;\n    z = newZ;\n  }\n  return { ritterCenter: center, ritterRadius: radius };\n}","import Matrix from '../math/matrix.js';\nimport Vector from '../math/vector.js';\nimport { selectedNode, keysPressed, mouseOffsets } from '../state/stores.js';\nimport { get } from \"svelte/store\";\nimport { sceneGraph } from \"../state/stores.js\";\nimport { GroupNode } from \"../scenegraph/nodes.js\";\n\n/**\n * Class representing an Animation\n */\nclass AnimationNode {\n  /**\n   * Creates a new AnimationNode\n   */\n  constructor(groupNodeId) {\n    this.active = true;\n    const nodeStack = [];\n    nodeStack.push.apply(nodeStack, get(sceneGraph).children);\n    nodeStack.push(get(sceneGraph));\n    while (nodeStack.length > 0) {\n      const currNode = nodeStack.pop();\n      if (currNode.id == groupNodeId) {\n        this.groupNode = currNode;\n        break;\n      }\n      if (currNode instanceof GroupNode) {\n        nodeStack.push.apply(nodeStack, currNode.children);\n      }\n    }\n  }\n\n  /**\n   * Toggles the active state of the animation node\n   */\n  toggleActive() {\n    this.active = !this.active;\n  }\n}\n\n/**\n * Class representing a Rotation Animation\n * @extends AnimationNode\n */\nexport class RotationNode extends AnimationNode {\n  /**\n   * Creates a new RotationNode\n   * @param {string} groupNodeId - The group node to attach to\n   * @param {Vector} axis         - The axis to rotate around\n   */\n  constructor(groupNodeId, axis, angle) {\n    super(groupNodeId);\n    this.angle = angle;\n    this.axis = axis;\n    this.origin = this.groupNode.matrix.transpose().transpose();\n    this.currentAngle = 0;\n  }\n\n  /**\n   * Advances the animation by deltaT\n   * @param  {number} deltaT - The time difference, the animation is advanced by\n   */\n  simulate(deltaT) {\n    if (this.active) {\n      this.currentAngle += (this.angle * deltaT / 1000) % 360;\n      this.groupNode.matrix = Matrix.rotation(this.axis, this.currentAngle).mul(this.origin);\n    }\n  }\n\n  toJSON() {\n    return {\n      type: this.constructor.name,\n      groupNodeId: this.groupNode.id,\n      axis: this.axis,\n      currentAngle: this.currentAngle,\n      origin: this.origin,\n      angle: this.angle,\n    }\n  }\n\n  static fromJSON(obj) {\n    const axis = new Vector(obj.axis._x, obj.axis._y, obj.axis._z, obj.axis._w);\n    const result = new RotationNode(obj.groupNodeId, axis, obj.angle);\n    result.currentAngle = obj.currentAngle;\n    result.origin.data = obj.origin.data;\n    return result;\n  }\n}\n\n/**\n * Class representing a Rotation Animation\n * @extends AnimationNode\n */\nexport class BouncingNode extends AnimationNode {\n  /**\n   * Creates a new BouncingNode\n   * @param {string} groupNodeId - The group node to attach to\n   * @param {Vector} axis         - The axis to rotate around\n   * @param {number} distance     - The distance to move on the axis\n   */\n  constructor(groupNodeId, axis, distance, speed) {\n    super(groupNodeId);\n    this.distance = distance;\n    this.speed = speed;\n    this.axis = axis;\n    this.value = 0;\n    this.translation = Matrix.identity();\n    this.origin = this.groupNode.matrix.transpose().transpose();\n  }\n\n  /**\n   * Advances the animation by deltaT\n   * @param  {number} deltaT - The time difference, the animation is advanced by\n   */\n  simulate(deltaT) {\n    if (this.active) {\n      this.value += deltaT / (1000 / this.speed);\n      this.groupNode.matrix = this.translation.mul(\n        Matrix.translation(this.axis.mul(Math.sin(this.value) * this.distance))).mul(\n          this.origin);\n    }\n  }\n\n  toJSON() {\n    return {\n      type: this.constructor.name,\n      groupNodeId: this.groupNode.id,\n      axis: this.axis,\n      distance: this.distance,\n      speed: this.speed,\n      translation: this.translation,\n      value: this.value,\n      origin: this.origin,\n    }\n  }\n\n  static fromJSON(obj) {\n    const axis = new Vector(obj.axis._x, obj.axis._y, obj.axis._z, obj.axis._w);\n    const result = new BouncingNode(obj.groupNodeId, axis, obj.distance, obj.speed);\n    result.translation.data = obj.translation.data;\n    result.value = obj.value;\n    result.origin.data = obj.origin.data;\n    return result;\n  }\n}\n\n/**\n * Class representing a Rotation Animation\n * @extends AnimationNode\n */\nexport class ManualRotationNode extends AnimationNode {\n  /**\n   * Creates a new ManualRotationNode\n   * @param {GroupNode} groupNode - The group node to attach to\n   * @param {Vector} axis         - The axis to rotate around\n   */\n  constructor(groupNodeId, axis) {\n    super(groupNodeId);\n    this.angle = 90;\n    this.axis = axis;\n    this.origin = this.groupNode.matrix.transpose().transpose();\n    this.currentAngle = 0;\n  }\n\n  /**\n   * Advances the animation by deltaT\n   * @param  {number} deltaT - The time difference, the animation is advanced by\n   */\n  simulate(deltaT) {\n    if (this.active) {\n      if (get(selectedNode) === this.groupNode) {\n        if (get(keysPressed).get(\"ArrowRight\")) {\n          this.currentAngle += (-this.angle * deltaT / 1000) % 360;\n        }\n        if (get(keysPressed).get(\"ArrowLeft\")) {\n          this.currentAngle += (this.angle * deltaT / 1000) % 360;\n        }\n        this.groupNode.matrix = Matrix.rotation(this.axis, this.currentAngle).mul(this.origin);\n\n      }\n    }\n  }\n\n  toJSON() {\n    return {\n      type: this.constructor.name,\n      groupNodeId: this.groupNode.id,\n      axis: this.axis,\n      currentAngle: this.currentAngle,\n      origin: this.origin,\n    }\n  }\n\n  static fromJSON(obj) {\n    const axis = new Vector(obj.axis._x, obj.axis._y, obj.axis._z, obj.axis._w);\n    const result = new ManualRotationNode(obj.groupNodeId, axis);\n    result.currentAngle = obj.currentAngle;\n    result.origin.data = obj.origin.data;\n    return result;\n  }\n}\n\nexport class DriverNode extends AnimationNode {\n  /**\n     * Creates a new FreeFlightNode\n     * @param {GroupNode} groupNode - The group node to attach to\n     */\n  constructor(groupNodeId, firstAxis, secondAxis, speed) {\n    super(groupNodeId);\n    this.speed = speed;\n    this.firstAxis = firstAxis;\n    this.secondAxis = secondAxis;\n    this.origin = this.groupNode.matrix.transpose().transpose();\n    this.translationMatrix = Matrix.identity();\n    this.active = true;\n  }\n\n  /**\n    * Advances the animation by deltaT\n    * @param  {number} deltaT - The time difference, the animation is advanced by\n    */\n  simulate(deltaT) {\n    if (this.active) {\n      if (get(selectedNode) === this.groupNode) {\n        if (get(keysPressed).get(\"ArrowRight\")) {\n          this.translationMatrix = Matrix.translation(this.firstAxis.mul(deltaT * this.speed / 1000)).mul(this.translationMatrix);\n        }\n        if (get(keysPressed).get(\"ArrowLeft\")) {\n          this.translationMatrix = Matrix.translation(this.firstAxis.mul(-deltaT * this.speed / 1000)).mul(this.translationMatrix);\n        }\n        if (get(keysPressed).get(\"ArrowUp\")) {\n          this.translationMatrix = Matrix.translation(this.secondAxis.mul(deltaT * this.speed / 1000)).mul(this.translationMatrix);\n        }\n        if (get(keysPressed).get(\"ArrowDown\")) {\n          this.translationMatrix = Matrix.translation(this.secondAxis.mul(-deltaT * this.speed / 1000)).mul(this.translationMatrix);\n        }\n        this.groupNode.matrix = this.translationMatrix.mul(this.origin);\n      }\n    }\n  }\n\n\n  toJSON() {\n    return {\n      type: this.constructor.name,\n      groupNodeId: this.groupNode.id,\n      translationMatrix: this.translationMatrix,\n      origin: this.origin,\n      firstAxis: this.firstAxis,\n      secondAxis: this.secondAxis,\n      speed: this.speed,\n    }\n  }\n\n  static fromJSON(obj) {\n    const firstAxis = new Vector(obj.firstAxis._x, obj.firstAxis._y, obj.firstAxis._z, obj.firstAxis._w);\n    const secondAxis = new Vector(obj.secondAxis._x, obj.secondAxis._y, obj.secondAxis._z, obj.secondAxis._w);\n    const result = new DriverNode(obj.groupNodeId, firstAxis, secondAxis, obj.speed);\n    result.translationMatrix.data = obj.translationMatrix.data;\n    result.origin.data = obj.origin.data;\n    return result;\n  }\n}\n\n/**\n * Class representing a Rotation Animation\n * @extends AnimationNode\n */\nexport class FreeFlightNode extends AnimationNode {\n  /**\n   * Creates a new FreeFlightNode\n   * @param {GroupNode} groupNode - The group node to attach to\n   * @param {number} mouseSensitivity - The mouse sensitivity\n   */\n  constructor(groupNodeId, mouseSensitivity) {\n    super(groupNodeId);\n    this.mouseSensitivity = mouseSensitivity;\n    this.origin = this.groupNode.matrix.transpose().transpose();\n    this.currentX = 0;\n    this.currentY = 0;\n    this.translationMatrix = Matrix.identity();\n    this.active = false;\n  }\n\n  /**\n   * Advances the animation by deltaT\n   * @param  {number} deltaT - The time difference, the animation is advanced by\n   */\n  simulate(deltaT) {\n    if (this.active) {\n      if (get(keysPressed).get(\"a\")) {\n        this.translationMatrix = Matrix.translation(this.groupNode.matrix.getLeftVector().mul(-10 * deltaT / 1000)).mul(this.translationMatrix);\n      }\n      if (get(keysPressed).get(\"d\")) {\n        this.translationMatrix = Matrix.translation(this.groupNode.matrix.getLeftVector().mul(10 * deltaT / 1000)).mul(this.translationMatrix);\n      }\n      if (get(keysPressed).get(\"w\")) {\n        this.translationMatrix = Matrix.translation(this.groupNode.matrix.getForwardVector().mul(-10 * deltaT / 1000)).mul(this.translationMatrix);\n      }\n      if (get(keysPressed).get(\"s\")) {\n        this.translationMatrix = Matrix.translation(this.groupNode.matrix.getForwardVector().mul(10 * deltaT / 1000)).mul(this.translationMatrix);\n      }\n      if (get(keysPressed).get(\"q\")) {\n        this.translationMatrix = Matrix.translation(this.groupNode.matrix.getUpVector().mul(10 * deltaT / 1000)).mul(this.translationMatrix);\n      }\n      if (get(keysPressed).get(\"e\")) {\n        this.translationMatrix = Matrix.translation(this.groupNode.matrix.getUpVector().mul(-10 * deltaT / 1000)).mul(this.translationMatrix);\n      }\n      this.currentY += -get(mouseOffsets).y * deltaT / 100 * this.mouseSensitivity;\n      this.currentX += -get(mouseOffsets).x * deltaT / 100 * this.mouseSensitivity;\n      this.groupNode.matrix = this.translationMatrix.mul(\n        Matrix.rotation(new Vector(0, 1, 0), this.currentX).mul(Matrix.rotation(new Vector(1, 0, 0), this.currentY))).mul(this.origin);\n      mouseOffsets.reset();\n    }\n  }\n\n  toJSON() {\n    return {\n      type: this.constructor.name,\n      groupNodeId: this.groupNode.id,\n      mouseSensitivity: this.mouseSensitivity,\n      currentX: this.currentX,\n      currentY: this.currentY,\n      translationMatrix: this.translationMatrix,\n      origin: this.origin,\n    }\n  }\n\n  static fromJSON(obj) {\n    const result = new FreeFlightNode(obj.groupNodeId, obj.mouseSensitivity);\n    result.currentX = obj.currentX;\n    result.currentY = obj.currentY;\n    result.translationMatrix = new Matrix([]);\n    result.translationMatrix.data = obj.translationMatrix.data;\n    result.origin.data = obj.origin.data;\n    return result;\n  }\n}\n\nexport const animationNodeClasses = {\n  \"RotationNode\": RotationNode,\n  \"BouncingNode\": BouncingNode,\n  \"ManualRotationNode\": ManualRotationNode,\n  \"FreeFlightNode\": FreeFlightNode,\n  \"DriverNode\": DriverNode,\n}","import { GroupNode, SphereNode, AABoxNode, TextureBoxNode, PyramidNode, CameraNode, LightNode, MeshNode } from './scenegraph/nodes.js'\nimport {\n  sceneGraph,\n  animationNodes,\n} from \"./state/stores.js\";\nimport {\n  RotationNode,\n  BouncingNode,\n  ManualRotationNode,\n  FreeFlightNode,\n  DriverNode,\n} from \"./scenegraph/animation-nodes.js\";\nimport Vector from \"./math/vector.js\";\nimport Matrix from \"./math/matrix.js\";\nimport Sphere from './math/sphere.js';\n\nconst createDemoSceneGraph = (canvas) => {\n  sceneGraph.set(\n    new GroupNode(\"root\", Matrix.identity())\n  );\n  const baseTranslation = new GroupNode(\"baseTranslation\", Matrix.translation(new Vector(0, 0, -8)));\n  const desktopBase = new GroupNode(\"desktopBase\", Matrix.identity());\n  baseTranslation.add(desktopBase);\n  desktopBase.add(\n    new TextureBoxNode(\n      \"towerBase\",\n      new Vector(-2, -2, -2, 1),\n      new Vector(2, 2, 2, 1),\n      \"hci-logo.png\",\n      \"wood.jpg\",\n    )\n  );\n  const clockHandRoot = new GroupNode(\"clockHandRoot\", Matrix.translation(new Vector(0, 0, 2)));\n  clockHandRoot.add(\n    new PyramidNode(\n      \"clockHand\",\n      new Vector(-0.25, -0.5, -0.25, 1),\n      new Vector(0.25, -0.5, 0.25, 1),\n      2,\n      new Vector(0, 0.6, 0, 1)\n    )\n  );\n  const clockFix = new GroupNode(\n    \"clockFixNode\",\n    Matrix.translation(new Vector(0, 0, 0.25, 1))\n  );\n  clockFix.add(\n    new SphereNode(\n      \"clockFix\",\n      new Vector(0, 0, 0, 1),\n      0.1,\n      new Vector(0.5, 0.2, 0.4, 1)\n    )\n  );\n  const clockHandTip = new GroupNode(\n    \"clockHandTipGroup\",\n    Matrix.translation(new Vector(0, 2, 0, 1)).mul(Matrix.scaling(new Vector(0.5, 0.5, 0.5)))\n  );\n  clockHandTip.add(\n    new MeshNode(\n      \"clockMonkey\",\n      \"monkey.obj\",\n      new Vector(0.3, 0.2, 0.0, 1)\n    )\n  );\n  clockFix.add(clockHandTip);\n  clockHandRoot.add(clockFix);\n  desktopBase.add(clockHandRoot);\n\n\n  const teapotGroup = new GroupNode(\"teapotGroup\", Matrix.translation(\n    new Vector(0, 2.05, 0, 1)).mul(Matrix.scaling(\n      new Vector(0.4, 0.4, 0.4))));\n  teapotGroup.add(new MeshNode(\"teapot\", \"teapot.obj\", new Vector(1, 0.8, 0, 1)));\n  desktopBase.add(teapotGroup);\n\n  const carpetGroup = new GroupNode(\"carpetGroup\", Matrix.translation(new Vector(0, -2, 0)));\n  carpetGroup.add(new TextureBoxNode(\"carpet-noColl\", new Vector(-20, 0, -20, 1), new Vector(20, 0.01, 20), \"carpet.jpg\", \"pillow.jpg\"));\n  baseTranslation.add(carpetGroup);\n\n  const house = new GroupNode(\"houseGroup\", Matrix.translation(new Vector(0, -2.1, 0)));\n  house.add(new TextureBoxNode(\"houseNode-noColl\", new Vector(-20, 0, -20, 1), new Vector(20, 20, 20), \"shack.jpg\", \"wood.jpg\"));\n  baseTranslation.add(house);\n\n  const sphereConstellation = new GroupNode(\"sphereRoot\", Matrix.translation(new Vector(0, 8, 0)));\n  const sphere1 = new GroupNode(\"sphere1Group\", Matrix.translation(new Vector(-10, 0, -3)));\n  sphere1.add(new SphereNode(\"sphere1\", new Vector(0, 0, 0, 1), 1, new Vector(0.7, 0.7, 0.7, 1), new Vector(0, 0, 0, 0.5)));\n  sphereConstellation.add(sphere1);\n  const sphere2 = new GroupNode(\"sphere2Group\", Matrix.translation(new Vector(10, -2, -5)));\n  sphere2.add(new SphereNode(\"sphere2\", new Vector(0, 0, 0, 1), 1.5, new Vector(0.3, 0, 0, 1)));\n  sphereConstellation.add(sphere2);\n  const sphere3 = new GroupNode(\"sphere3Group\", Matrix.translation(new Vector(-4, -4, 4)));\n  sphere3.add(new SphereNode(\"sphere3\", new Vector(0, 0, 0, 1), 1.5, new Vector(0, 0, 0.4, 1), new Vector(1, 1, 1, 1)));\n  sphereConstellation.add(sphere3);\n  const cow = new GroupNode(\"flyingCow\", Matrix.translation(new Vector(0, 1, -5)).mul(Matrix.scaling(new Vector(0.5, 0.5, 0.5))));\n  cow.add(new MeshNode(\"cow\", \"cow.obj\", new Vector(0, 0.4, 0.4, 1)));\n  sphereConstellation.add(cow);\n  const bunny = new GroupNode(\"flyingBunny\", Matrix.translation(new Vector(0, 2, 5)).mul(Matrix.scaling(new Vector(5, 5, 5))));\n  bunny.add(new MeshNode(\"bunny\", \"bunnyHR.obj\", new Vector(0.6, 0, 0.4, 1)));\n  sphereConstellation.add(bunny);\n\n\n  desktopBase.add(sphereConstellation);\n\n  const cameraHolder = new GroupNode(\"camerHolder\", Matrix.translation(new Vector(0, 2, 10, 1)));\n  const cameraNode = new GroupNode(\"cameraNode\", Matrix.identity());\n  cameraNode.add(\n    new CameraNode(\n      \"camera\",\n      new Vector(0, 0, 1, 1),\n      new Vector(0, 0, -1, 1),\n      new Vector(0, 1, 0, 0),\n      75,\n      canvas.width / canvas.height,\n      0.1,\n      100\n    )\n  );\n  cameraHolder.add(cameraNode);\n  const lightNode = new GroupNode(\"lightNode\", Matrix.translation(new Vector(0, 5, 0, 1)));\n  lightNode.add(new LightNode(\"centerLight\", new Vector(1, 0, 0, 1)))\n  const sunNode = new GroupNode(\"sunNode\", Matrix.translation(new Vector(20, 0, 0, 1)));\n  sunNode.add(new LightNode(\"sun\", new Vector(1, 1, 0, 1)));\n\n  sceneGraph.add(cameraHolder);\n  sceneGraph.add(baseTranslation);\n  sceneGraph.add(lightNode);\n  sceneGraph.add(sunNode);\n\n  animationNodes.add(new DriverNode(sphereConstellation.id, new Vector(1, 0, 0), new Vector(0, 0, -1), 5));\n  animationNodes.add(new RotationNode(desktopBase.id, new Vector(0, 1, 0), 45));\n  animationNodes.add(new BouncingNode(clockHandTip.id, new Vector(0, 1, 0), 1, 2));\n  animationNodes.add(new BouncingNode(lightNode.id, new Vector(1, 0, 0), 0.25, 2));\n  animationNodes.add(new RotationNode(clockHandRoot.id, new Vector(0, 0, 1), 90));\n  animationNodes.add(new RotationNode(sunNode.id, new Vector(0, 1, 0), 90));\n  animationNodes.add(new RotationNode(bunny.id, new Vector(0, 1, 0), 90));\n  animationNodes.add(new RotationNode(bunny.id, new Vector(0, 0, 1), 90));\n  animationNodes.add(new RotationNode(cow.id, new Vector(0, 1, 0), 90));\n  animationNodes.add(new RotationNode(cow.id, new Vector(0, 0, 1), 90));\n  animationNodes.add(new FreeFlightNode(cameraNode.id, 0.5));\n}\n\nexport default createDemoSceneGraph;","<script>\n  import SceneGraph from \"./components/SceneGraph.svelte\";\n  import PhongConfigurator from \"./components/PhongConfigurator.svelte\";\n  import { onMount } from \"svelte\";\n  import { get } from \"svelte/store\";\n  import {\n    sceneGraph,\n    animationNodes,\n    keysPressed,\n    selectedNode,\n    mouseOffsets,\n    mousePosition,\n    mouseClicked\n  } from \"./state/stores.js\";\n\n  import vertexShader from \"./shaders/rasterizer/raster-vertex-shader.glsl\";\n  import phongFragmentShader from \"./shaders/rasterizer/raster-phong-fragment-shader.glsl\";\n  import textureVertexShader from \"./shaders/rasterizer/raster-texture-vertex-shader.glsl\";\n  import textureFragmentShader from \"./shaders/rasterizer/raster-texture-fragment-shader.glsl\";\n  import raytracerVertexShader from \"./shaders/raytracer/raytracer-vertex-shader.glsl\";\n  import raytracerFragmentShader from \"./shaders/raytracer/raytracer-fragment-shader.glsl\";\n  import collisionVertexShader from \"./shaders/boundingSphere/bounding-sphere-vertex-shader.glsl\";\n  import collisionFragmentShader from \"./shaders/boundingSphere/bounding-sphere-fragment-shader.glsl\";\n\n  import Vector from \"./math/vector.js\";\n  import Matrix from \"./math/matrix.js\";\n  import {\n    RasterVisitor,\n    RasterSetupVisitor\n  } from \"./renderer/rasterizer/rastervisitor.js\";\n  import RayVisitor from \"./renderer/raytracer/rayvisitor.js\";\n  import {\n    CollisionVisitor,\n    CollisionSetupVisitor\n  } from \"./renderer/boundingSphere/collisionVisitor.js\";\n  import Shader from \"./shaders/shader.js\";\n  import { GroupNode } from \"./scenegraph/nodes.js\";\n  import {\n    FreeFlightNode,\n    animationNodeClasses\n  } from \"./scenegraph/animation-nodes.js\";\n  import createDemoSceneGraph from \"./demo.js\";\n\n  let fileInput;\n  let downloadButton;\n  let dataURL;\n  let canvas;\n  let activeRenderer;\n  let rasterVisitor;\n  let rasterSetupVisitor;\n  let collisionVisitor;\n  let collisionSetupVisitor;\n  let rayVisitor;\n\n  let averageFps;\n  let frames = 0;\n  let time = 0;\n  let fps = 0;\n  let framesLastSecond = 0;\n  let nextSecond = 1000;\n\n  const toggleRenderer = () => {\n    if (activeRenderer === rasterVisitor) {\n      activeRenderer = rayVisitor;\n    } else {\n      activeRenderer = rasterVisitor;\n    }\n  };\n\n  onMount(() => {\n    const webgl = canvas.getContext(\"webgl\", {\n      premultipliedAlpha: false\n    });\n    webgl.clearDepth(1.0);\n    webgl.enable(webgl.DEPTH_TEST);\n    webgl.depthFunc(webgl.LEQUAL);\n    webgl.enable(webgl.BLEND);\n    webgl.blendFunc(webgl.SRC_ALPHA, webgl.ONE_MINUS_SRC_ALPHA);\n    webgl.getExtension(\"OES_element_index_uint\");\n    createDemoSceneGraph(canvas);\n\n    rayVisitor = new RayVisitor(\n      webgl,\n      new Shader(webgl, raytracerVertexShader, raytracerFragmentShader)\n    );\n    rasterVisitor = new RasterVisitor(\n      webgl,\n      new Shader(webgl, vertexShader, phongFragmentShader),\n      new Shader(webgl, textureVertexShader, textureFragmentShader)\n    );\n    rasterSetupVisitor = new RasterSetupVisitor(webgl);\n    collisionVisitor = new CollisionVisitor(\n      webgl,\n      new Shader(webgl, collisionVertexShader, collisionFragmentShader)\n    );\n    collisionSetupVisitor = new CollisionSetupVisitor(webgl);\n\n    activeRenderer = rasterVisitor;\n    rasterSetupVisitor.setup($sceneGraph);\n    collisionSetupVisitor.setup($sceneGraph);\n\n    const simulate = deltaT => {\n      for (let animationNode of $animationNodes) {\n        animationNode.simulate(deltaT);\n      }\n    };\n\n    let lastTimestamp = performance.now();\n    const animateFunc = timestamp => {\n      const deltaT = timestamp - lastTimestamp;\n      simulate(deltaT);\n      activeRenderer.render($sceneGraph);\n      collisionVisitor.render($sceneGraph);\n      updateFPS(deltaT);\n      lastTimestamp = timestamp;\n      window.requestAnimationFrame(animateFunc);\n    };\n\n    Promise.all([\n      rasterVisitor.shader.load(),\n      rasterVisitor.textureShader.load(),\n      rayVisitor.shader.load(),\n      collisionVisitor.shader.load()\n    ]).then(_ => window.requestAnimationFrame(animateFunc));\n  });\n\n  const handleKeyDown = event => {\n    if (!$keysPressed.get(event.key)) {\n      keysPressed.keydown(event.key);\n    }\n  };\n\n  const updateFPS = deltaT => {\n    frames++;\n    time += deltaT;\n    averageFps = (frames / (time / 1000)).toFixed(2);\n    framesLastSecond++;\n    if (time >= nextSecond) {\n      fps = framesLastSecond;\n      nextSecond = time + 1000;\n      framesLastSecond = 0;\n    }\n  };\n\n  const handleKeyUp = event => {\n    keysPressed.keyup(event.key);\n  };\n\n  const handleUpload = event => {\n    const newSelection = event.target.files[0];\n    if (newSelection) {\n      const fileReader = new FileReader();\n      fileReader.onload = e => {\n        let parsed = JSON.parse(e.target.result);\n        let sceneGraphObj = parsed.sceneGraph;\n        let animationNodesArr = parsed.animationNodes;\n        $selectedNode = {};\n        $sceneGraph = GroupNode.fromJSON(sceneGraphObj);\n        rasterSetupVisitor.setup($sceneGraph);\n        collisionSetupVisitor.setup($sceneGraph);\n        $animationNodes = animationNodesArr.map(anim =>\n          animationNodeClasses[anim.type].fromJSON(anim)\n        );\n      };\n      fileReader.readAsText(newSelection);\n      event.target.value = \"\";\n    }\n  };\n\n  const handleDownload = event => {\n    if (dataURL) {\n      window.URL.revokeObjectURL(dataURL);\n    }\n    dataURL = window.URL.createObjectURL(\n      new Blob(\n        [\n          JSON.stringify({\n            sceneGraph: $sceneGraph,\n            animationNodes: $animationNodes\n          })\n        ],\n        { type: \"application/json\" }\n      )\n    );\n    downloadButton.href = dataURL;\n  };\n\n  const handleMouseMove = event => {\n    if (document.pointerLockElement === canvas) {\n      mouseOffsets.addX(event.movementX);\n      mouseOffsets.addY(event.movementY);\n    }\n    const x = event.clientX;\n    const y = event.clientY;\n    const rect = event.target.getBoundingClientRect();\n    if (rect.left <= x && x < rect.right && rect.top <= y && y < rect.bottom) {\n      const x_in_canvas = x - rect.left;\n      const y_in_canvas = rect.bottom - y;\n      const canvasHeight = rect.bottom - rect.top;\n      const canvasWidth = rect.right - rect.left;\n      mousePosition.setX((2 * x_in_canvas) / canvasWidth - 1);\n      mousePosition.setY((2 * y_in_canvas) / canvasHeight - 1);\n    }\n  };\n\n  const toggleIntersectSearch = () => {\n    collisionVisitor.toggleIntersect();\n  };\n\n  const handleStop = event => {\n    get(animationNodes)\n      .filter(n => !(n instanceof FreeFlightNode))\n      .forEach(n => n.toggleActive());\n  };\n\n  const handleBoundToggle = () => {\n    collisionVisitor.toggleRender();\n  };\n\n  const handlePointerLockChange = event => {\n    if (\n      document.pointerLockElement !== canvas &&\n      document.mozPointerLockElement !== canvas\n    ) {\n      $animationNodes\n        .filter(node => node instanceof FreeFlightNode)\n        .forEach(node => (node.active = false));\n    }\n  };\n  document.addEventListener(\"pointerlockchange\", handlePointerLockChange);\n\n  const startFreeFlight = event => {\n    event.preventDefault();\n    canvas.requestPointerLock = canvas.requestPointerLock ||\n                            canvas.mozRequestPointerLock;\n    canvas.requestPointerLock();\n    $animationNodes\n      .filter(node => node instanceof FreeFlightNode)\n      .forEach(node => (node.active = true));\n  };\n\n  const handleMouseDown = event => {\n    if (event.which == 1) {\n      $mouseClicked = true;\n    }\n  };\n\n  const handleMouseUp = event => {\n    if (event.which == 1) {\n      $mouseClicked = false;\n    }\n  };\n</script>\n\n<style>\n  .main-container {\n    height: 100vh;\n    width: 100vw;\n    display: grid;\n    grid-template-columns: 1fr 1fr 1fr 1fr 1fr;\n    grid-template-rows: 10% 1fr;\n    grid-template-areas:\n      \"header header header header sidebar\"\n      \"content content content content sidebar\";\n    overflow: hidden;\n  }\n\n  #header {\n    grid-area: header;\n    padding: 2em;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    background-color: rgba(255, 166, 0, 0.904);\n  }\n\n  .main_content {\n    position: relative;\n    width: 100%;\n    height: 100%;\n    grid-area: content;\n  }\n\n  .main_content__canvas {\n    width: 100%;\n    height: 100%;\n  }\n\n  .main_content__overlay {\n    position: absolute;\n    left: 10px;\n    top: 10px;\n    background-color: rgba(0, 0, 0, 0.7);\n    color: white;\n    font-family: monospace;\n    padding: 1em;\n  }\n\n  .main_content__overlay > div {\n    margin: auto;\n  }\n\n  #sidebar {\n    grid-area: sidebar;\n  }\n\n  .sidebar__scenegraph {\n    height: 70%;\n    box-shadow: 0.1em 0.1em 0.1em 0.1em rgba(0, 0, 0, 0.5);\n    background-color: rgba(255, 166, 0, 0.404);\n    margin-bottom: 2%;\n  }\n\n  .sidebar__configurator {\n    height: 28%;\n    overflow-y: auto;\n    box-shadow: 0.1em 0.1em 0.1em 0.1em rgba(0, 0, 0, 0.5);\n    background-color: rgba(255, 166, 0, 0.404);\n  }\n\n  #header > .logo a {\n    text-decoration: none;\n    color: inherit;\n    padding-bottom: 0;\n    margin-bottom: 0;\n  }\n\n  input[type=\"file\"] {\n    width: 0.1px;\n    height: 0.1px;\n    opacity: 0;\n    overflow: hidden;\n    position: absolute;\n    z-index: -1;\n  }\n\n  .logo {\n    display: flex;\n    flex-direction: row;\n  }\n</style>\n\n<svelte:window on:keydown={handleKeyDown} on:keyup={handleKeyUp} />\n<div class=\"main-container\">\n  <div id=\"header\">\n    <div class=\"logo\">\n      <img\n        style=\"margin-right: 1em;\"\n        id=\"logo-img\"\n        alt=\"HCI Logo\"\n        src=\"hci-logo.png\"\n        width=\"70px\"\n        height=\"70px\" />\n      <div>\n        <a href=\"/\">\n          <h1>ICG CS Master Project</h1>\n        </a>\n        <em style=\"padding-left: 1em; font-size: 1em\">Long Bui</em>\n      </div>\n    </div>\n    <div class=\"header__button-group\">\n      <button\n        type=\"button\"\n        class=\"btn btn-primary\"\n        on:click={handleBoundToggle}>\n        Toggle Bounding Spheres\n      </button>\n      <button type=\"button\" class=\"btn btn-primary\" on:click={handleStop}>\n        Toggle Animation\n      </button>\n      <button\n        id=\"renderer_toggle\"\n        type=\"button\"\n        class=\"btn btn-primary\"\n        on:click={toggleRenderer}>\n        Toggle Renderer\n      </button>\n      <a\n        id=\"save_button\"\n        role=\"button\"\n        class=\"btn btn-primary\"\n        download=\"scenegraph.json\"\n        bind:this={downloadButton}\n        on:click={handleDownload}\n        href=\"/\">\n        Save Scene\n      </a>\n      <button\n        id=\"load_button\"\n        type=\"button\"\n        class=\"btn btn-primary\"\n        on:click={() => {\n          fileInput.click();\n        }}>\n        Load Scene\n        <input\n          bind:this={fileInput}\n          id=\"file-uploader\"\n          type=\"file\"\n          accept=\"application/json\"\n          on:change={handleUpload} />\n      </button>\n    </div>\n  </div>\n  <div id=\"sidebar\">\n    <div class=\"sidebar__scenegraph\">\n      <SceneGraph />\n    </div>\n    <div class=\"sidebar__configurator\">\n      <PhongConfigurator />\n    </div>\n  </div>\n  <div class=\"main_content\">\n    <canvas\n      class=\"main_content__canvas\"\n      bind:this={canvas}\n      width=\"1920\"\n      height=\"1080\"\n      on:contextmenu={startFreeFlight}\n      on:mousemove={handleMouseMove}\n      on:mouseenter={toggleIntersectSearch}\n      on:mouseleave={toggleIntersectSearch}\n      on:mousedown={handleMouseDown}\n      on:mouseup={handleMouseUp} />\n    <div class=\"main_content__overlay\">\n      <div>FPS: {fps}</div>\n      <div>Average: {averageFps}</div>\n    </div>\n  </div>\n</div>\n","import App from './App.svelte';\n\nconst app = new App({\n\ttarget: document.body\n});\n\nexport default app;"],"names":["noop","identity","x","run","fn","blank_object","Object","create","run_all","fns","forEach","is_function","thing","safe_not_equal","a","b","subscribe","store","callback","unsub","unsubscribe","get_store_value","value","_","component_subscribe","component","$$","on_destroy","push","is_client","window","now","performance","Date","raf","cb","requestAnimationFrame","tasks","Set","stylesheet","running","run_tasks","task","delete","size","append","target","node","appendChild","insert","anchor","insertBefore","detach","parentNode","removeChild","destroy_each","iterations","detaching","i","length","d","element","name","document","createElement","text","data","createTextNode","space","listen","event","handler","options","addEventListener","removeEventListener","attr","attribute","removeAttribute","setAttribute","set_data","set_input_value","input","toggle_class","toggle","classList","current_component","active","current_rules","create_rule","duration","delay","ease","uid","step","keyframes","p","t","rule","str","hash","charCodeAt","style","head","sheet","insertRule","cssRules","animation","delete_rule","split","filter","anim","indexOf","join","deleteRule","set_current_component","onMount","Error","get_current_component","on_mount","dirty_components","binding_callbacks","render_callbacks","flush_callbacks","resolved_promise","Promise","resolve","promise","update_scheduled","add_render_callback","add_flush_callback","flush","seen_callbacks","shift","update","pop","has","add","fragment","dirty","before_update","ctx","after_update","dispatch","direction","kind","dispatchEvent","type","detail","e","createEvent","initCustomEvent","custom_event","outroing","outros","group_outros","r","c","check_outros","transition_in","block","local","transition_out","o","null_transition","create_bidirectional_transition","params","intro","config","running_program","pending_program","animation_name","clear_animation","init","program","Math","abs","start","end","group","go","easing","tick","css","fulfil","loop","[object Object]","then","globals","global","bind","props","bound","mount_component","m","new_on_destroy","map","destroy_component","make_dirty","key","instance","create_fragment","not_equal","prop_names","parent_component","context","Map","callbacks","ready","hydrate","l","Array","from","childNodes","SvelteComponent","this","$destroy","index","splice","subscriber_queue","writable","stop","subscribers","set","new_value","run_queue","s","invalidate","subscriber","Vector","y","z","w","_x","val","_y","g","_z","_w","other","div","sqrt","Matrix","mat","Float32Array","row","col","getVal","translation","axis","angle","result","PI","setVal","cos","sin","scale","eye","center","up","forward","normalised","right","cross","upReal","dot","left","bottom","top","near","far","fovy","aspect","f","tan","j","newVal","k","console","log","det","dst","tmp","src","ret","Intersection","point","normal","Infinity","Node","id","visitor","visit","GroupNode","super","matrix","children","childNode","visitGroupNode","constructor","nodeId","child","childResult","find","obj","nodeClasses","fromJSON","SphereNode","radius","color","color2","col2","AABoxNode","minPoint","TextureBoxNode","texture","normalMap","PyramidNode","height","CameraNode","visitCameraNode","LightNode","visitLightNode","MeshNode","url","mousePosition","setX","mouseX","position","setY","mouseY","reset","createMousePosition","mouseOffsets","addX","offsetX","offsets","addY","offsetY","createMouseMovement","phongConfiguration","ambient","diffuse","specular","shininess","loadIntoShader","shader","phong","trySet","getUniformFloat","createPhongConfiguration","keysPressed","keydown","keys","keyup","createKeysPressed","selectedNode","hoveredNode","mouseClicked","sceneGraph","sg","remove","toRemove","stack","n","apply","createSceneGraph","animationNodes","nodes","createAnimationNodes","cubicOut","fly","opacity","getComputedStyle","target_opacity","transform","od","u","$selectedNode","click","mouseEnter","preventDefault","showAnimations","toggleAnimations","$animationNodes","important","setProperty","func","showChildren","toggleChildren","$sceneGraph","min","max","undefined","$phongConfiguration","Rasterizable","loaded","calcNormal","v1","v2","v3","vec1","sub","normals","vertices","vertexBuffer","gl","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","indexBuffer","ELEMENT_ARRAY_BUFFER","Uint32Array","indices","colourBuffer","colors","normalBuffer","positionLocation","getAttributeLocation","enableVertexAttribArray","vertexAttribPointer","FLOAT","colourLocation","normalLocation","drawElements","TRIANGLES","UNSIGNED_INT","disableVertexAttribArray","RasterSphere","ring","ring2","theta","phi","ringsize","fillBuffers","TextureRasterizable","texCoords","textureLocation","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","texBuffer","getUniformInt","TEXTURE1","normalMapBuffer","drawArrays","elements","parseObjectFile","contents","lines","line","cols","parseFloat","includes","indCols","vInd","parseInt","nInd","v","Visitor","matrixStack","inverseMatrixStack","shouldRender","camera","rootNode","clearColor","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","lightPositions","lightSearch","accept","setupCamera","lookat","mul","viewMat","perspective","invert","cameraModelMat","cameraWorld","Shader","vertexShaderSource","fragmentShaderSource","vertexShader","getShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","all","shaderParts","shaderProgram","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","alert","getProgramInfoLog","useProgram","getAttribLocation","filename","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","UniformMatrix","getUniformLocation","UniformVec4","UniformVec3","UniformFloat","UniformInt","location","uniformMatrix4fv","vec","uniform3f","uniform4f","uniform1f","uniform1i","RasterVisitor","textureShader","rasterObject","use","getUniformMatrix","light","getUniformVec3","render","RasterSetupVisitor","clearDepth","enable","DEPTH_TEST","depthFunc","LEQUAL","rasterNodeClasses","values","slice","maxPoint","mi","ma","cubeTexture","createTexture","cubeImage","Image","onload","texImage2D","RGBA","UNSIGNED_BYTE","texParameteri","TEXTURE_MIN_FILTER","LINEAR","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","normalMapTexture","normalMapImage","uvBuffer","calcNormals","fetch","resp","mesh","isNaN","hasNaNs","vertex","RayVisitor","sphereCenters","sphereRadii","sphereColors","getUniformVec4","draw","screenBuffer","aVertexPosition","TRIANGLE_STRIP","Sphere","ray","rayOrigin","origin","rayDir","perp","t1","t2","firstHitDistance","CollisionVisitor","renderActive","intersectActive","minIntersection","intersectedNode","intersectionSearch","get","rasterBoundingSphere","toWorld","intersection","boundingSphere","intersect","closerThan","getIntersection","CollisionSetupVisitor","wrap","setTimeout","vertexComponents","ritterCenter","ritterRadius","calcRitter","currentMax","acc","vert","distance","currMin","reduce","newY","newZ","AnimationNode","groupNodeId","nodeStack","currNode","groupNode","RotationNode","transpose","currentAngle","deltaT","rotation","BouncingNode","speed","ManualRotationNode","DriverNode","firstAxis","secondAxis","translationMatrix","FreeFlightNode","mouseSensitivity","currentX","currentY","getLeftVector","getForwardVector","getUpVector","animationNodeClasses","createDemoSceneGraph","canvas","baseTranslation","desktopBase","clockHandRoot","clockFix","clockHandTip","scaling","teapotGroup","carpetGroup","house","sphereConstellation","sphere1","sphere2","sphere3","cow","bunny","cameraHolder","cameraNode","width","lightNode","sunNode","fps","averageFps","handleKeyDown","handleKeyUp","handleBoundToggle","handleStop","toggleRenderer","handleDownload","handleUpload","startFreeFlight","handleMouseMove","toggleIntersectSearch","handleMouseDown","handleMouseUp","fileInput","downloadButton","dataURL","activeRenderer","rasterVisitor","rasterSetupVisitor","collisionVisitor","collisionSetupVisitor","rayVisitor","frames","time","framesLastSecond","nextSecond","webgl","getContext","premultipliedAlpha","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","getExtension","raytracerVertexShader","raytracerFragmentShader","phongFragmentShader","textureVertexShader","textureFragmentShader","collisionVertexShader","collisionFragmentShader","setup","lastTimestamp","animateFunc","timestamp","animationNode","simulate","updateFPS","load","toFixed","pointerLockElement","mozPointerLockElement","$keysPressed","newSelection","files","fileReader","FileReader","parsed","JSON","parse","sceneGraphObj","animationNodesArr","readAsText","URL","revokeObjectURL","createObjectURL","Blob","stringify","href","movementX","movementY","clientX","clientY","rect","getBoundingClientRect","x_in_canvas","y_in_canvas","canvasHeight","canvasWidth","toggleIntersect","toggleActive","toggleRender","requestPointerLock","mozRequestPointerLock","which","$mouseClicked","body"],"mappings":"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"}