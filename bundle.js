var app=function(){"use strict";function t(){}const e=t=>t;function i(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(i)}function s(t){return"function"==typeof t}function o(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function a(t,e){const i=t.subscribe(e);return i.unsubscribe?()=>i.unsubscribe():i}function l(t){let e;return a(t,t=>e=t)(),e}function c(t,e,i){t.$$.on_destroy.push(a(e,i))}const h="undefined"!=typeof window;let u=h?()=>window.performance.now():()=>Date.now(),d=h?t=>requestAnimationFrame(t):t;const g=new Set;let m,p=!1;function f(){g.forEach(t=>{t[0](u())||(g.delete(t),t[1]())}),p=g.size>0,p&&d(f)}function v(t,e){t.appendChild(e)}function x(t,e,i){t.insertBefore(e,i||null)}function y(t){t.parentNode.removeChild(t)}function w(t,e){for(let i=0;i<t.length;i+=1)t[i]&&t[i].d(e)}function _(t){return document.createElement(t)}function b(t){return document.createTextNode(t)}function A(){return b(" ")}function S(t,e,i,n){return t.addEventListener(e,i,n),()=>t.removeEventListener(e,i,n)}function z(t,e,i){null==i?t.removeAttribute(e):t.setAttribute(e,i)}function R(t,e){e=""+e,t.data!==e&&(t.data=e)}function $(t,e){(null!=e||t.value)&&(t.value=e)}function N(t,e,i){t.classList[i?"add":"remove"](e)}let P,E=0,T={};function M(t,e,i,n,r,s,o,a=0){const l=16.666/n;let c="{\n";for(let t=0;t<=1;t+=l){const n=e+(i-e)*s(t);c+=100*t+`%{${o(n,1-n)}}\n`}const h=c+`100% {${o(i,1-i)}}\n}`,u=`__svelte_${function(t){let e=5381,i=t.length;for(;i--;)e=(e<<5)-e^t.charCodeAt(i);return e>>>0}(h)}_${a}`;if(!T[u]){if(!m){const t=_("style");document.head.appendChild(t),m=t.sheet}T[u]=!0,m.insertRule(`@keyframes ${u} ${h}`,m.cssRules.length)}const d=t.style.animation||"";return t.style.animation=`${d?d+", ":""}${u} ${n}ms linear ${r}ms 1 both`,E+=1,u}function k(t,e){t.style.animation=(t.style.animation||"").split(", ").filter(e?t=>t.indexOf(e)<0:t=>-1===t.indexOf("__svelte")).join(", "),e&&!--E&&d(()=>{if(E)return;let t=m.cssRules.length;for(;t--;)m.deleteRule(t);T={}})}function C(t){P=t}function F(t){(function(){if(!P)throw new Error("Function called outside component initialization");return P})().$$.on_mount.push(t)}const U=[],B=[],V=[],D=[],L=Promise.resolve();let O,I=!1;function Y(t){V.push(t)}function G(t){D.push(t)}function X(){const t=new Set;do{for(;U.length;){const t=U.shift();C(t),j(t.$$)}for(;B.length;)B.pop()();for(let e=0;e<V.length;e+=1){const i=V[e];t.has(i)||(i(),t.add(i))}V.length=0}while(U.length);for(;D.length;)D.pop()();I=!1}function j(t){t.fragment&&(t.update(t.dirty),r(t.before_update),t.fragment.p(t.dirty,t.ctx),t.dirty=null,t.after_update.forEach(Y))}function J(t,e,i){t.dispatchEvent(function(t,e){const i=document.createEvent("CustomEvent");return i.initCustomEvent(t,!1,!1,e),i}(`${e?"intro":"outro"}${i}`))}const H=new Set;let W;function q(){W={r:0,c:[],p:W}}function K(){W.r||r(W.c),W=W.p}function Q(t,e){t&&t.i&&(H.delete(t),t.i(e))}function Z(t,e,i,n){if(t&&t.o){if(H.has(t))return;H.add(t),W.c.push(()=>{H.delete(t),n&&(i&&t.d(1),n())}),t.o(e)}}const tt={duration:0};function et(i,n,o,a){let l=n(i,o),c=a?0:1,h=null,m=null,v=null;function x(){v&&k(i,v)}function y(t,e){const i=t.b-c;return e*=Math.abs(i),{a:c,b:t.b,d:i,duration:e,start:t.start,end:t.start+e,group:t.group}}function w(n){const{delay:s=0,duration:o=300,easing:a=e,tick:w=t,css:_}=l||tt,b={start:u()+s,b:n};n||(b.group=W,W.r+=1),h?m=b:(_&&(x(),v=M(i,c,n,o,s,a,_)),n&&w(0,1),h=y(b,o),Y(()=>J(i,n,"start")),function(t){let e;p||(p=!0,d(f)),new Promise(i=>{g.add(e=[t,i])})}(t=>{if(m&&t>m.start&&(h=y(m,o),m=null,J(i,h.b,"start"),_&&(x(),v=M(i,c,h.b,h.duration,0,a,l.css))),h)if(t>=h.end)w(c=h.b,1-c),J(i,h.b,"end"),m||(h.b?x():--h.group.r||r(h.group.c)),h=null;else if(t>=h.start){const e=t-h.start;c=h.a+h.d*a(e/h.duration),w(c,1-c)}return!(!h&&!m)}))}return{run(t){s(l)?(O||(O=Promise.resolve(),O.then(()=>{O=null})),O).then(()=>{l=l(),w(t)}):w(t)},end(){x(),h=m=null}}}const it="undefined"!=typeof window?window:global;function nt(t,e,i){-1!==t.$$.props.indexOf(e)&&(t.$$.bound[e]=i,i(t.$$.ctx[e]))}function rt(t,e,n){const{fragment:o,on_mount:a,on_destroy:l,after_update:c}=t.$$;o.m(e,n),Y(()=>{const e=a.map(i).filter(s);l?l.push(...e):r(e),t.$$.on_mount=[]}),c.forEach(Y)}function st(t,e){t.$$.fragment&&(r(t.$$.on_destroy),t.$$.fragment.d(e),t.$$.on_destroy=t.$$.fragment=null,t.$$.ctx={})}function ot(t,e){t.$$.dirty||(U.push(t),I||(I=!0,L.then(X)),t.$$.dirty=n()),t.$$.dirty[e]=!0}function at(e,i,s,o,a,l){const c=P;C(e);const h=i.props||{},u=e.$$={fragment:null,ctx:null,props:l,update:t,not_equal:a,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(c?c.$$.context:[]),callbacks:n(),dirty:null};let d=!1;u.ctx=s?s(e,h,(t,i)=>{u.ctx&&a(u.ctx[t],u.ctx[t]=i)&&(u.bound[t]&&u.bound[t](i),d&&ot(e,t))}):h,u.update(),d=!0,r(u.before_update),u.fragment=o(u.ctx),i.target&&(i.hydrate?u.fragment.l(function(t){return Array.from(t.childNodes)}(i.target)):u.fragment.c(),i.intro&&Q(e.$$.fragment),rt(e,i.target,i.anchor),X()),C(c)}class lt{$destroy(){st(this,1),this.$destroy=t}$on(t,e){const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(e),()=>{const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}$set(){}}const ct=[];function ht(e,i=t){let n;const r=[];function s(t){if(o(e,t)&&(e=t,n)){const t=!ct.length;for(let t=0;t<r.length;t+=1){const i=r[t];i[1](),ct.push(i,e)}if(t){for(let t=0;t<ct.length;t+=2)ct[t][0](ct[t+1]);ct.length=0}}}return{set:s,update:function(t){s(t(e))},subscribe:function(o,a=t){const l=[o,a];return r.push(l),1===r.length&&(n=i(s)||t),o(e),()=>{const t=r.indexOf(l);-1!==t&&r.splice(t,1),0===r.length&&(n(),n=null)}}}}class ut{constructor(t,e,i,n){this.x=t,this.y=e,this.z=i,this.w=n}get x(){return this._x}set x(t){this._x=t}get r(){return this.x}set r(t){this.x=t}get y(){return this._y}set y(t){this._y=t}get g(){return this.y}set g(t){this.y=t}get z(){return this._z}set z(t){this._z=t}get b(){return this.z}set b(t){this.z=t}get w(){return this._w}set w(t){this._w=t}get a(){return this.w}set a(t){this.w=t}add(t){return new ut(this.x+t.x,this.y+t.y,this.z+t.z,1)}sub(t){return new ut(this.x-t.x,this.y-t.y,this.z-t.z,1)}mul(t){return new ut(this.x*t,this.y*t,this.z*t,1)}elementMul(t){return new ut(this.x*t.x,this.y*t.y,this.z*t.z,1)}div(t){return new ut(this.x/t,this.y/t,this.z/t,1)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new ut(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x,1)}valueOf(){return[this.x,this.y,this.z,this.w]}normalised(){return this.div(this.length)}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w}get length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)}}class dt{constructor(t){this.data=new Float32Array(16);for(let e=0;e<4;e++)for(let i=0;i<4;i++)this.data[4*e+i]=t[4*i+e]}getLeftVector(){return new ut(this.getVal(0,0),this.getVal(1,0),this.getVal(2,0),0)}getUpVector(){return new ut(this.getVal(0,1),this.getVal(1,1),this.getVal(2,1),0)}getForwardVector(){return new ut(this.getVal(0,2),this.getVal(1,2),this.getVal(2,2),0)}getTranslationVector(){return new ut(this.getVal(0,3),this.getVal(1,3),this.getVal(2,3),0)}getVal(t,e){return this.data[4*e+t]}setVal(t,e,i){this.data[4*e+t]=i}static translation(t){return new dt([1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1])}static rotation(t,e){const i=this.identity();return e=e*Math.PI/180,1===t.x?(i.setVal(1,1,Math.cos(e)),i.setVal(2,1,Math.sin(e)),i.setVal(1,2,-Math.sin(e)),i.setVal(2,2,Math.cos(e))):1===t.y?(i.setVal(0,0,Math.cos(e)),i.setVal(0,2,Math.sin(e)),i.setVal(2,0,-Math.sin(e)),i.setVal(2,2,Math.cos(e))):1===t.z&&(i.setVal(0,0,Math.cos(e)),i.setVal(0,1,-Math.sin(e)),i.setVal(1,0,Math.sin(e)),i.setVal(1,1,Math.cos(e))),i}static scaling(t){return new dt([t.x,0,0,0,0,t.y,0,0,0,0,t.z,0,0,0,0,1])}static lookat(t,e,i){const n=new ut(e.x-t.x,e.y-t.y,e.z-t.z,1).normalised(),r=n.cross(i).normalised(),s=r.cross(n).normalised();return new dt([r.x,r.y,r.z,-r.dot(t),s.x,s.y,s.z,-s.dot(t),-n.x,-n.y,-n.z,n.dot(t),0,0,0,1])}static frustum(t,e,i,n,r,s){return new dt([2*r/(e-t),0,(e+t)/(e-t),0,0,2*r/(n-i),(n+i)/(n-i),0,0,0,-(s+r)/(s-r),-2*s*r/(s-r),0,0,-1,0])}static perspective(t,e,i,n){const r=1/Math.tan(t*Math.PI/180/2);return new dt([r/e,0,0,0,0,r,0,0,0,0,(n+i)/(i-n),2*n*i/(i-n),0,0,-1,0])}static identity(){return new dt([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}mul(t){if(t instanceof dt){const e=new dt([]);for(let i=0;i<4;i++)for(let n=0;n<4;n++){let r=0;for(let e=0;e<4;e++)r+=this.getVal(i,e)*t.getVal(e,n);e.setVal(i,n,r)}return e}{const e=new ut(0,0,0,0);return e.x=this.getVal(0,0)*t.x+this.getVal(0,1)*t.y+this.getVal(0,2)*t.z+this.getVal(0,3)*t.w,e.y=this.getVal(1,0)*t.x+this.getVal(1,1)*t.y+this.getVal(1,2)*t.z+this.getVal(1,3)*t.w,e.z=this.getVal(2,0)*t.x+this.getVal(2,1)*t.y+this.getVal(2,2)*t.z+this.getVal(2,3)*t.w,e.w=this.getVal(3,0)*t.x+this.getVal(3,1)*t.y+this.getVal(3,2)*t.z+this.getVal(3,3)*t.w,e}}transpose(){return new dt(this.data)}print(){for(let t=0;t<4;t++)console.log("> "+this.getVal(t,0)+"\t"+this.getVal(t,1)+"\t"+this.getVal(t,2)+"\t"+this.getVal(t,3))}invert(){let t,e=this.data,i=new Float32Array(16),n=new Float32Array(12),r=new Float32Array(16);for(let t=0;t<4;t++)r[t]=e[4*t],r[t+4]=e[4*t+1],r[t+8]=e[4*t+2],r[t+12]=e[4*t+3];if(n[0]=r[10]*r[15],n[1]=r[11]*r[14],n[2]=r[9]*r[15],n[3]=r[11]*r[13],n[4]=r[9]*r[14],n[5]=r[10]*r[13],n[6]=r[8]*r[15],n[7]=r[11]*r[12],n[8]=r[8]*r[14],n[9]=r[10]*r[12],n[10]=r[8]*r[13],n[11]=r[9]*r[12],i[0]=n[0]*r[5]+n[3]*r[6]+n[4]*r[7],i[0]-=n[1]*r[5]+n[2]*r[6]+n[5]*r[7],i[1]=n[1]*r[4]+n[6]*r[6]+n[9]*r[7],i[1]-=n[0]*r[4]+n[7]*r[6]+n[8]*r[7],i[2]=n[2]*r[4]+n[7]*r[5]+n[10]*r[7],i[2]-=n[3]*r[4]+n[6]*r[5]+n[11]*r[7],i[3]=n[5]*r[4]+n[8]*r[5]+n[11]*r[6],i[3]-=n[4]*r[4]+n[9]*r[5]+n[10]*r[6],i[4]=n[1]*r[1]+n[2]*r[2]+n[5]*r[3],i[4]-=n[0]*r[1]+n[3]*r[2]+n[4]*r[3],i[5]=n[0]*r[0]+n[7]*r[2]+n[8]*r[3],i[5]-=n[1]*r[0]+n[6]*r[2]+n[9]*r[3],i[6]=n[3]*r[0]+n[6]*r[1]+n[11]*r[3],i[6]-=n[2]*r[0]+n[7]*r[1]+n[10]*r[3],i[7]=n[4]*r[0]+n[9]*r[1]+n[10]*r[2],i[7]-=n[5]*r[0]+n[8]*r[1]+n[11]*r[2],n[0]=r[2]*r[7],n[1]=r[3]*r[6],n[2]=r[1]*r[7],n[3]=r[3]*r[5],n[4]=r[1]*r[6],n[5]=r[2]*r[5],n[6]=r[0]*r[7],n[7]=r[3]*r[4],n[8]=r[0]*r[6],n[9]=r[2]*r[4],n[10]=r[0]*r[5],n[11]=r[1]*r[4],i[8]=n[0]*r[13]+n[3]*r[14]+n[4]*r[15],i[8]-=n[1]*r[13]+n[2]*r[14]+n[5]*r[15],i[9]=n[1]*r[12]+n[6]*r[14]+n[9]*r[15],i[9]-=n[0]*r[12]+n[7]*r[14]+n[8]*r[15],i[10]=n[2]*r[12]+n[7]*r[13]+n[10]*r[15],i[10]-=n[3]*r[12]+n[6]*r[13]+n[11]*r[15],i[11]=n[5]*r[12]+n[8]*r[13]+n[11]*r[14],i[11]-=n[4]*r[12]+n[9]*r[13]+n[10]*r[14],i[12]=n[2]*r[10]+n[5]*r[11]+n[1]*r[9],i[12]-=n[4]*r[11]+n[0]*r[9]+n[3]*r[10],i[13]=n[8]*r[11]+n[0]*r[8]+n[7]*r[10],i[13]-=n[6]*r[10]+n[9]*r[11]+n[1]*r[8],i[14]=n[6]*r[9]+n[11]*r[11]+n[3]*r[8],i[14]-=n[10]*r[11]+n[2]*r[8]+n[7]*r[9],i[15]=n[10]*r[10]+n[4]*r[8]+n[9]*r[9],i[15]-=n[8]*r[9]+n[11]*r[10]+n[5]*r[8],t=r[0]*i[0]+r[1]*i[1]+r[2]*i[2]+r[3]*i[3],0==t)throw new Error("singular matrix is not invertible");t=1/t;for(let e=0;e<16;e++)i[e]*=t;let s=dt.identity();return s.data=i,s}}class gt{constructor(t,e,i){this.t=t||1/0,this.point=e,this.normal=i}closerThan(t){return this.t<t.t}}class mt{constructor(t){this.id=t}accept(t){t.visit(this)}}class pt extends mt{constructor(t,e){super(t),this.matrix=e,this.children=new Array}add(t){this.children.push(t)}accept(t){t.visitGroupNode(this)}toJSON(){return{id:this.id,type:this.constructor.name,matrix:this.matrix,children:this.children}}find(t){if(this.id===t)return this;if(0===this.children.length)return null;for(let e of this.children.filter(t=>t instanceof pt)){const i=e.find(t);if(i)return i}return null}static fromJSON(t){const e=new dt([]);e.data=t.matrix.data;const i=new pt(t.id,e);return i.children=t.children.map(t=>At[t.type].fromJSON(t)),i}}class ft extends mt{constructor(t,e,i,n,r){super(t),this.center=e,this.radius=i,this.color=n,this.color2=r}toJSON(){return{id:this.id,type:this.constructor.name,center:this.center,radius:this.radius,color:this.color,color2:this.color2}}static fromJSON(t){if(t.color2){const e=new ut(t.color2._x,t.color2._y,t.color2._z,t.color2._w);return new ft(t.id,new ut(t.center._x,t.center._y,t.center._z,t.center._w),t.radius,new ut(t.color._x,t.color._y,t.color._z,t.color._w),e)}return new ft(t.id,new ut(t.center._x,t.center._y,t.center._z,t.center._w),t.radius,new ut(t.color._x,t.color._y,t.color._z,t.color._w))}}class vt extends mt{constructor(t,e,i,n){super(t),this.minPoint=e,this.center=i,this.color=n}toJSON(){return{id:this.id,type:this.constructor.name,minPoint:this.minPoint,center:this.center,color:this.color}}static fromJSON(t){const e=new ut(t.minPoint._x,t.minPoint._y,t.minPoint._z,t.minPoint._w),i=new ut(t.center._x,t.center._y,t.center._z,t.center._w),n=new ut(t.color._x,t.color._y,t.color._z,t.color._w);return new vt(t.id,e,i,n)}}class xt extends mt{constructor(t,e,i,n,r){super(t),this.minPoint=e,this.center=i,this.texture=n,this.normalMap=r}toJSON(){return{id:this.id,type:this.constructor.name,minPoint:this.minPoint,center:this.center,texture:this.texture,normalMap:this.normalMap}}static fromJSON(t){const e=new ut(t.minPoint._x,t.minPoint._y,t.minPoint._z,t.minPoint._w),i=new ut(t.center._x,t.center._y,t.center._z,t.center._w);return new xt(t.id,e,i,t.texture,t.normalMap)}}class yt extends mt{constructor(t,e,i,n,r){super(t),this.minPoint=e,this.center=i,this.height=n,this.color=r}toJSON(){return{id:this.id,type:this.constructor.name,minPoint:this.minPoint,center:this.center,height:this.height,color:this.color}}static fromJSON(t){const e=new ut(t.minPoint._x,t.minPoint._y,t.minPoint._z,t.minPoint._w),i=new ut(t.center._x,t.center._y,t.center._z,t.center._w),n=new ut(t.color._x,t.color._y,t.color._z,t.color._w);return new yt(t.id,e,i,t.height,n)}}class wt extends mt{constructor(t,e,i,n,r,s,o,a){super(t),this.eye=e,this.center=i,this.up=n,this.fovy=r,this.aspect=s,this.near=o,this.far=a}toJSON(){return{id:this.id,type:this.constructor.name,eye:this.eye,center:this.center,up:this.up,fovy:this.fovy,aspect:this.aspect,near:this.near,far:this.far}}accept(t){t.visitCameraNode(this)}static fromJSON(t){const e=new ut(t.eye._x,t.eye._y,t.eye._z,t.eye._w),i=new ut(t.center._x,t.center._y,t.center._z,t.center._w),n=new ut(t.up._x,t.up._y,t.up._z,t.up._w),r=t.fovy,s=t.aspect,o=t.near,a=t.far;return new wt(t.id,e,i,n,r,s,o,a)}}class _t extends mt{constructor(t,e){super(t),this.color=e}toJSON(){return{id:this.id,type:this.constructor.name,color:this.color}}accept(t){t.visitLightNode(this)}static fromJSON(t){const e=new ut(t.color._x,t.color._y,t.color._z,t.color._w);return new _t(t.id,e)}}class bt extends mt{constructor(t,e,i){super(t),this.url=e,this.color=i}toJSON(){return{id:this.id,type:this.constructor.name,url:this.url,color:this.color}}static fromJSON(t){const e=t.url,i=new ut(t.color._x,t.color._y,t.color._z,t.color._w);return new bt(t.id,e,i)}}const At={GroupNode:pt,SphereNode:ft,AABoxNode:vt,TextureBoxNode:xt,PyramidNode:yt,CameraNode:wt,LightNode:_t,MeshNode:bt},St=(()=>{const{subscribe:t,update:e,set:i}=ht({x:0,y:0});return{subscribe:t,setX:t=>{e(e=>({...e,x:t}))},setY:t=>{e(e=>({...e,y:t}))},reset:()=>i({x:0,y:0})}})(),zt=(()=>{const{subscribe:t,update:e,set:i}=ht({x:0,y:0});return{subscribe:t,addX:t=>{e(e=>({...e,x:e.x+t}))},addY:t=>{e(e=>({...e,y:e.y+t}))},reset:()=>i({x:0,y:0})}})(),Rt=(()=>{const{subscribe:t,update:e,set:i}=ht({ambient:.6,diffuse:.6,specular:.8,shininess:10});return{subscribe:t,update:e,set:i,loadIntoShader:e=>{t(t=>{e.trySet(e.getUniformFloat.bind(e),"kA",t.ambient),e.trySet(e.getUniformFloat.bind(e),"kD",t.diffuse),e.trySet(e.getUniformFloat.bind(e),"kS",t.specular),e.trySet(e.getUniformFloat.bind(e),"shininess",t.shininess)})()}}})(),$t=(()=>{const{subscribe:t,update:e}=ht(new Map);return{subscribe:t,keydown:t=>e(e=>(e.set(t,!0),e)),keyup:t=>e(e=>(e.set(t,!1),e))}})(),Nt=ht({}),Pt=ht({}),Et=ht(!1),Tt=(()=>{const{subscribe:t,update:e,set:i}=ht(new pt(dt.identity()));return{subscribe:t,set:i,add:t=>e(e=>(e.add(t),e)),remove:t=>e(e=>{const i=[];for(e.children=e.children.filter(e=>e.id!=t),i.push.apply(i,e.children);i.length>0;){const e=i.pop();e instanceof pt&&(e.children=e.children.filter(e=>e.id!=t),i.push.apply(i,e.children))}return e})}})(),Mt=(()=>{const{subscribe:t,update:e,set:i}=ht([]);return{subscribe:t,set:i,add:t=>e(e=>[...e,t]),remove:t=>e(e=>e.filter((i,n)=>n!==e.indexOf(t)))}})();function kt(t){const e=t-1;return e*e*e+1}function Ct(t,{delay:e=0,duration:i=400,easing:n=kt,x:r=0,y:s=0,opacity:o=0}){const a=getComputedStyle(t),l=+a.opacity,c="none"===a.transform?"":a.transform,h=l*(1-o);return{delay:e,duration:i,easing:n,css:(t,e)=>`\n\t\t\ttransform: ${c} translate(${(1-t)*r}px, ${(1-t)*s}px);\n\t\t\topacity: ${l-h*e}`}}function Ft(e){var i,n,s,o,a,l,c=e.node.id+"",h=` (${e.node.constructor.name})`;return{c(){i=_("span"),n=_("strong"),s=b(c),o=A(),a=b(h),z(i,"class","svelte-hv05i3"),N(i,"active",e.$selectedNode===e.node),l=[S(i,"click",e.click),S(i,"mouseenter",e.mouseEnter),S(i,"contextmenu",e.remove)]},m(t,e){x(t,i,e),v(i,n),v(n,s),v(i,o),v(i,a)},p(t,e){t.node&&c!==(c=e.node.id+"")&&R(s,c),t.node&&h!==(h=` (${e.node.constructor.name})`)&&R(a,h),(t.$selectedNode||t.node)&&N(i,"active",e.$selectedNode===e.node)},i:t,o:t,d(t){t&&y(i),r(l)}}}function Ut(t,e,i){let n;c(t,Nt,t=>{n=t,i("$selectedNode",n)});let{node:r}=e;return t.$set=t=>{"node"in t&&i("node",r=t.node)},{node:r,click:()=>{Nt.set(r)},mouseEnter:()=>{Pt.set(r)},remove:t=>{t.preventDefault(),Tt.remove(r.id)},$selectedNode:n}}class Bt extends lt{constructor(t){super(),at(this,t,Ut,Ft,o,["node"])}}function Vt(t,e,i){const n=Object.create(t);return n.child=e[i],n}function Dt(t,e,i){const n=Object.create(t);return n.animation=e[i],n}function Lt(t){var e,i,n,r,s,o=t.showAnimations&&Ot(t);return{c(){e=_("div"),(i=_("span")).textContent="AnimationNodes:",n=A(),o&&o.c(),z(i,"class","svelte-3vna07"),N(i,"dropDown",!t.showAnimations),N(i,"dropUp",t.showAnimations),z(e,"class","category_container svelte-3vna07"),s=S(i,"click",t.toggleAnimations)},m(t,s){x(t,e,s),v(e,i),v(e,n),o&&o.m(e,null),r=!0},p(t,n){t.showAnimations&&(N(i,"dropDown",!n.showAnimations),N(i,"dropUp",n.showAnimations)),n.showAnimations?o?(o.p(t,n),Q(o,1)):((o=Ot(n)).c(),Q(o,1),o.m(e,null)):o&&(q(),Z(o,1,1,()=>{o=null}),K())},i(t){r||(Q(o),r=!0)},o(t){Z(o),r=!1},d(t){t&&y(e),o&&o.d(),s()}}}function Ot(t){for(var e,i,n,r=t.$animationNodes.filter(t.func_1),s=[],o=0;o<r.length;o+=1)s[o]=It(Dt(t,r,o));return{c(){e=_("ul");for(var t=0;t<s.length;t+=1)s[t].c();z(e,"class","children_container svelte-3vna07")},m(t,i){x(t,e,i);for(var r=0;r<s.length;r+=1)s[r].m(e,null);n=!0},p(t,i){if(t.$animationNodes||t.node){r=i.$animationNodes.filter(i.func_1);for(var n=0;n<r.length;n+=1){const o=Dt(i,r,n);s[n]?s[n].p(t,o):(s[n]=It(o),s[n].c(),s[n].m(e,null))}for(;n<s.length;n+=1)s[n].d(1);s.length=r.length}},i(t){n||(Y(()=>{i||(i=et(e,Ct,{duration:100},!0)),i.run(1)}),n=!0)},o(t){i||(i=et(e,Ct,{duration:100},!1)),i.run(0),n=!1},d(t){t&&y(e),w(s,t),t&&i&&i.end()}}}function It(t){var e,i,n,r=t.animation.constructor.name+"";return{c(){var t,s,o;e=_("div"),i=b(r),n=A(),t="padding",s="0 0.5em 0 0.5em",e.style.setProperty(t,s,o?"important":"")},m(t,r){x(t,e,r),v(e,i),v(e,n)},p(t,e){(t.$animationNodes||t.node)&&r!==(r=e.animation.constructor.name+"")&&R(i,r)},d(t){t&&y(e)}}}function Yt(t){for(var e,i,n,r=t.node.children,s=[],o=0;o<r.length;o+=1)s[o]=jt(Vt(t,r,o));const a=t=>Z(s[t],1,1,()=>{s[t]=null});return{c(){e=_("ul");for(var t=0;t<s.length;t+=1)s[t].c();z(e,"class","children_container svelte-3vna07")},m(t,i){x(t,e,i);for(var r=0;r<s.length;r+=1)s[r].m(e,null);n=!0},p(t,i){if(t.node||t.GroupNode){r=i.node.children;for(var n=0;n<r.length;n+=1){const o=Vt(i,r,n);s[n]?(s[n].p(t,o),Q(s[n],1)):(s[n]=jt(o),s[n].c(),Q(s[n],1),s[n].m(e,null))}for(q(),n=r.length;n<s.length;n+=1)a(n);K()}},i(t){if(!n){for(var o=0;o<r.length;o+=1)Q(s[o]);Y(()=>{i||(i=et(e,Ct,{duration:100},!0)),i.run(1)}),n=!0}},o(t){s=s.filter(Boolean);for(let t=0;t<s.length;t+=1)Z(s[t]);i||(i=et(e,Ct,{duration:100},!1)),i.run(0),n=!1},d(t){t&&y(e),w(s,t),t&&i&&i.end()}}}function Gt(t){var e,i=new Bt({props:{node:t.child}});return{c(){i.$$.fragment.c()},m(t,n){rt(i,t,n),e=!0},p(t,e){var n={};t.node&&(n.node=e.child),i.$set(n)},i(t){e||(Q(i.$$.fragment,t),e=!0)},o(t){Z(i.$$.fragment,t),e=!1},d(t){st(i,t)}}}function Xt(t){var e,i=new qt({props:{node:t.child}});return{c(){i.$$.fragment.c()},m(t,n){rt(i,t,n),e=!0},p(t,e){var n={};t.node&&(n.node=e.child),i.$set(n)},i(t){e||(Q(i.$$.fragment,t),e=!0)},o(t){Z(i.$$.fragment,t),e=!1},d(t){st(i,t)}}}function jt(t){var e,i,n,r,s=[Xt,Gt],o=[];function a(t,e){return e.child instanceof pt?0:1}return e=a(0,t),i=o[e]=s[e](t),{c(){i.c(),n=b("")},m(t,i){o[e].m(t,i),x(t,n,i),r=!0},p(t,r){var l=e;(e=a(0,r))===l?o[e].p(t,r):(q(),Z(o[l],1,1,()=>{o[l]=null}),K(),(i=o[e])||(i=o[e]=s[e](r)).c(),Q(i,1),i.m(n.parentNode,n))},i(t){r||(Q(i),r=!0)},o(t){Z(i),r=!1},d(t){o[e].d(t),t&&y(n)}}}function Jt(t){var e,i,n,r,s,o,a,l=-1!==t.$animationNodes.map(Ht).indexOf(t.node),c=new Bt({props:{node:t.node}}),h=l&&Lt(t),u=t.showChildren&&Yt(t);return{c(){c.$$.fragment.c(),e=A(),h&&h.c(),i=A(),n=_("div"),(r=_("span")).textContent="ChildNodes:",s=A(),u&&u.c(),z(r,"class","svelte-3vna07"),N(r,"dropDown",!t.showChildren),N(r,"dropUp",t.showChildren),z(n,"class","category_container svelte-3vna07"),a=S(r,"click",t.toggleChildren)},m(t,a){rt(c,t,a),x(t,e,a),h&&h.m(t,a),x(t,i,a),x(t,n,a),v(n,r),v(n,s),u&&u.m(n,null),o=!0},p(t,e){var s={};t.node&&(s.node=e.node),c.$set(s),(t.$animationNodes||t.node)&&(l=-1!==e.$animationNodes.map(Ht).indexOf(e.node)),l?h?(h.p(t,e),Q(h,1)):((h=Lt(e)).c(),Q(h,1),h.m(i.parentNode,i)):h&&(q(),Z(h,1,1,()=>{h=null}),K()),t.showChildren&&(N(r,"dropDown",!e.showChildren),N(r,"dropUp",e.showChildren)),e.showChildren?u?(u.p(t,e),Q(u,1)):((u=Yt(e)).c(),Q(u,1),u.m(n,null)):u&&(q(),Z(u,1,1,()=>{u=null}),K())},i(t){o||(Q(c.$$.fragment,t),Q(h),Q(u),o=!0)},o(t){Z(c.$$.fragment,t),Z(h),Z(u),o=!1},d(t){st(c,t),t&&y(e),h&&h.d(t),t&&(y(i),y(n)),u&&u.d(),a()}}}function Ht(t){return t.groupNode}function Wt(t,e,i){let n;c(t,Mt,t=>{n=t,i("$animationNodes",n)});let{node:r}=e,s=!0,o=!0;return t.$set=t=>{"node"in t&&i("node",r=t.node)},{node:r,showChildren:s,showAnimations:o,toggleChildren:()=>{i("showChildren",s=!s)},toggleAnimations:()=>{i("showAnimations",o=!o)},$animationNodes:n,func_1:function(t){return t.groupNode===r}}}class qt extends lt{constructor(t){super(),at(this,t,Wt,Jt,o,["node"])}}function Kt(t){var e,i,n,r,s,o,a=new qt({props:{node:t.$sceneGraph}});return{c(){e=_("div"),(i=_("h2")).textContent="Scene Graph",n=A(),r=_("hr"),s=A(),a.$$.fragment.c(),z(e,"class","scenegraph_container svelte-ov6hnk")},m(t,l){x(t,e,l),v(e,i),v(e,n),v(e,r),v(e,s),rt(a,e,null),o=!0},p(t,e){var i={};t.$sceneGraph&&(i.node=e.$sceneGraph),a.$set(i)},i(t){o||(Q(a.$$.fragment,t),o=!0)},o(t){Z(a.$$.fragment,t),o=!1},d(t){t&&y(e),st(a)}}}function Qt(t,e,i){let n;return c(t,Tt,t=>{n=t,i("$sceneGraph",n)}),{$sceneGraph:n}}class Zt extends lt{constructor(t){super(),at(this,t,Qt,Kt,o,[])}}function te(e){var i,n,s,o,a,l,c,h,u;return{c(){i=_("div"),n=_("label"),s=b(e.name),o=A(),a=_("input"),l=A(),c=_("div"),h=b(e.value),z(n,"for","slider"),z(n,"class","svelte-pb5rkk"),z(a,"type","range"),z(a,"name","slider"),z(a,"min",e.min),z(a,"max",e.max),z(a,"step",e.step),z(a,"class","svelte-pb5rkk"),z(c,"class","value_container svelte-pb5rkk"),z(i,"class","input_group svelte-pb5rkk"),u=[S(a,"change",e.input_change_input_handler),S(a,"input",e.input_change_input_handler)]},m(t,r){x(t,i,r),v(i,n),v(n,s),v(i,o),v(i,a),$(a,e.value),v(i,l),v(i,c),v(c,h)},p(t,e){t.name&&R(s,e.name),t.value&&$(a,e.value),t.min&&z(a,"min",e.min),t.max&&z(a,"max",e.max),t.step&&z(a,"step",e.step),t.value&&R(h,e.value)},i:t,o:t,d(t){t&&y(i),r(u)}}}function ee(t,e,i){let{value:n,name:r,min:s,max:o,step:a}=e;return t.$set=t=>{"value"in t&&i("value",n=t.value),"name"in t&&i("name",r=t.name),"min"in t&&i("min",s=t.min),"max"in t&&i("max",o=t.max),"step"in t&&i("step",a=t.step)},{value:n,name:r,min:s,max:o,step:a,input_change_input_handler:function(){n=function(t){return""===t?void 0:+t}(this.value),i("value",n)}}}class ie extends lt{constructor(t){super(),at(this,t,ee,te,o,["value","name","min","max","step"])}}function ne(t){var e,i,n,r,s,o,a,l,c,h,u,d,g;function m(e){t.slider0_value_binding.call(null,e),o=!0,G(()=>o=!1)}let p={name:"Ambient",min:"0",max:"1",step:"0.01"};void 0!==t.$phongConfiguration.ambient&&(p.value=t.$phongConfiguration.ambient);var f=new ie({props:p});function w(e){t.slider1_value_binding.call(null,e),l=!0,G(()=>l=!1)}B.push(()=>nt(f,"value",m));let b={name:"Diffuse",min:"0",max:"1",step:"0.01"};void 0!==t.$phongConfiguration.diffuse&&(b.value=t.$phongConfiguration.diffuse);var S=new ie({props:b});function R(e){t.slider2_value_binding.call(null,e),h=!0,G(()=>h=!1)}B.push(()=>nt(S,"value",w));let $={name:"Specular",min:"0",max:"1",step:"0.01"};void 0!==t.$phongConfiguration.specular&&($.value=t.$phongConfiguration.specular);var N=new ie({props:$});function P(e){t.slider3_value_binding.call(null,e),d=!0,G(()=>d=!1)}B.push(()=>nt(N,"value",R));let E={name:"Shininess",min:"0.1",max:"100",step:"0.1"};void 0!==t.$phongConfiguration.shininess&&(E.value=t.$phongConfiguration.shininess);var T=new ie({props:E});return B.push(()=>nt(T,"value",P)),{c(){e=_("div"),(i=_("h2")).textContent="Phong Parameters",n=A(),r=_("hr"),s=A(),f.$$.fragment.c(),a=A(),S.$$.fragment.c(),c=A(),N.$$.fragment.c(),u=A(),T.$$.fragment.c(),z(e,"class","phong_container svelte-1uaflby")},m(t,o){x(t,e,o),v(e,i),v(e,n),v(e,r),v(e,s),rt(f,e,null),v(e,a),rt(S,e,null),v(e,c),rt(N,e,null),v(e,u),rt(T,e,null),g=!0},p(t,e){var i={};!o&&t.$phongConfiguration&&(i.value=e.$phongConfiguration.ambient),f.$set(i);var n={};!l&&t.$phongConfiguration&&(n.value=e.$phongConfiguration.diffuse),S.$set(n);var r={};!h&&t.$phongConfiguration&&(r.value=e.$phongConfiguration.specular),N.$set(r);var s={};!d&&t.$phongConfiguration&&(s.value=e.$phongConfiguration.shininess),T.$set(s)},i(t){g||(Q(f.$$.fragment,t),Q(S.$$.fragment,t),Q(N.$$.fragment,t),Q(T.$$.fragment,t),g=!0)},o(t){Z(f.$$.fragment,t),Z(S.$$.fragment,t),Z(N.$$.fragment,t),Z(T.$$.fragment,t),g=!1},d(t){t&&y(e),st(f),st(S),st(N),st(T)}}}function re(t,e,i){let n;return c(t,Rt,t=>{n=t,i("$phongConfiguration",n)}),{$phongConfiguration:n,slider0_value_binding:function(t){n.ambient=t,Rt.set(n)},slider1_value_binding:function(t){n.diffuse=t,Rt.set(n)},slider2_value_binding:function(t){n.specular=t,Rt.set(n)},slider3_value_binding:function(t){n.shininess=t,Rt.set(n)}}}class se extends lt{constructor(t){super(),at(this,t,re,ne,o,[])}}class oe{constructor(){this.loaded=!0}calcNormals(){const t=(t,e,i)=>{const n=t.sub(e);return i.sub(e).cross(n).normalised()};this.normals=[];for(let e=0;e<this.vertices.length;){const i=t(new ut(this.vertices[e++],this.vertices[e++],this.vertices[e++]),new ut(this.vertices[e++],this.vertices[e++],this.vertices[e++]),new ut(this.vertices[e++],this.vertices[e++],this.vertices[e++]));this.normals.push(i.x,i.y,i.z),this.normals.push(i.x,i.y,i.z),this.normals.push(i.x,i.y,i.z)}}fillBuffers(){const t=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.vertices),this.gl.STATIC_DRAW),this.vertexBuffer=t;const e=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,e),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint32Array(this.indices),this.gl.STATIC_DRAW),this.indexBuffer=e;const i=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,i),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.colors),this.gl.STATIC_DRAW),this.colourBuffer=i;const n=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.normals),this.gl.STATIC_DRAW),this.normalBuffer=n}render(t){if(this.loaded){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer);const e=t.getAttributeLocation("a_position");this.gl.enableVertexAttribArray(e),this.gl.vertexAttribPointer(e,3,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.colourBuffer);const i=t.getAttributeLocation("a_colour");this.gl.enableVertexAttribArray(i),this.gl.vertexAttribPointer(i,4,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.normalBuffer);const n=t.getAttributeLocation("a_normal");this.gl.enableVertexAttribArray(n),this.gl.vertexAttribPointer(n,3,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.gl.drawElements(this.gl.TRIANGLES,this.indices.length,this.gl.UNSIGNED_INT,0),this.gl.disableVertexAttribArray(e),this.gl.disableVertexAttribArray(i),this.gl.disableVertexAttribArray(n)}}}class ae extends oe{constructor(t,e,i,n,r){super(),this.gl=t,this.vertices=[],this.indices=[],this.normals=[];for(let t=0;t<50;t++)for(let n=0;n<50;n++){let r=t*Math.PI*2/50-1,s=n*Math.PI*2/50,o=i*Math.sin(r)*Math.cos(s)+e.x,a=i*Math.sin(r)*Math.sin(s)+e.y,l=i*Math.cos(r)+e.z;this.vertices.push(o),this.vertices.push(a),this.vertices.push(l);let c=new ut(o,a,l).sub(e).normalised();this.normals.push(c.x),this.normals.push(c.y),this.normals.push(c.z)}for(let t=0;t<49;t++)for(let e=0;e<50;e++)this.indices.push(50*t+e),this.indices.push(50*t+(e+1)%50),this.indices.push(50*(t+1)+e),this.indices.push(50*t+(e+1)%50),this.indices.push(50*(t+1)+(e+1)%50),this.indices.push(50*(t+1)+e);this.colors=[];for(let t=0;t<this.vertices.length/3;t++)r&&t%2==0?(this.colors.push(r.r),this.colors.push(r.g),this.colors.push(r.b),this.colors.push(r.a)):(this.colors.push(n.r),this.colors.push(n.g),this.colors.push(n.b),this.colors.push(n.a));this.fillBuffers()}}class le{render(t){if(this.loaded){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer);const e=t.getAttributeLocation("a_position");this.gl.enableVertexAttribArray(e),this.gl.vertexAttribPointer(e,3,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texCoords);const i=t.getAttributeLocation("a_texCoord");this.gl.enableVertexAttribArray(i),this.gl.vertexAttribPointer(i,2,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.normalBuffer);const n=t.getAttributeLocation("a_normal");this.gl.enableVertexAttribArray(n),this.gl.vertexAttribPointer(n,3,this.gl.FLOAT,!1,0,0),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texBuffer),t.getUniformInt("sampler").set(0),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.normalMapBuffer),t.getUniformInt("normalSampler").set(1),this.gl.drawArrays(this.gl.TRIANGLES,0,this.elements),this.gl.disableVertexAttribArray(e),this.gl.disableVertexAttribArray(i),this.gl.disableVertexAttribArray(n)}}}const ce=t=>{const e=t.split("\n"),i=[],n=[],r=[];return e.forEach(t=>{const e=t.split(/\s/).filter(t=>t.length>0);if(e.length>0)switch(e[0]){case"v":i.push(new ut(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])));break;case"vn":n.push(new ut(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])));break;case"f":for(let t=1;t<4;t++)if(e[t].includes("/")){const i=e[t].split("/"),n=parseInt(i[0])-1,s=0==i[2].length?0:parseInt(i[2])-1;r.push({v:n,n:s})}else r.push({v:parseInt(e[t])-1,n:0})}}),{vertices:i,normals:n,indices:r}};class he{constructor(t){this.gl=t,this.matrixStack=[dt.identity()],this.matrixStack.top=function(){return this[this.length-1]},this.inverseMatrixStack=[dt.identity()],this.inverseMatrixStack.top=function(){return this[this.length-1]},this.shouldRender=!1,this.camera={}}render(t){this.gl.clearColor(0,0,0,.5),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.lightPositions=[],this.shouldRender=!1,this.lightSearch=!1,t.accept(this),this.setupCamera(),this.lightSearch=!0,t.accept(this),this.lightSearch=!1,this.shouldRender=!0,t.accept(this)}setupCamera(){this.lookat=dt.lookat(this.camera.eye,this.camera.center,this.camera.up).mul(this.viewMat),this.perspective=dt.perspective(this.camera.fovy,this.camera.aspect,this.camera.near,this.camera.far)}visitGroupNode(t){this.matrixStack.push(this.matrixStack.top().mul(t.matrix)),this.inverseMatrixStack.push(t.matrix.invert().mul(this.inverseMatrixStack.top())),t.children.forEach(t=>{t.accept(this)}),this.matrixStack.pop(),this.inverseMatrixStack.pop()}visitCameraNode(t){this.shouldRender||this.lightSearch||(this.camera=t,this.cameraModelMat=this.matrixStack.top(),this.cameraWorld=this.matrixStack.top().mul(t.eye),this.viewMat=this.inverseMatrixStack.top())}visitLightNode(t){this.lightSearch&&this.lightPositions.push(this.lookat.mul(this.matrixStack.top()).mul(new ut(0,0,0,1)))}}class ue{constructor(t,e,i){this.vertexShaderSource=e,this.fragmentShaderSource=i,this.gl=t}async load(){let t=this.gl;const e=this.getShader(t,this.vertexShaderSource,t.VERTEX_SHADER),i=this.getShader(t,this.fragmentShaderSource,t.FRAGMENT_SHADER);return Promise.all([e,i]).then(e=>{this.shaderProgram=t.createProgram(),t.attachShader(this.shaderProgram,e[0]),t.attachShader(this.shaderProgram,e[1]),t.linkProgram(this.shaderProgram),t.getProgramParameter(this.shaderProgram,t.LINK_STATUS)||alert("Unable to initialize the shader program: "+t.getProgramInfoLog(this.shaderProgram))})}use(){this.gl.useProgram(this.shaderProgram)}getAttributeLocation(t){const e=this.gl.getAttribLocation(this.shaderProgram,t);return-1!=e&&this.gl.enableVertexAttribArray(e),e}getShader(t,e,i){const n=t.createShader(i);return t.shaderSource(n,e),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(alert("An error occurred compiling the shaders: "+t.getShaderInfoLog(n)),null)}getUniformMatrix(t){return new de(this.gl,this.gl.getUniformLocation(this.shaderProgram,t))}getUniformVec4(t){return new me(this.gl,this.gl.getUniformLocation(this.shaderProgram,t))}getUniformVec3(t){return new ge(this.gl,this.gl.getUniformLocation(this.shaderProgram,t))}getUniformFloat(t){return new pe(this.gl,this.gl.getUniformLocation(this.shaderProgram,t))}getUniformInt(t){return new fe(this.gl,this.gl.getUniformLocation(this.shaderProgram,t))}trySet(t,e,i){const n=t(e);n&&n.set(i)}}class de{constructor(t,e){this.gl=t,this.position=e}set(t){this.gl.uniformMatrix4fv(this.position,!1,t.data)}}class ge{constructor(t,e){this.gl=t,this.position=e}set(t){this.gl.uniform3f(this.position,t.x,t.y,t.z)}}class me{constructor(t,e){this.gl=t,this.position=e}set(t){this.gl.uniform4f(this.position,t.x,t.y,t.z,t.w)}}class pe{constructor(t,e){this.gl=t,this.position=e}set(t){this.gl.uniform1f(this.position,t)}}class fe{constructor(t,e){this.gl=t,this.position=e}set(t){this.gl.uniform1i(this.position,t)}}class ve extends he{constructor(t,e,i){super(t),this.shader=e,this.textureShader=i}visit(t){if(this.shouldRender){const e=t.rasterObject instanceof le?this.textureShader:this.shader;e.use(),Rt.loadIntoShader(e),e.trySet(e.getUniformMatrix.bind(e),"M",this.matrixStack.top()),e.trySet(e.getUniformMatrix.bind(e),"V",this.lookat),e.trySet(e.getUniformMatrix.bind(e),"P",this.perspective),e.trySet(e.getUniformMatrix.bind(e),"N",this.lookat.mul(this.matrixStack.top())),this.lightPositions.forEach((t,i)=>{e.trySet(e.getUniformVec3.bind(e),"lightPositions["+i+"]",new ut(t.x,t.y,t.z))}),e.trySet(e.getUniformInt.bind(e),"lights",this.lightPositions.length),t.rasterObject.render(e)}}}class xe{constructor(t){this.gl=t}setup(t){this.gl.clearColor(1,1,1,1),this.gl.clearDepth(1),this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LEQUAL),t.accept(this)}visit(t){t.rasterObject=new ye[t.constructor.name](this.gl,...Object.values(t).slice(1))}visitGroupNode(t){for(let e of t.children)e.accept(this)}visitCameraNode(t){}visitLightNode(t){}}const ye={SphereNode:ae,AABoxNode:class extends oe{constructor(t,e,i,n){super(),this.gl=t;const r=e,s=i;this.vertices=[r.x,r.y,s.z,s.x,r.y,s.z,s.x,s.y,s.z,s.x,s.y,s.z,r.x,s.y,s.z,r.x,r.y,s.z,s.x,r.y,r.z,r.x,r.y,r.z,r.x,s.y,r.z,r.x,s.y,r.z,s.x,s.y,r.z,s.x,r.y,r.z,s.x,r.y,s.z,s.x,r.y,r.z,s.x,s.y,r.z,s.x,s.y,r.z,s.x,s.y,s.z,s.x,r.y,s.z,r.x,s.y,s.z,s.x,s.y,s.z,s.x,s.y,r.z,s.x,s.y,r.z,r.x,s.y,r.z,r.x,s.y,s.z,r.x,r.y,r.z,r.x,r.y,s.z,r.x,s.y,s.z,r.x,s.y,s.z,r.x,s.y,r.z,r.x,r.y,r.z,r.x,r.y,r.z,s.x,r.y,r.z,s.x,r.y,s.z,s.x,r.y,s.z,r.x,r.y,s.z,r.x,r.y,r.z],this.indices=[...Array(36).keys()],this.normals=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],this.colors=[];for(let t=0;t<this.vertices.length/3;t++)this.colors.push(n.r),this.colors.push(n.g),this.colors.push(n.b),this.colors.push(n.a);this.fillBuffers()}},TextureBoxNode:class extends le{constructor(t,e,i,n,r){super(),this.loaded=!1,this.gl=t;const s=e,o=i;this.vertices=[s.x,s.y,o.z,o.x,s.y,o.z,o.x,o.y,o.z,o.x,o.y,o.z,s.x,o.y,o.z,s.x,s.y,o.z,o.x,s.y,s.z,s.x,s.y,s.z,s.x,o.y,s.z,s.x,o.y,s.z,o.x,o.y,s.z,o.x,s.y,s.z,o.x,s.y,o.z,o.x,s.y,s.z,o.x,o.y,s.z,o.x,o.y,s.z,o.x,o.y,o.z,o.x,s.y,o.z,s.x,o.y,o.z,o.x,o.y,o.z,o.x,o.y,s.z,o.x,o.y,s.z,s.x,o.y,s.z,s.x,o.y,o.z,s.x,s.y,s.z,s.x,s.y,o.z,s.x,o.y,o.z,s.x,o.y,o.z,s.x,o.y,s.z,s.x,s.y,s.z,s.x,s.y,s.z,o.x,s.y,s.z,o.x,s.y,o.z,o.x,s.y,o.z,s.x,s.y,o.z,s.x,s.y,s.z];const a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.vertices),t.STATIC_DRAW),this.vertexBuffer=a,this.elements=this.vertices.length/3,new Promise((e,i)=>{let r=t.createTexture(),s=new Image;s.onload=()=>{t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null),e()},s.src=n,this.texBuffer=r}).then(()=>{let e=t.createTexture(),i=new Image;i.onload=()=>{t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null)},i.src=r,this.normalMapBuffer=e}).then(()=>this.loaded=!0);let l=this.gl.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0]),t.STATIC_DRAW),this.texCoords=l,this.normals=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0];const c=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,c),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.normals),this.gl.STATIC_DRAW),this.normalBuffer=c}},PyramidNode:class extends oe{constructor(t,e,i,n,r){super(),this.gl=t;const s=e,o=i,a=new ut((s.x+o.x)/2,s.y+n,(s.z+o.z)/2,1);this.vertices=[s.x,s.y,o.z,o.x,s.y,o.z,a.x,a.y,a.z,o.x,s.y,o.z,o.x,s.y,s.z,a.x,a.y,a.z,s.x,s.y,s.z,s.x,s.y,o.z,a.x,a.y,a.z,o.x,s.y,s.z,s.x,s.y,s.z,a.x,a.y,a.z,o.x,s.y,s.z,o.x,s.y,o.z,s.x,s.y,o.z,s.x,s.y,o.z,s.x,s.y,s.z,o.x,s.y,s.z],this.indices=[...Array(this.vertices.length/3).keys()],this.calcNormals(),this.colors=[];for(let t=0;t<this.vertices.length/3;t++)this.colors.push(r.r),this.colors.push(r.g),this.colors.push(r.b),this.colors.push(r.a);this.fillBuffers()}},MeshNode:class extends oe{constructor(t,e,i){super(),this.loaded=!1,this.gl=t,this.vertices=[],this.indices=[],this.normals=[],this.colors=[],fetch(e).then(t=>t.text()).then(t=>{const e=ce(t);e.indices.forEach(t=>{(isNaN(t.v)||isNaN(t.n))&&(hasNaNs=!0);const i=e.vertices[t.v];if(i&&this.vertices.push(i.x,i.y,i.z),e.normals.length>0){const i=e.normals[t.n];this.normals.push(i.x,i.y,i.z)}}),0===e.normals.length&&this.calcNormals();for(let t=0;t<this.vertices.length/3;t++)this.colors.push(i.r),this.colors.push(i.g),this.colors.push(i.b),this.colors.push(i.a);this.indices=[...Array(this.vertices.length/3).keys()],this.fillBuffers()}).then(()=>this.loaded=!0)}}};class we extends he{constructor(t,e){super(t),this.shader=e}setupCamera(){super.setupCamera(),this.fillBuffers()}render(t){this.sphereCenters=[],this.sphereRadii=[],this.sphereColors=[],super.render(t);const e=this.shader;e.use(),e.trySet(e.getUniformVec3.bind(e),"camera",this.cameraWorld),e.trySet(e.getUniformMatrix.bind(e),"iMVP",this.perspective.mul(this.lookat).invert()),Rt.loadIntoShader(this.shader),this.sphereCenters.forEach((t,i)=>{e.trySet(e.getUniformVec3.bind(e),"sphereCenters["+i+"]",new ut(t.x,t.y,t.z))}),this.sphereColors.forEach((t,i)=>{e.trySet(e.getUniformVec4.bind(e),"sphereColors["+i+"]",new ut(t.x,t.y,t.z,1))}),this.sphereRadii.forEach((t,i)=>{e.trySet(e.getUniformFloat.bind(e),"sphereRadii["+i+"]",t)}),e.trySet(e.getUniformInt.bind(e),"spheres",this.sphereCenters.length),this.lightPositions.forEach((t,i)=>{e.trySet(e.getUniformVec3.bind(e),"lightPositions["+i+"]",new ut(t.x,t.y,t.z))}),e.trySet(e.getUniformInt.bind(e),"lights",this.lightPositions.length),this.draw()}fillBuffers(){this.screenBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.screenBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),this.gl.STATIC_DRAW)}draw(){Rt.loadIntoShader(this.shader),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.screenBuffer);const t=this.shader.getAttributeLocation("a_vertexPosition");this.gl.enableVertexAttribArray(t),this.gl.vertexAttribPointer(t,2,this.gl.FLOAT,!1,0,0),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.gl.disableVertexAttribArray(t)}visit(t){this.shouldRender&&t instanceof ft&&(this.sphereCenters.push(this.matrixStack.top().mul(new ut(0,0,0,1))),this.sphereRadii.push(t.radius),this.sphereColors.push(t.color))}}class _e{constructor(t,e){this.center=t,this.radius=e}intersect(t){let e=t.origin,i=t.direction,n=this.center.sub(e).dot(i);if(n>0){let t=e.add(i.mul(n)),r=this.center.sub(t).length;if(r<this.radius){let t=Math.sqrt(this.radius*this.radius-r*r),s=n-t,o=n+t,a=Math.min(s,o);return new gt(a,e.add(i.mul(a)),e.add(i.mul(a)).sub(this.center).normalised())}}return null}}class be extends he{constructor(t,e){super(t),this.shader=e,this.renderActive=!1,this.intersectActive=!1}toggleRender(){this.renderActive=!this.renderActive}toggleIntersect(){this.intersectActive=!this.intersectActive}render(t){this.minIntersection=new gt,this.intersectedNode={},Tt.remove("debug"),this.lightSearch=!1,this.shouldRender=!1,this.intersectionSearch=!1,t.accept(this),this.setupCamera(),this.intersectionSearch=!0,t.accept(this),this.intersectActive&&Pt.set(this.intersectedNode),this.intersectionSearch=!1,this.shouldRender=!0,t.accept(this),l(Et)&&Nt.set(l(Pt))}draw(t){const e=this.shader;e.use(),Rt.loadIntoShader(e),e.trySet(e.getUniformMatrix.bind(e),"M",this.matrixStack.top()),e.trySet(e.getUniformMatrix.bind(e),"V",this.lookat),e.trySet(e.getUniformMatrix.bind(e),"P",this.perspective),t==l(Pt)?e.trySet(e.getUniformVec4.bind(e),"color",new ut(1,1,0,.5)):t==l(Nt)?e.trySet(e.getUniformVec4.bind(e),"color",new ut(1,.64,0,.5)):e.trySet(e.getUniformVec4.bind(e),"color",new ut(1,0,0,.5)),t.rasterBoundingSphere.render(e)}getIntersection(t){const e=this.perspective.mul(this.lookat).invert();let i=e.mul(new ut(l(St).x,l(St).y,-1,1));i=i.div(i.w);let n=e.mul(new ut(l(St).x,l(St).y,1,1));n=n.div(n.w);const r=new _e(this.matrixStack.top().mul(t.boundingSphere.center),t.boundingSphere.radius).intersect({origin:i,direction:n.sub(i).normalised()});r&&r.closerThan(this.minIntersection)&&(this.minIntersection=r,this.intersectedNode=t)}visit(t){t.rasterBoundingSphere&&(this.renderActive&&this.shouldRender&&this.draw(t),this.intersectActive&&this.intersectionSearch&&this.getIntersection(t))}visitCameraNode(t){this.shouldRender||this.intersectionSearch||super.visitCameraNode(t)}}class Ae{constructor(t){this.gl=t}setup(t){t.accept(this)}visit(t){if(!t.id.includes("noColl")){const e=()=>{if(0===t.rasterObject.vertices.length)setTimeout(e,1e3);else{const e=t.rasterObject.vertices,i=[];for(let t=0;t<e.length;t+=3)i.push(new ut(e[t],e[t+1],e[t+2],1));const{ritterCenter:n,ritterRadius:r}=ze(i);t.boundingSphere=new ft("",n,r,new ut(0,0,0,0)),t.rasterBoundingSphere=new ae(this.gl,n,r,new ut(1,0,0,.5))}};e()}}visitGroupNode(t){for(let e of t.children)e.accept(this)}visitCameraNode(t){}visitLightNode(t){}}const Se=t=>(e,i)=>{const n=t.sub(i).length;return n>e.currMin?{currMin:n,currentMax:i}:e},ze=t=>{const e=t[0];let i=t.reduce(Se(e),{currMin:0,currentMax:{}}).currentMax,n=t.reduce(Se(i),{currMin:0,currentMax:{}}).currentMax,r=i.sub(n).length/2,s=i.add(n.sub(i).mul(.5));let o=0;for(;t.filter(t=>t.sub(s).length>r+.005).length>0&&o++<10;){const e=t.filter(t=>t.sub(s).length>r+.005)[0],o=s.add(e.sub(s).normalised().mul(-r));r=e.sub(o).length/2,s=e.add(o.sub(e).mul(.5)),i=e,n=o}return{ritterCenter:s,ritterRadius:r}};class Re{constructor(t){this.active=!0;const e=[];for(e.push.apply(e,l(Tt).children),e.push(l(Tt));e.length>0;){const i=e.pop();if(i.id==t){this.groupNode=i;break}i instanceof pt&&e.push.apply(e,i.children)}}toggleActive(){this.active=!this.active}}class $e extends Re{constructor(t,e,i){super(t),this.angle=i,this.axis=e,this.origin=this.groupNode.matrix.transpose().transpose(),this.currentAngle=0}simulate(t){this.active&&(this.currentAngle+=this.angle*t/1e3%360,this.groupNode.matrix=dt.rotation(this.axis,this.currentAngle).mul(this.origin))}toJSON(){return{type:this.constructor.name,groupNodeId:this.groupNode.id,axis:this.axis,currentAngle:this.currentAngle,origin:this.origin,angle:this.angle}}static fromJSON(t){const e=new ut(t.axis._x,t.axis._y,t.axis._z,t.axis._w),i=new $e(t.groupNodeId,e,t.angle);return i.currentAngle=t.currentAngle,i.origin.data=t.origin.data,i}}class Ne extends Re{constructor(t,e,i,n){super(t),this.distance=i,this.speed=n,this.axis=e,this.value=0,this.translation=dt.identity(),this.origin=this.groupNode.matrix.transpose().transpose()}simulate(t){this.active&&(this.value+=t/(1e3/this.speed),this.groupNode.matrix=this.translation.mul(dt.translation(this.axis.mul(Math.sin(this.value)*this.distance))).mul(this.origin))}toJSON(){return{type:this.constructor.name,groupNodeId:this.groupNode.id,axis:this.axis,distance:this.distance,speed:this.speed,translation:this.translation,value:this.value,origin:this.origin}}static fromJSON(t){const e=new ut(t.axis._x,t.axis._y,t.axis._z,t.axis._w),i=new Ne(t.groupNodeId,e,t.distance,t.speed);return i.translation.data=t.translation.data,i.value=t.value,i.origin.data=t.origin.data,i}}class Pe extends Re{constructor(t,e){super(t),this.angle=90,this.axis=e,this.origin=this.groupNode.matrix.transpose().transpose(),this.currentAngle=0}simulate(t){this.active&&l(Nt)===this.groupNode&&(l($t).get("ArrowRight")&&(this.currentAngle+=-this.angle*t/1e3%360),l($t).get("ArrowLeft")&&(this.currentAngle+=this.angle*t/1e3%360),this.groupNode.matrix=dt.rotation(this.axis,this.currentAngle).mul(this.origin))}toJSON(){return{type:this.constructor.name,groupNodeId:this.groupNode.id,axis:this.axis,currentAngle:this.currentAngle,origin:this.origin}}static fromJSON(t){const e=new ut(t.axis._x,t.axis._y,t.axis._z,t.axis._w),i=new Pe(t.groupNodeId,e);return i.currentAngle=t.currentAngle,i.origin.data=t.origin.data,i}}class Ee extends Re{constructor(t,e,i,n){super(t),this.speed=n,this.firstAxis=e,this.secondAxis=i,this.origin=this.groupNode.matrix.transpose().transpose(),this.translationMatrix=dt.identity(),this.active=!0}simulate(t){this.active&&l(Nt)===this.groupNode&&(l($t).get("ArrowRight")&&(this.translationMatrix=dt.translation(this.firstAxis.mul(t*this.speed/1e3)).mul(this.translationMatrix)),l($t).get("ArrowLeft")&&(this.translationMatrix=dt.translation(this.firstAxis.mul(-t*this.speed/1e3)).mul(this.translationMatrix)),l($t).get("ArrowUp")&&(this.translationMatrix=dt.translation(this.secondAxis.mul(t*this.speed/1e3)).mul(this.translationMatrix)),l($t).get("ArrowDown")&&(this.translationMatrix=dt.translation(this.secondAxis.mul(-t*this.speed/1e3)).mul(this.translationMatrix)),this.groupNode.matrix=this.translationMatrix.mul(this.origin))}toJSON(){return{type:this.constructor.name,groupNodeId:this.groupNode.id,translationMatrix:this.translationMatrix,origin:this.origin,firstAxis:this.firstAxis,secondAxis:this.secondAxis,speed:this.speed}}static fromJSON(t){const e=new ut(t.firstAxis._x,t.firstAxis._y,t.firstAxis._z,t.firstAxis._w),i=new ut(t.secondAxis._x,t.secondAxis._y,t.secondAxis._z,t.secondAxis._w),n=new Ee(t.groupNodeId,e,i,t.speed);return n.translationMatrix.data=t.translationMatrix.data,n.origin.data=t.origin.data,n}}class Te extends Re{constructor(t,e){super(t),this.mouseSensitivity=e,this.origin=this.groupNode.matrix.transpose().transpose(),this.currentX=0,this.currentY=0,this.translationMatrix=dt.identity(),this.active=!1}simulate(t){this.active&&(l($t).get("a")&&(this.translationMatrix=dt.translation(this.groupNode.matrix.getLeftVector().mul(-10*t/1e3)).mul(this.translationMatrix)),l($t).get("d")&&(this.translationMatrix=dt.translation(this.groupNode.matrix.getLeftVector().mul(10*t/1e3)).mul(this.translationMatrix)),l($t).get("w")&&(this.translationMatrix=dt.translation(this.groupNode.matrix.getForwardVector().mul(-10*t/1e3)).mul(this.translationMatrix)),l($t).get("s")&&(this.translationMatrix=dt.translation(this.groupNode.matrix.getForwardVector().mul(10*t/1e3)).mul(this.translationMatrix)),l($t).get("q")&&(this.translationMatrix=dt.translation(this.groupNode.matrix.getUpVector().mul(10*t/1e3)).mul(this.translationMatrix)),l($t).get("e")&&(this.translationMatrix=dt.translation(this.groupNode.matrix.getUpVector().mul(-10*t/1e3)).mul(this.translationMatrix)),this.currentY+=-l(zt).y*t/100*this.mouseSensitivity,this.currentX+=-l(zt).x*t/100*this.mouseSensitivity,this.groupNode.matrix=this.translationMatrix.mul(dt.rotation(new ut(0,1,0),this.currentX).mul(dt.rotation(new ut(1,0,0),this.currentY))).mul(this.origin),zt.reset())}toJSON(){return{type:this.constructor.name,groupNodeId:this.groupNode.id,mouseSensitivity:this.mouseSensitivity,currentX:this.currentX,currentY:this.currentY,translationMatrix:this.translationMatrix,origin:this.origin}}static fromJSON(t){const e=new Te(t.groupNodeId,t.mouseSensitivity);return e.currentX=t.currentX,e.currentY=t.currentY,e.translationMatrix=new dt([]),e.translationMatrix.data=t.translationMatrix.data,e.origin.data=t.origin.data,e}}const Me={RotationNode:$e,BouncingNode:Ne,ManualRotationNode:Pe,FreeFlightNode:Te,DriverNode:Ee},{window:ke}=it;function Ce(t){var e,i,n,s,o,a,l,c,h,u,d,g,m,p,f,w,$,N,P,E,T,M,k,C,F,U,B,V,D,L,O,I,Y,G,X,j=new Zt({}),J=new se({});return{c(){e=_("div"),i=_("div"),(n=_("div")).innerHTML='<img style="margin-right: 1em;" id="logo-img" alt="HCI Logo" src="hci-logo.png" width="70px" height="70px"> <div><a href="/" class="svelte-1kopvts"><h1>ICG CS Master Project</h1></a> <em style="padding-left: 1em; font-size: 1em">Long Bui</em></div>',s=A(),o=_("div"),(a=_("button")).textContent="Toggle Bounding Spheres",l=A(),(c=_("button")).textContent="Toggle Animation",h=A(),(u=_("button")).textContent="Toggle Renderer",d=A(),(g=_("a")).textContent="Save Scene",m=A(),p=_("button"),f=b("Load Scene\n        "),w=_("input"),$=A(),N=_("div"),P=_("div"),j.$$.fragment.c(),E=A(),T=_("div"),J.$$.fragment.c(),M=A(),k=_("div"),C=_("canvas"),F=A(),U=_("div"),B=_("div"),V=b("FPS: "),D=b(t.fps),L=A(),O=_("div"),I=b("Average: "),Y=b(t.averageFps),z(n,"class","logo svelte-1kopvts"),z(a,"type","button"),z(a,"class","btn btn-primary"),z(c,"type","button"),z(c,"class","btn btn-primary"),z(u,"id","renderer_toggle"),z(u,"type","button"),z(u,"class","btn btn-primary"),z(g,"id","save_button"),z(g,"role","button"),z(g,"class","btn btn-primary"),z(g,"download","scenegraph.json"),z(g,"href","/"),z(w,"id","file-uploader"),z(w,"type","file"),z(w,"accept","application/json"),z(w,"class","svelte-1kopvts"),z(p,"id","load_button"),z(p,"type","button"),z(p,"class","btn btn-primary"),z(o,"class","header__button-group"),z(i,"id","header"),z(i,"class","svelte-1kopvts"),z(P,"class","sidebar__scenegraph svelte-1kopvts"),z(T,"class","sidebar__configurator svelte-1kopvts"),z(N,"id","sidebar"),z(N,"class","svelte-1kopvts"),z(C,"class","main_content__canvas svelte-1kopvts"),z(C,"width","1920"),z(C,"height","1080"),z(B,"class","svelte-1kopvts"),z(O,"class","svelte-1kopvts"),z(U,"class","main_content__overlay svelte-1kopvts"),z(k,"class","main_content svelte-1kopvts"),z(e,"class","main-container svelte-1kopvts"),X=[S(ke,"keydown",t.handleKeyDown),S(ke,"keyup",t.handleKeyUp),S(a,"click",t.handleBoundToggle),S(c,"click",t.handleStop),S(u,"click",t.toggleRenderer),S(g,"click",t.handleDownload),S(w,"change",t.handleUpload),S(p,"click",t.click_handler),S(C,"contextmenu",t.startFreeFlight),S(C,"mousemove",t.handleMouseMove),S(C,"mouseenter",t.toggleIntersectSearch),S(C,"mouseleave",t.toggleIntersectSearch),S(C,"mousedown",t.handleMouseDown),S(C,"mouseup",t.handleMouseUp)]},m(r,y){x(r,e,y),v(e,i),v(i,n),v(i,s),v(i,o),v(o,a),v(o,l),v(o,c),v(o,h),v(o,u),v(o,d),v(o,g),t.a_1_binding(g),v(o,m),v(o,p),v(p,f),v(p,w),t.input_binding(w),v(e,$),v(e,N),v(N,P),rt(j,P,null),v(N,E),v(N,T),rt(J,T,null),v(e,M),v(e,k),v(k,C),t.canvas_1_binding(C),v(k,F),v(k,U),v(U,B),v(B,V),v(B,D),v(U,L),v(U,O),v(O,I),v(O,Y),G=!0},p(t,e){G&&!t.fps||R(D,e.fps),G&&!t.averageFps||R(Y,e.averageFps)},i(t){G||(Q(j.$$.fragment,t),Q(J.$$.fragment,t),G=!0)},o(t){Z(j.$$.fragment,t),Z(J.$$.fragment,t),G=!1},d(i){i&&y(e),t.a_1_binding(null),t.input_binding(null),st(j),st(J),t.canvas_1_binding(null),r(X)}}}function Fe(t,e,i){let n,r,s,o,a,h,u,d,g,m,p,f,v,x,y,w;c(t,Tt,t=>{n=t,i("$sceneGraph",n)}),c(t,Mt,t=>{r=t,i("$animationNodes",r)}),c(t,$t,t=>{s=t,i("$keysPressed",s)}),c(t,Nt,t=>{o=t,i("$selectedNode",o)}),c(t,Et,t=>{a=t,i("$mouseClicked",a)});let _=0,b=0,A=0,S=0,z=1e3;F(()=>{const t=g.getContext("webgl",{premultipliedAlpha:!1});t.clearDepth(1),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.getExtension("OES_element_index_uint"),(t=>{Tt.set(new pt("root",dt.identity()));const e=new pt("baseTranslation",dt.translation(new ut(0,0,-8))),i=new pt("desktopBase",dt.identity());e.add(i),i.add(new xt("towerBase",new ut(-2,-2,-2,1),new ut(2,2,2,1),"hci-logo.png","wood.jpg"));const n=new pt("clockHandRoot",dt.translation(new ut(0,0,2)));n.add(new yt("clockHand",new ut(-.25,-.5,-.25,1),new ut(.25,-.5,.25,1),2,new ut(0,.6,0,1)));const r=new pt("clockFixNode",dt.translation(new ut(0,0,.25,1)));r.add(new ft("clockFix",new ut(0,0,0,1),.1,new ut(.5,.2,.4,1)));const s=new pt("clockHandTipGroup",dt.translation(new ut(0,2,0,1)).mul(dt.scaling(new ut(.5,.5,.5))));s.add(new bt("clockMonkey","monkey.obj",new ut(.3,.2,0,1))),r.add(s),n.add(r),i.add(n);const o=new pt("teapotGroup",dt.translation(new ut(0,2.05,0,1)).mul(dt.scaling(new ut(.4,.4,.4))));o.add(new bt("teapot","teapot.obj",new ut(1,.8,0,1))),i.add(o);const a=new pt("carpetGroup",dt.translation(new ut(0,-2,0)));a.add(new xt("carpet-noColl",new ut(-20,0,-20,1),new ut(20,.01,20),"carpet.jpg","pillow.jpg")),e.add(a);const l=new pt("houseGroup",dt.translation(new ut(0,-2.1,0)));l.add(new xt("houseNode-noColl",new ut(-20,0,-20,1),new ut(20,20,20),"shack.jpg","wood.jpg")),e.add(l);const c=new pt("sphereRoot",dt.translation(new ut(0,8,0))),h=new pt("sphere1Group",dt.translation(new ut(-10,0,-3)));h.add(new ft("sphere1",new ut(0,0,0,1),1,new ut(.7,.7,.7,1),new ut(0,0,0,.5))),c.add(h);const u=new pt("sphere2Group",dt.translation(new ut(10,-2,-5)));u.add(new ft("sphere2",new ut(0,0,0,1),1.5,new ut(.3,0,0,1))),c.add(u);const d=new pt("sphere3Group",dt.translation(new ut(-4,-4,4)));d.add(new ft("sphere3",new ut(0,0,0,1),1.5,new ut(0,0,.4,1),new ut(1,1,1,1))),c.add(d);const g=new pt("flyingCow",dt.translation(new ut(0,1,-5)).mul(dt.scaling(new ut(.5,.5,.5))));g.add(new bt("cow","cow.obj",new ut(0,.4,.4,1))),c.add(g);const m=new pt("flyingBunny",dt.translation(new ut(0,2,5)).mul(dt.scaling(new ut(5,5,5))));m.add(new bt("bunny","bunnyHR.obj",new ut(.6,0,.4,1))),c.add(m),i.add(c);const p=new pt("camerHolder",dt.translation(new ut(0,2,10,1))),f=new pt("cameraNode",dt.identity());f.add(new wt("camera",new ut(0,0,1,1),new ut(0,0,-1,1),new ut(0,1,0,0),75,t.width/t.height,.1,100)),p.add(f);const v=new pt("lightNode",dt.translation(new ut(0,5,0,1)));v.add(new _t("centerLight",new ut(1,0,0,1)));const x=new pt("sunNode",dt.translation(new ut(20,0,0,1)));x.add(new _t("sun",new ut(1,1,0,1))),Tt.add(p),Tt.add(e),Tt.add(v),Tt.add(x),Mt.add(new Ee(c.id,new ut(1,0,0),new ut(0,0,-1),5)),Mt.add(new $e(i.id,new ut(0,1,0),45)),Mt.add(new Ne(s.id,new ut(0,1,0),1,2)),Mt.add(new Ne(v.id,new ut(1,0,0),.25,2)),Mt.add(new $e(n.id,new ut(0,0,1),90)),Mt.add(new $e(x.id,new ut(0,1,0),90)),Mt.add(new $e(m.id,new ut(0,1,0),90)),Mt.add(new $e(m.id,new ut(0,0,1),90)),Mt.add(new $e(g.id,new ut(0,1,0),90)),Mt.add(new $e(g.id,new ut(0,0,1),90)),Mt.add(new Te(f.id,.5))})(g),y=new we(t,new ue(t,"attribute vec2 a_vertexPosition;varying vec3 rayOrigin;varying vec3 rayDirection;uniform mat4 iMVP;void main(void){vec2 vertex=a_vertexPosition*2.0-vec2(1.0);vec4 farPlane=iMVP*vec4(vertex,1.0,1.0);farPlane/=farPlane.w;vec4 nearPlane=iMVP*vec4(vertex,-1.0,1.0);nearPlane/=nearPlane.w;rayDirection=(farPlane.xyz-nearPlane.xyz);rayOrigin=nearPlane.xyz;gl_Position=vec4(vertex,0.0,1.0);}","precision mediump float;varying vec3 rayDirection;varying vec3 rayOrigin;uniform vec3 light0;struct Ray{vec3 origin;vec3 direction;};struct Hit{vec3 position;vec3 normal;float t;vec4 color;};struct Sphere{vec3 center;float radius;vec4 color;};const float EPS=0.0001;const float START_T=100000.0;const int MAX_DEPTH=3;Ray initRay(){Ray r;r.origin=rayOrigin;r.direction=normalize(rayDirection);return r;}float intersectRaySphere(in Ray ray,in Sphere sphere){vec3 rayOrigin=ray.origin;vec3 rayDir=ray.direction;float t=dot((sphere.center-rayOrigin),rayDir);vec3 ortho=rayOrigin+(rayDir*t);float y=length(sphere.center-ortho);if(y<sphere.radius){float x=sqrt(sphere.radius*sphere.radius-y*y);float t1=t-x;float t2=t+x;float firstHitDistance=min(t1,t2);return firstHitDistance;}return-1.;}uniform vec3 lightPositions[8];const int maxLights=8;uniform int lights;Sphere sphereObjects[7];const int maxSpheres=64;uniform vec3 camera;uniform vec3 sphereCenters[64];uniform vec4 sphereColors[64];uniform float sphereRadii[64];uniform int spheres;uniform float kA;uniform float kD;uniform float kS;uniform float shininess;void initScene(){for(int i=0;i<maxSpheres;i++){if(i<spheres){sphereObjects[i].center=sphereCenters[i];sphereObjects[i].radius=sphereRadii[i];sphereObjects[i].color=sphereColors[i];}}}bool traceScene(in Ray ray,inout Hit hit){hit.t=START_T;float t=START_T;if(t>=0.0&&t<=hit.t){hit.t=t;hit.position=ray.origin+ray.direction*t;hit.normal=vec3(0,1,0);}for(int i=0;i<7;++i){t=intersectRaySphere(ray,sphereObjects[i]);if(t>=0.0&&t<=hit.t){vec3 pos=ray.origin+ray.direction*t;vec3 N=normalize(pos-sphereObjects[i].center);hit.t=t;hit.normal=N;hit.color=sphereObjects[i].color;hit.position=pos;}}return hit.t<START_T;}vec4 diffuse(vec3 lightPos,vec3 hit,vec3 normal,vec4 color){float lambertian=max(dot(normalize(lightPos-hit),normal),.0);return color*kD*lambertian;}vec4 specular(vec3 lightPos,vec3 hit,vec3 normal,vec4 color){vec3 l=normalize(lightPos-hit);vec3 r=reflect(-l,normal);vec3 v=normalize(camera-hit);return color*kS*pow(max(dot(r,v),0.0),shininess);}void main(){Ray ray=initRay();initScene();vec4 color=vec4(ray.direction,1.0);Hit hit;if(traceScene(ray,hit)){color=kA*hit.color;for(int i=0;i<maxLights;i++){if(i<lights){color+=(diffuse(lightPositions[i],hit.position,hit.normal,hit.color)+specular(lightPositions[i],hit.position,hit.normal,hit.color));}}}gl_FragColor=color;}")),p=new ve(t,new ue(t,"attribute vec3 a_position;attribute vec3 a_normal;attribute vec4 a_colour;uniform mat4 M;uniform mat4 V;uniform mat4 P;uniform mat4 N;varying vec4 v_color;varying vec3 v_pos;varying vec3 v_normal;void main(){mat4 modelView=V*M;vec4 vert_pos=modelView*vec4(a_position,1.);gl_Position=P*vert_pos;v_normal=normalize(vec3(N*vec4(a_normal,.0)));v_color=a_colour;v_pos=vec3(vert_pos.xyz/vert_pos.w);}","precision mediump float;uniform vec3 lightPositions[8];const int maxLights=8;uniform int lights;varying vec4 v_color;varying vec3 v_normal;varying vec3 v_pos;uniform float kA;uniform float kD;uniform float kS;uniform float shininess;vec4 ambient(){return v_color*kA;}vec4 diffuse(vec3 lightPos){float lambertian=max(dot(normalize(lightPos-v_pos),v_normal),.0);return v_color*kD*lambertian;}vec4 specular(vec3 lightPos){vec3 l=normalize(lightPos-v_pos);vec3 r=reflect(-l,v_normal);vec3 v=normalize(-v_pos);return v_color*kS*pow(max(dot(r,v),0.0),shininess);}void main(void){gl_FragColor=ambient();for(int i=0;i<maxLights;i++){if(i<lights){gl_FragColor+=(diffuse(lightPositions[i])+specular(lightPositions[i]));}}gl_FragColor.a=v_color.a;}"),new ue(t,"attribute vec3 a_position;attribute vec3 a_normal;attribute vec2 a_texCoord;uniform mat4 M;uniform mat4 V;uniform mat4 P;uniform mat4 N;varying vec2 v_texCoord;varying vec3 v_pos;varying vec3 v_normal;void main(){mat4 modelView=V*M;vec4 vert_pos=modelView*vec4(a_position,1.);gl_Position=P*vert_pos;v_texCoord=a_texCoord;v_normal=normalize(vec3(N*vec4(a_normal,.0)));v_pos=vec3(vert_pos.xyz/vert_pos.w);}","precision mediump float;uniform vec3 lightPositions[8];const int maxLights=8;uniform int lights;uniform sampler2D sampler;uniform sampler2D normalSampler;varying vec2 v_texCoord;varying vec3 v_normal;varying vec3 v_pos;uniform float kA;uniform float kD;uniform float kS;uniform float shininess;float ambient(){return kA;}float diffuse(vec3 lightPos,vec3 normal){float lambertian=max(dot(normalize(lightPos-v_pos),normal),.0);return kD*lambertian;}float specular(vec3 lightPos,vec3 normal){vec3 l=normalize(lightPos-v_pos);vec3 r=reflect(-l,normal);vec3 v=normalize(-v_pos);return kS*pow(max(dot(r,v),0.0),shininess);}void main(void){vec4 textureColor=texture2D(sampler,v_texCoord);vec4 normalCoord=2.*(texture2D(normalSampler,v_texCoord))-1.;gl_FragColor=vec4((textureColor*ambient()).xyz,1.0);for(int i=0;i<maxLights;i++){if(i<lights){gl_FragColor+=vec4((textureColor*diffuse(lightPositions[i],normalize(v_normal+normalCoord.xyz))+textureColor*specular(lightPositions[i],normalize(v_normal+normalCoord.xyz))).xyz,1.0);}}gl_FragColor.a=textureColor.a;}")),f=new xe(t),v=new be(t,new ue(t,"attribute vec3 a_position;attribute vec4 a_colour;attribute vec3 a_normal;uniform mat4 M;uniform mat4 V;uniform mat4 P;void main(){vec3 throwAway=a_normal;throwAway=vec3(0.,0.,0.);vec4 color=a_colour;color=vec4(0.,0.,0.,0.);mat4 modelView=V*M;vec4 vert_pos=modelView*vec4(a_position,1.);gl_Position=P*vert_pos;}","precision mediump float;uniform vec4 color;void main(void){gl_FragColor=color;}")),x=new Ae(t),m=p,f.setup(n),x.setup(n);let e=performance.now();const i=t=>{const s=t-e;(t=>{for(let e of r)e.simulate(t)})(s),m.render(n),v.render(n),R(s),e=t,window.requestAnimationFrame(i)};Promise.all([p.shader.load(),p.textureShader.load(),y.shader.load(),v.shader.load()]).then(t=>window.requestAnimationFrame(i))});const R=t=>{_++,b+=t,i("averageFps",w=(_/(b/1e3)).toFixed(2)),S++,b>=z&&(i("fps",A=S),z=b+1e3,S=0)};document.addEventListener("pointerlockchange",t=>{document.pointerLockElement!==g&&document.mozPointerLockElement!==g&&r.filter(t=>t instanceof Te).forEach(t=>t.active=!1)});return{fileInput:h,downloadButton:u,canvas:g,averageFps:w,fps:A,toggleRenderer:()=>{m=m===p?y:p},handleKeyDown:t=>{s.get(t.key)||$t.keydown(t.key)},handleKeyUp:t=>{$t.keyup(t.key)},handleUpload:t=>{const e=t.target.files[0];if(e){const i=new FileReader;i.onload=t=>{let e=JSON.parse(t.target.result),i=e.sceneGraph,s=e.animationNodes;o={},Nt.set(o),n=pt.fromJSON(i),Tt.set(n),f.setup(n),x.setup(n),r=s.map(t=>Me[t.type].fromJSON(t)),Mt.set(r)},i.readAsText(e),t.target.value=""}},handleDownload:t=>{d&&window.URL.revokeObjectURL(d),d=window.URL.createObjectURL(new Blob([JSON.stringify({sceneGraph:n,animationNodes:r})],{type:"application/json"})),u.href=d,i("downloadButton",u)},handleMouseMove:t=>{document.pointerLockElement===g&&(zt.addX(t.movementX),zt.addY(t.movementY));const e=t.clientX,i=t.clientY,n=t.target.getBoundingClientRect();if(n.left<=e&&e<n.right&&n.top<=i&&i<n.bottom){const t=e-n.left,r=n.bottom-i,s=n.bottom-n.top,o=n.right-n.left;St.setX(2*t/o-1),St.setY(2*r/s-1)}},toggleIntersectSearch:()=>{v.toggleIntersect()},handleStop:t=>{l(Mt).filter(t=>!(t instanceof Te)).forEach(t=>t.toggleActive())},handleBoundToggle:()=>{v.toggleRender()},startFreeFlight:t=>{t.preventDefault(),g.requestPointerLock=g.requestPointerLock||g.mozRequestPointerLock,i("canvas",g),g.requestPointerLock(),r.filter(t=>t instanceof Te).forEach(t=>t.active=!0)},handleMouseDown:t=>{1==t.which&&(a=!0,Et.set(a))},handleMouseUp:t=>{1==t.which&&(a=!1,Et.set(a))},a_1_binding:function(t){B[t?"unshift":"push"](()=>{i("downloadButton",u=t)})},input_binding:function(t){B[t?"unshift":"push"](()=>{i("fileInput",h=t)})},click_handler:function(){h.click()},canvas_1_binding:function(t){B[t?"unshift":"push"](()=>{i("canvas",g=t)})}}}return new class extends lt{constructor(t){super(),at(this,t,Fe,Ce,o,[])}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
